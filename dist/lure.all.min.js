"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Date.prototype.format||(Date.prototype.format=function(t){return Lure._DateFormat(this,t)});var Lure=function(){var LureClass=function(){function LureClass(){_classCallCheck(this,LureClass),this.Plugin={};var $this=this;this.Debug=!1,this.isEditableEventsEnabled=!1;var regexEach=new RegExp(/{{#each\s+([^}]+)}}/g),regexIfOuter=new RegExp(/{{#if\s+([^}]+)}}([\s\S]*?){{#endif}}/g),regexIfInner=new RegExp(/{{#if([\s\S]*?)}}/g),regexExpressions=new RegExp(/{{([^#}]+)}}/g),regexEditable=new RegExp(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/g),spaces="    ",preCompileIfOuter=function(t){return t=t.replace(/#IF/g,"#if").replace(/#ENDIF/g,"#endif").replace(regexIfOuter,function(t,e,i){return'`+\n/* OUTER "IF" */\n(function($this){\n    if ('+preParseObjectChecker(e)+") {\n        return `"+i+"`;\n    }\n    return '';\n})($this)+`"})},preCompileIfInner=function(t){return t=t.replace(regexIfInner,function(t,e){return e=e.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/#less/g," < ").replace(/#more/g," > ").replace(/&amp;/g,"&").replace(/\|/g,'"'),'`+\n    /* LOCAL "IF" */\n    (function(){\n        return ('+e+"); \n        return '';})()+`"})},preCompileEach=function(t){t=t.replace(/{{#EACH/g,"{{#each").replace(/{{#ENDEACH/g,"{{#endeach");var e=t.match(regexEach),i=0;if(null!==e)for(var n=e.length-1;n>=0;n--){var r=e[n],a=!1;i++;var o=t.indexOf(r),s=t.indexOf("{{#endeach}}",o),l=t.slice(0,o).match(regexEach);l=null!==l?l.length:0;var u=t.slice(0,o).match(/{{#endeach}}/g);u=null!==u?u.length:0,l>u&&(a=!0,i=0);var c=t.slice(o,s+12),d=c.slice(r.length,c.length-12),h=r.replace(/{{#each\s+([\s\S]+)}}/,function(t,e){return e});h=preParseObjectChecker(h);var f="`+"+spaces.repeat(i)+"/* EACH */(function(inner, $parent){                                                                   \r\n"+spaces.repeat(i)+"    if (!inner || (Object.keys(inner).length === 0 && inner.constructor === Object && isNaN(inner)))   \r\n"+spaces.repeat(i)+'        return "";                                                                                     \r\n'+spaces.repeat(i)+'    let string_result= "";                                                                             \r\n'+spaces.repeat(i)+"    for(let j = 0; j < inner.length; j++){                                                             \r\n"+spaces.repeat(i)+"        let $this = inner[j];                                                                          \r\n"+spaces.repeat(i)+"        let o = inner[j];                                                                              \r\n"+spaces.repeat(i)+"        string_result = string_result + `"+preParse(d)+"`;                                \r\n"+spaces.repeat(i)+"    }                                                                                                  \r\n"+spaces.repeat(i)+"    return string_result;                                                                              \r\n"+spaces.repeat(i)+"})("+h+', {$parent: typeof $parent !== "undefined"?$parent:null, $this: $this, i: i} ) +`         ';t=t.replace(c,f)}return t},preCompileEditable=function(t){return t.replace(regexEditable,function(t,e,i){return t=t.replace(/<[\s\S]+?(>)/,function(t,e){return t.replace(e,' data-line="{{i}}" data-property="'+i.replace("{{","").replace("}}","")+'">')}),t.replace(i,'<div class="editable-helper editable-value">'+i+'</div><div class="editable-helper editable-icon"></div>')})},preParseObjectChecker=function(t){function e(t){var e=t.replace(/\s/g,""),i=e.indexOf("$item")>-1||e.indexOf("$this")>-1||e.indexOf("$parent")>-1,n=e.indexOf("$index")>-1||e.indexOf("$j")>-1||e.indexOf("$key")>-1||e.indexOf("$lvl")>-1||e.indexOf("$g.")>-1,r="?"===e||e.indexOf("=")>-1||e.indexOf(">")>-1||e.indexOf("<")>-1,a=null!==e.match(/^["'\\][\s\S]*["'\\]$/),o="i"===e||"j"===e,s=!isNaN(e);return i||n||o||s||a||r?e.indexOf("$g.")>-1?e.replace("$g.",""):t:"o."+e}return t.indexOf("Available + Dis")>-1,t=t.replace(/[^\-+\/%()*]+/g,function(t){var i=t.match(/&/g);if(null!==i){for(var n=0;n<i.length;n++)t=n<i.length-1?t.replace("&","$parent"):t.replace("&","$parent.$this");return t}return e(t)}),t=t.replace(/\\'/g,"'"),t="("+t+")"},preParse=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.replace(regexExpressions,function(t,i){return e?"${"+preParseObjectChecker(i)+"}":"${"+i+"}"})};this.Compile=function(t,e){t=t.replace(/[\n]+/g," ").replace(/[ ]{3,}/g,""),t=t.replace(/'/g,"\\'"),e&&(t=preCompileEditable(t),t=preCompileIfOuter(t),t=preCompileEach(t)),t=preParse(t),t=preCompileIfInner(t);var i="\nlet $this = o;\nlet $item = o;\nlet $num = i+1;\nlet $denum = length-i;\n//treebuilder's\nlet $index;\nlet $key;\nlet $lvl;\nlet $j;\nif (extra){\n    $index = extra.$index;\n    $key = extra.$key;\n    $lvl = extra.$lvl;\n    $j = extra.$j;\n}\nlet string_Result = \"\";\nif (o === undefined || (Object.keys(o).length === 0 && o.constructor === Object && isNaN(o)) ) \n    return '';\nreturn `";i+=t+"`;",i=i.replace(/`/g,"'").replace(/\$\{([^}]*)\}/g,function(t,e){return"'+"+e+"+'"});var n=void 0;try{n=new Function("o","i","length","extra",i)}catch(r){console.info(i),console.error(r)}return n},this._EditablesEventListenerRun=function(t){$this.AddEventListenerGlobal("dblclick",".editable",function(t){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(t.currentTarget)},t),$this.AddEventListenerGlobal("click",".editable-icon",function(t){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(t.currentTarget.closest(".editable"))},t),$this.AddEventListenerGlobal("dblclick",".editable",function(t){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(t.currentTarget)},t),$this.AddEventListenerGlobal("change",".editable-editor",function(t){var e=t.currentTarget.value,i=t.currentTarget.parentElement.dataset.value;e!==i?t.currentTarget.parentElement.classList.add("editable-waiting"):t.currentTarget.parentElement.classList.remove("editable-waiting")},t),$this.AddEventListenerGlobal("keyup",".editable-textbox",function(t){if(13===t.keyCode)return $this.Editable.Save(t.currentTarget.closest(".editable"),t.currentTarget.value),!1;var e=t.currentTarget.value,i=t.currentTarget.parentElement.dataset.value;e!==i?t.currentTarget.parentElement.classList.add("editable-waiting"):t.currentTarget.parentElement.classList.remove("editable-waiting")},t),$this.AddEventListenerGlobal("click",".editable-save-button",function(t){var e=t.currentTarget.closest(".editable");$this.Editable.Save(t.currentTarget.closest(".editable"),e.querySelector(".editable-editor").value)},t),$this.isHasEditablesEventsEnabled||(document.addEventListener("click",function(t){t.target.classList.contains("editable-helper")&&null!==document.querySelectorAll(".editable-helper, .editable-editing")||$this.Editable.RemoveEdits()}),$this.isHasEditablesEventsEnabled=!0)},this.CreateElementFromString=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=document.createDocumentFragment(),n=document.createElement(e);for(n.innerHTML=t;n.childNodes[0];)i.appendChild(n.childNodes[0]);return i.childNodes[0]},this.CreateElementsFromString=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=document.createDocumentFragment(),n=document.createElement(e);for(n.innerHTML=t;n.childNodes[0];)i.appendChild(n.childNodes[0]);if(i.childNodes.length>0){for(var r=[],a=0;a<i.childNodes.length;a++)r.push(i.childNodes[a]);return r}return null},this.Select=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return""===t||null===t?null:t instanceof Node?t:e.querySelector(t)},this.SelectAll=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return"undefined"==typeof t?[]:"undefined"!=typeof t.tagName||t===document?[t]:e.querySelectorAll(t)},this.AddEventListenerGlobal=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document,r=arguments[4];n.addEventListener(t,function(t){var a=t.target,o=!1,s=Lure._EventClone(t),l=n.querySelectorAll(e);if(l[0]===a&&(s.currentTarget=a,o=!0),!o)for(var u=0;u<l.length;u++)if(l[u].contains(a)){o=!0,s.currentTarget=a.closest(e);break}o&&i.call(r?r:s.currentTarget,s)})},this.isVisible=function(t){var e=function(t){var e=window.getComputedStyle(t);return"none"!==e.display&&"0"!==e.opacity&&"hidden"!==e.visibility&&((0!==parseInt(e.minWidth)&&"auto"!==e.minWidth||0!==parseInt(e.width))&&(0!==parseInt(e.minHeight)&&"auto"!==e.minHeight||0!==parseInt(e.height)))},i=function(t){for(;t.parentElement;){if(!e(t.parentElement))return!1;t=t.parentElement}return!0};return!!e(t)&&i(t)},this._EventClone=function(t){function e(){}var i=new e;for(var n in t){var r=Object.getOwnPropertyDescriptor(t,n);!r||r.writable&&r.configurable&&r.enumerable&&!r.get&&!r.set?i[n]=t[n]:Object.defineProperty(i,n,r)}return Object.setPrototypeOf(i,t),i},this.GetFileText=function(t){return new Promise(function(e,i){var n=new XMLHttpRequest;n.onload=function(){e(n.response)},n.onerror=function(){i(new Error("XMLHttpRequest Error: "+this.statusText))},t=t.indexOf("..")>-1?t.replace("..",document.location.protocol+"//"+document.location.host):document.location.href.substring(0,document.location.href.lastIndexOf("/")+1)+t,console.log("Lure.GetFileText",t),n.open("GET",t),n.send()})},this.GetTextWidth=function(t,e,i){return void 0===this.c&&(this.c=document.createElement("canvas"),this.ctx=this.c.getContext("2d")),this.ctx.font=i+" "+e,this.ctx.measureText(t).width},this.GetInlineSize=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1rem",i="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",n=document.createElement("div");for(var r in t.style)try{""!==t.style[r]&&t.style[r].indexOf(":")>0&&(n.style[r]=t.style[r])}catch(a){}document.all?n.style.setAttribute("cssText",i):n.setAttribute("style",i),n.style.fontSize=e,n.innerHTML=t.innerHTML,parent.document.body.appendChild(n);var o={width:n.clientWidth,height:n.clientHeight};return parent.document.body.removeChild(n),o},this.GetInlineSize1=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"12px//",i=performance.now(),n="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",r=document.createElement("div");for(var a in t.style)try{""!==t.style[a]&&t.style[a].indexOf(":")>0&&(r.style[a]=t.style[a])}catch(o){}document.all?r.style.setAttribute("cssText",n):r.setAttribute("style",n),r.style.fontSize=e,r.innerHTML=t.innerHTML,parent.document.body.appendChild(r);var s=getComputedStyle(r),l=performance.now(),u={width:$this.GetTextWidth(t.innerText,s.getPropertyValue("font-family"),s.getPropertyValue("font-size")),height:12};return Lure.Perf(l,"--size"),parent.document.body.removeChild(r),console.log("sizes",u,s),Lure.Perf(i,"--calxXwidth"),u},this.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},this._DateFormat=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD.MM.YYYY HH:mm:ss";if(null===t||"undefined"==typeof t)return"";var i=t.getDate(),n=t.getMonth(),r=t.getFullYear(),a=t.getHours(),o=t.getMinutes(),s=t.getSeconds();return e.replace("DD",i.toString().length<2?"0"+i:i).replace("D",i).replace("MMM",$this.Culture.MonthNames[n]).replace("MM",n.toString().length<2?"0"+n:n).replace("M",n).replace("YYYY",r).replace("YY",r.toString().substring(2,2)).replace("Y",r).replace("HH",a.toString().length<2?"0"+a:a).replace("hh",a).replace("mm",o.toString().length<2?"0"+o:o).replace("ss",s.toString().length<2?"0"+s:s)},this.Editable={EditMode:!1,RemoveWaiting:function(){var t=document.querySelectorAll(".editable-waiting");t.forEach(function(t){t.classList.remove("editable-waiting")})},RemoveEdits:function(){if(!$this.Editable.EditMode){var t=document.querySelectorAll(".editable-editing");t.forEach(function(t){t.innerHTML=t._innerHTML,t.classList.remove("editable-editing")}),$this.Editable.RemoveWaiting()}},AddEdits:function AddEdits(EditableElement){EditableElement._innerHTML=EditableElement.innerHTML;var ValuePrev=EditableElement.querySelector(".editable-value").innerHTML;EditableElement.classList.add("editable-editing"),EditableElement.dataset.value=ValuePrev;var SaveButton=$this.Editable.EditMode?"":'<div class="editable-helper editable-save-button"></div>';if(EditableElement.dataset.object){var string_Select='<select class="select editable-helper editable-editor editable-select">',SelectData=eval(EditableElement.dataset.object),Property=EditableElement.dataset.property,SelectOptions="";SelectData.forEach(function(t){var e="";if(("undefined"==typeof t?"undefined":_typeof(t))===_typeof({})){for(var i in t)e+=" data-property_"+i+'="'+t[i]+'"';string_Select+='<option class="editable-helper" '+e+">"+t[Property]+"</option>"}else string_Select+='<option class="editable-helper" '+(t===ValuePrev?"selected":"")+">"+t+"</option>"}),string_Select+="</select>"+SaveButton+"</div>",EditableElement.innerHTML=string_Select}else{var EditType=EditableElement.dataset.type;"undefined"==typeof EditType&&(EditType="text"),EditableElement.innerHTML='<input class="textbox editable-helper editable-editor editable-textbox" type="'+EditType+'" value="'+ValuePrev+'"> '+SaveButton,EditableElement.querySelector(".editable-editor").focus(),EditableElement.querySelector(".editable-editor").select()}},Save:function(t,e){var i=t.closest(".mt-content"),n=i.MonsieurController,r=t.dataset.line,a=t.dataset.property,o=n.Data[r];return""===e||null===e||"undefined"==typeof e?(console.info("New Value is empty"),void Lure.ErrorHint(t,"Пустое поле или неправильные данные")):(t.innerHTML=t._innerHTML,t.dataset.value=e,t.querySelector(".editable-value").innerHTML=e,t.classList.remove("editable-editing"),"$this"!==a&&"$item"!==a?o[a]=e:o=e,void n.LineSave(r,a,e,function(){Lure.Editable.RemoveWaiting(),"$this"!==a&&"$item"!==a?n.Data[r][a]=e:n.Data[r]=e}))}},this.Settings={DialogBlur:null,DialogAnimation:"lure-animation-dialog",EditableClass:"editable",EditableWaiting:"editable-waiting"},this.Culture={MonthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],MonthNamesShort:["янв.","фев.","мар.","апр.","май","июн.","июл.","авг.","сен.","окт.","ноя.","дек."],WeekDays:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],WeekDaysShort:["пн","вт","ср","чт","пт","сб","вс"]},this.TemplatorList=[],this.ContentList={},this._DialogCount=0}return _createClass(LureClass,[{key:"Perf",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Perf",i=Math.floor(100*(window.performance.now()-t))/100;return console.info("["+e+"]: "+i+"ms"),i}},{key:"Confirm",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Achtung",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.CaptionColor,r=void 0===n?"":n,a=i.CaptionBackground,o=void 0===a?"":a,s=i.OnAgree,l=void 0===s?function(){}:s,u=i.OnCancel,c=void 0===u?null:u;document.activeElement.blur();var d=document.createElement("div");d.classList.add("lure-confirm"),Lure.Settings.DialogAnimation&&d.classList.add(Lure.Settings.DialogAnimation);var h=document.createElement("div");h.classList.add("cd-caption"),h.innerHTML=t,h.style.color=r,h.style.background=o,d.appendChild(h);var f=document.createElement("div");f.classList.add("cd-text"),f.innerHTML=e,d.appendChild(f);var p=document.createElement("div");p.classList.add("cd-buttons"),d.appendChild(p);var g=document.createElement("div");if(g.classList.add("button","cd-button","btn-diag-confirm"),g.innerHTML="Ok",g.onclick=function(){Lure._DialogCount--,null!==l&&void 0!==l&&l(),Lure.Settings.DialogBlur&&Lure._DialogCount<1&&Lure.Select(Lure.Settings.DialogBlur).classList.remove("lure-blur"),m.remove(),d.remove()},d.getElementsByClassName("cd-buttons")[0].appendChild(g),null!==c){var v=document.createElement("div");v.classList.add("button","cd-button","btn-diag-cancel"),v.innerHTML="Отмена",v.onclick=function(){Lure._DialogCount--,null!==c&&c(),Lure.Settings.DialogBlur&&Lure._DialogCount<1&&Lure.Select(Lure.Settings.DialogBlur).classList.remove("lure-blur"),m.remove(),d.remove()},d.getElementsByClassName("cd-buttons")[0].appendChild(v)}var m=document.createElement("div");m.classList.add("ConfirmDialog-wrapper"),document.body.appendChild(m),document.body.appendChild(d),Lure._DialogCount++,Lure.Settings.DialogBlur&&(m.style.background="none",Lure.Select(Lure.Settings.DialogBlur).classList.add("lure-blur"))}},{key:"NoFeature",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""!==t&&(t='"'+t+'"'),this.Confirm("Error","Sorry, function "+t+" is not available yet")}},{key:"ErrorHint",value:function(t,e){e||(e="Поле не может быть пустым");var i=document.createElement("div");i.classList.add("lure-error-hint"),i.innerHTML=e,t.parentElement.style.position="relative",t.parentElement.appendChild(i),i.style.display="block";try{i.animate({opacity:[0,1]},{duration:300})}catch(n){}setTimeout(function(){try{i.animate({opacity:[1,0]},{duration:300}).onfinish=function(){i.style.display="none"}}catch(e){i.style.display="none"}setTimeout(function(){t.parentElement.style.position="",i.remove()},500)},2e3)}}]),LureClass}();return new LureClass}();Lure.Diagnostics={},Lure.Diagnostics.Perf=function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_classCallCheck(this,t);var i=performance.now(),n=i;this.Reset=function(){return i=performance.now(),n=i,0},this.Elapsed=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Perf";if(!e)return 0;var n=(performance.now()-i).toFixed(2);return console.info("["+t+"]: "+n+"ms"),n},this.Perf=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Perf";if(!e)return 0;var i=performance.now(),r=(i-n).toFixed(2);return console.info("["+t+"]: "+r+"ms"),n=i,r}},Lure.Plugin.Content={Version:"0.9.1",Content:function(){function LureContent(_ref2){function MakeContent(t){null===Controller||Array.isArray(Controller.Data)?this.Content=Lure.CreateElementFromString(t):null===Controller||Array.isArray(Controller.Data)||(t=t.replace(/>[^>]*({{[^#}]+}})[^>]*</g,function(t,e){var i=t.replace(/{{[^#}]+}}/g,function(t){return"<span>"+t+"</span>"});return i}),this.Content=Lure.CreateElementFromString(t)),this.Target.appendChild(this.Content)}function construct(){this.Type=Type,this.Name=Name,this.AllContents=Lure.ContentList,this.Refresh=Refresh.bind(this),this.Select=function(t){return Lure.Select(t,$this.Content)},this.SelectAll=function(t){return Lure.SelectAll(t,$this.Content)},this.GetParent=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=$this;null!==e.Parent&&e.Name!==t;)e=e.Parent;return e},this.GetContent=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",e=this.GetParent(t);if(e.Name===t)return e;var i=e;if("root"===t)return i;var n=function r(e){for(var n in e)if("Parent"!==n&&e[n]&&e[n].isContent){if(e[n].Name===t)return e[n];i=r(e[n])}return i};return n(i)},this.GetIndex=function(t){return t=$this.Select(t),Array.prototype.slice.call(t.parentElement.children).indexOf(t)},this.AddEventListener=function(t,e,i){Lure.AddEventListenerGlobal(t,e,i,$this.Content,$this)},this.AddTutor=function(t){$this.MonsieurTutor=new MonsieurTutor($this.Select(t),$this.Content)},this._SortBy=function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(e.length<2)){console.log("sort by",t),e.sort(function(e,i){return e[t]<i[t]&&$this._Sorting[t].Sorted?1:e[t]>i[t]&&$this._Sorting[t].Sorted?-1:e[t]<i[t]&&!$this._Sorting[t].Sorted?-1:e[t]>i[t]&&!$this._Sorting[t].Sorted?1:0}),$this._Sorting[t].Sorted=!$this._Sorting[t].Sorted;for(var i in $this._Sorting)$this._Sorting.hasOwnProperty(i)&&"_sorter"!==i&&($this._Sorting[i].Target.classList.remove("mt-sorting-up"),$this._Sorting[i].Target.classList.remove("mt-sorting-down"),t!==i&&($this._Sorting[i].Sorted=!1));$this._Sorting[t].Target.classList.add($this._Sorting[t].Sorted?"mt-sorting-down":"mt-sorting-up"),$this.Refresh()}},this._FilterBy=function(){var t=performance.now(),e=0,i=$this._Filter._DataDefault.slice(0),n=function(t){$this._Filter.hasOwnProperty(t)&&$this._Filter[t].Filter&&""!==$this._Filter[t].Filter&&(i=i.filter(function(e){return e[t].toString().toLowerCase().indexOf($this._Filter[t].Filter)>-1}),e++)};for(var r in $this._Filter)n(r);console.log(i),0===e?($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,$this.Controller._Data)),$this.Controller.Refresh()):($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,i)),$this.Controller.PageSize=$this._PageSize,$this.Controller._PageCursor=0,$this.Controller._Rebuilder(i)),mr.PerformanceNow(t,"FilterBy")},Props.call(this);for(var k in GetSet)Object.defineProperty($this,k,Object.getOwnPropertyDescriptor(GetSet,k));if(Methods.call(this),this.Show=function(e){this.isActive=!0,this.Control&&this.Control.Active();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));if(duration<durationAni&&(duration=durationAni),duration++,"Untyped"===$this.Type||$this.isVisible||Lure.ContentList[$this.Type].forEach(function(t){t!==$this&&t.isActive&&t.Hide()}),Dialog){if(Lure._DialogCount++,$this.Content.classList.add("lure-dialog"),DialogWrapper){$this.DialogWrapper=Lure.CreateElementFromString('<div class="dialog-wrapper">'),document.body.appendChild($this.DialogWrapper),$this.DialogWrapper.onclick=$this.Hide.bind($this);var zIndexWrapper=parseInt(window.getComputedStyle($this.DialogWrapper).zIndex),zIndexContent=parseInt(window.getComputedStyle($this.Content).zIndex);(Number.isNaN(zIndexContent)||zIndexContent<zIndexWrapper)&&($this.Content.style.zIndex=zIndexWrapper+1)}DialogBlur&&($this.DialogWrapper.style.background="none",Lure.Select(DialogBlur).classList.add("lure-blur")),DialogAnimation&&$this.Content.classList.add(DialogAnimation)}BeforeShow.call($this,e),Shower.call($this,e),$this.Content.style.display="",clearTimeout($this.__private.ToggleTimer),null!==Show&&($this.__private.ToggleTimer=setTimeout(function(){Show.call($this,e)},duration))},this.Hide=function(e){this.isActive=!1,this.Control&&this.Control.Disactive();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));duration<durationAni&&(duration=durationAni),duration++,Dialog&&(Lure._DialogCount--,$this.DialogWrapper&&$this.DialogWrapper.remove(),DialogBlur&&Lure._DialogCount<1&&Lure.Select(DialogBlur).classList.remove("lure-blur")),Hider.call($this,e),clearTimeout($this.__private.ToggleTimer),null!==Hide&&($this.__private.ToggleTimer=setTimeout(function(){Hide.call($this,e)},duration))},this.Toggle=function(t){$this.isVisible?$this.Hide(t):$this.Show(t)},this.__private={},this.__private.ToggleTimer=null,this.Control=new Lure.Plugin.Content.Control(Control,$this),this.Content.onclick=OnClick?OnClick.bind($this):null,Array.isArray(SubContent))for(var i=0;i<SubContent.length;i++)SubContent[i].Parent||(SubContent[i].Parent=$this),$this[SubContent[i].Name]=new Lure.Content(SubContent[i]);else for(var cname in SubContent)SubContent[cname].Parent=$this,SubContent[cname].Name=cname,$this[cname]=new Lure.Content(SubContent[cname]);if(this.TitleContent=Lure.Select(Title,this.Content),"Untyped"!==Type||Visible===!1||Dialog?("Untyped"!==Type&&Visible!==!0||Dialog&&Visible!==!0)&&(Visible=!1):Visible=!0,Visible?(this.Content.style.display="",this.Control&&this.Control.Active()):(this.isActive=!1,this.Content.style.display="none"),Controller&&(Controller.isController?(this.Controller=Controller,this.Controller.Parent=this):(Controller.Target||(Controller.Target=this.Content),Controller.Type||(Controller.Type="Templator"),Controller.Parent=this,this.Controller=new Lure.Plugin.Content.Controller[Controller.Type](Controller)),this.Controller.isHasEditable&&Lure._EditablesEventListenerRun($this.Content)),Sorting){$this._Sorting={},$this._Sorting._sorter=null;var _loop2=function(t){Sorting.hasOwnProperty(t)&&"_sorter"!==t&&($this._Sorting[t]={Target:$this.Select(Sorting[t]),Sorted:!1},$this._Sorting[t].Target.classList.add("mt-sorting"),$this._Sorting[t].Target.addEventListener("click",function(){$this._Sorting._sorter=t,$this._SortBy(t,$this.Controller._Data)}))};for(var f in Sorting)_loop2(f);console.info("mt-sortable",$this._Sorting)}if(Filtering){$this._Filter={},$this._Filter._DataDefault=$this.Controller._Data.slice(0);var _loop3=function(t){Filtering.hasOwnProperty(t)&&"_format"!==t&&($this._Filter[t]={Target:$this.Select(Filtering[t]),Filter:""},$this._Filter[t].Target.classList.add("mt-filtering"),$this._Filter[t].Target.innerHTML='<input type="text" class="mt-filtering-input">',$this._Filter[t].Target.querySelector(".mt-filtering-input").addEventListener("keyup",function(e){$this._Filter[t].Filter=e.target.value.toLowerCase(),$this._FilterBy()}))};for(var f in Filtering)_loop3(f)}Lure.ContentList[$this.Type]||(Lure.ContentList[$this.Type]=[]),Lure.ContentList[$this.Type].push(this),Array.from(this.Content.children).forEach(function(t){t.classList.contains("close")&&(t.onclick=function(t){$this.Hide(t)})}),setTimeout(function(){AfterBuild.call($this)},1)}var _ref2$Target=_ref2.Target,Target=void 0===_ref2$Target?null:_ref2$Target,_ref2$Content=_ref2.Content,Content=void 0===_ref2$Content?null:_ref2$Content,_ref2$CSS=_ref2.CSS,CSS=void 0===_ref2$CSS?"":_ref2$CSS,_ref2$Name=_ref2.Name,Name=void 0===_ref2$Name?null:_ref2$Name,_ref2$Global=_ref2.Global,Global=void 0!==_ref2$Global&&_ref2$Global,_ref2$Title=_ref2.Title,Title=void 0===_ref2$Title?"":_ref2$Title,_ref2$Type=_ref2.Type,Type=void 0===_ref2$Type?"Untyped":_ref2$Type,_ref2$Visible=_ref2.Visible,Visible=void 0===_ref2$Visible?void 0:_ref2$Visible,_ref2$SubContent=_ref2.SubContent,SubContent=void 0===_ref2$SubContent?[]:_ref2$SubContent,_ref2$Dialog=_ref2.Dialog,Dialog=void 0!==_ref2$Dialog&&_ref2$Dialog,_ref2$DialogWrapper=_ref2.DialogWrapper,DialogWrapper=void 0===_ref2$DialogWrapper||_ref2$DialogWrapper,_ref2$DialogBlur=_ref2.DialogBlur,DialogBlur=void 0===_ref2$DialogBlur?null:_ref2$DialogBlur,_ref2$DialogAnimation=_ref2.DialogAnimation,DialogAnimation=void 0===_ref2$DialogAnimation?null:_ref2$DialogAnimation,_ref2$Show=_ref2.Show,Show=void 0===_ref2$Show?null:_ref2$Show,_ref2$Hide=_ref2.Hide,Hide=void 0===_ref2$Hide?null:_ref2$Hide,_ref2$Shower=_ref2.Shower,Shower=void 0===_ref2$Shower?function(){this.Content.style.display=""}:_ref2$Shower,_ref2$Hider=_ref2.Hider,Hider=void 0===_ref2$Hider?function(){this.Content.style.display="none"}:_ref2$Hider,_ref2$BeforeShow=_ref2.BeforeShow,BeforeShow=void 0===_ref2$BeforeShow?function(){}:_ref2$BeforeShow,_ref2$Refresh=_ref2.Refresh,Refresh=void 0===_ref2$Refresh?function(t,e){this.Controller&&this.Controller.Refresh(t,e)}:_ref2$Refresh,_ref2$Sorting=_ref2.Sorting,Sorting=void 0!==_ref2$Sorting&&_ref2$Sorting,_ref2$Filtering=_ref2.Filtering,Filtering=void 0!==_ref2$Filtering&&_ref2$Filtering,_ref2$OnClick=_ref2.OnClick,OnClick=void 0===_ref2$OnClick?null:_ref2$OnClick,_ref2$Controller=_ref2.Controller,Controller=void 0===_ref2$Controller?null:_ref2$Controller,_ref2$Control=_ref2.Control,Control=void 0===_ref2$Control?null:_ref2$Control,_ref2$Props=_ref2.Props,Props=void 0===_ref2$Props?function(){}:_ref2$Props,_ref2$Methods=_ref2.Methods,Methods=void 0===_ref2$Methods?function(){}:_ref2$Methods,_ref2$GetSet=_ref2.GetSet,GetSet=void 0===_ref2$GetSet?{}:_ref2$GetSet,_ref2$AfterBuild=_ref2.AfterBuild,AfterBuild=void 0===_ref2$AfterBuild?function(){}:_ref2$AfterBuild,_ref2$Disabled=_ref2.Disabled,Disabled=void 0!==_ref2$Disabled&&_ref2$Disabled,_ref2$Parent=_ref2.Parent,Parent=void 0===_ref2$Parent?null:_ref2$Parent;if(_classCallCheck(this,LureContent),!Disabled){var $this=this;if(this.isContent=!0,this.isActive=!0,this.Parent=Parent,null!==Parent?(this.Target=Global?Lure.Select(Target):Lure.Select(Target,this.Parent.Content),null===this.Target&&(this.Target=this.Parent.Content)):null!==Target&&(this.Target=Lure.Select(Target)),null===Content?(this.Content=this.Target,construct.call($this)):null===Content.match(/<[^>]+>/)?(console.log("get load"),Lure.GetFileText(Content).then(function(t){MakeContent.call($this,t),construct.call($this)})):(MakeContent.call($this,Content),construct.call($this)),null===this.Content||null===this.Target)return void(this.isContent=!1);if(""!==CSS){var node=document.createElement("style");node.innerHTML=CSS,document.body.appendChild(node)}}}return _createClass(LureContent,[{key:"RefreshOne",value:function(t){this.Controller&&this.Controller.RefreshOne(t)}},{key:"Remove",value:function(t,e){this.Controller&&this.Controller.Remove(t,e)}},{key:"Add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.Controller&&this.Controller.Add(t,e,i,n)}},{key:"Edit",value:function(t,e){this.Controller&&this.Controller.Edit(t,e)}},{key:"Dispose",value:function(){this.Content.remove(),this.Control.Disactive(),delete this.Controller,delete this.Control}},{key:"isVisible",get:function(){return Lure.isVisible(this.Content)}},{key:"Title",get:function(){return this.TitleContent.innerHTML},set:function(t){this.TitleContent.innerHTML=t}},{key:"Data",get:function(){return this.Controller?this.Controller.Data:null},set:function(t){this.Controller&&(this.Controller.Data=t)}},{key:"Items",get:function(){return this.Controller?this.Controller.Items:null}}]),LureContent}(),Control:function(){function t(e,i){var n=this;_classCallCheck(this,t),null!==e&&e.length>0&&!function(){for(var t=n,r=function(n){e[n].Name||(e[n].Name="unnamed_"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10)),t[e[n].Name]={Content:Lure.SelectAll(e[n].Target),_Content:e[n].Target,Type:e[n].Type?e[n].Type:"Untyped",isGlobal:e[n].Global,OnClick:e[n].OnClick?e[n].OnClick:i.Show,OnChange:e[n].OnChange,Active:function(){Lure.SelectAll(e[n].Target).forEach(function(t){t.classList.add("active")})},Disactive:function(){Lure.SelectAll(e[n].Target).forEach(function(t){t.classList.remove("active")})}},t[e[n].Name].Content.forEach(function(t){t.classList.add("pointer")}),e[n].Global?Lure.AddEventListenerGlobal("click",e[n].Target,function(r){Lure.SelectAll(e[n].Target).forEach(function(t){t.classList.remove("active")}),r.target.classList.add("active"),t[e[n].Name].OnClick&&t[e[n].Name].OnClick.call(i,r)}):t[e[n].Name].Content.forEach(function(r){r.onclick=function(r){Lure.ContentList[i.Type].forEach(function(t){t!==i&&t.Control&&t.Control.Disactive()}),t[e[n].Name].Content.forEach(function(t){t.classList.remove("active")}),r.currentTarget.classList.add("active"),t[e[n].Name].OnClick.call(i,r)}}),e[n].OnChange&&(e[n].Global?Lure.AddEventListenerGlobal("change",e[n].Target,function(t){e[n].OnChange.call(i,t)}):t[e[n].Name].Content.forEach(function(t){
t.onchange=function(t){e[n].OnChange.call(i,t)}}))},a=0;a<e.length;a++)r(a)}()}return _createClass(t,[{key:"Active",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var e in this)this[e].Type===t&&this[e].Content.forEach(function(t){t.classList.add("active")})}},{key:"Disactive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var e in this)this[e].Type===t&&(this[e].Content.forEach(function(t){t.classList.remove("active")}),this[e].isGlobal&&Lure.SelectAll(this[e]._Content).forEach(function(t){t.classList.remove("active")}))}}]),t}(),Controller:{Templator:function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.Target,n=void 0===i?null:i,r=e.Data,a=void 0===r?[]:r,o=e.ListElement,s=void 0===o?".list_element":o,l=e.EmptyMessage,u=void 0===l?"":l,c=e.EmptyHide,d=void 0!==c&&c,h=e.PageSize,f=void 0===h?-1:h,p=e.DataCount,g=void 0===p?-1:p,v=e.PageGet,m=void 0===v?null:v,C=e.ShowAllButton,b=void 0===C||C,S=e.LineSave,y=void 0===S?function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};setTimeout(function(){n()},500)}:S,_=e.LineAdd,L=void 0===_?function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};setTimeout(function(){e()},500)}:_,T=e.EditModeSwitch,$=void 0===T?null:T,D=(e.DataSaveAll,e.NoAnimation),x=void 0!==D&&D,A=e.NoBuild,O=void 0!==A&&A,E=e.BeforeBuild,k=void 0===E?function(){}:E,w=e.AfterBuild,P=void 0===w?function(){}:w,M=e.AfterAdd,B=void 0===M?function(){}:M,H=e.Parent,G=void 0===H?null:H;_classCallCheck(this,t);var F=this;this.isController=!0,null!==G?this.Content=Lure.Select(n,G.Content):this.Content=Lure.Select(n),this.Target=this.Content,this._Data=a,this.EmptyMessage=u,this.ListElement="",this.BeforeBuild=k.bind(this),this.AfterBuild=P.bind(this),this.AfterAdd=B.bind(this),this.Parent=G,this.PageSize=f,this._PageSize=f,this._DataCount=g>0?g:this._Data.length,this._PageCursor=0,this._PageGet=m,this.LineAdd=L,this.LineSave=y,this.Type=null,this.isShowAllButton=b,this.isNoAnimaton=x,this.isEmptyHide=d;var N=[];this._Dictionary=N;var W=function(){F._Data||(F._Data={});for(var t=0;t<N.length;t++)for(var e=0;e<N[t].fields.length;e++){var i=N[t].fields[e].Target.indexOf("attributes")>-1,n=N[t].fields[e].BuildValue(F._Data);i?N[t].obj.attributes[N[t].fields[e].Target.split(".")[1]].value=n:N[t].obj[N[t].fields[e].Target]=N[t].fields[e].BuildValue(F._Data)}};this._Rebuilder=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F._Data,e="";0===F._PageCursor&&F.Content.querySelectorAll(".mt-line, .mt-paginator, .mt-empty").forEach(function(t){t.remove()});var i=void 0,n=t.length;if(F._DataCount=g>0?g:n,F.PageSize>0){F._DataCount=F._DataCount>0?F._DataCount:t.length;var r=F.Content.querySelector(".mt-paginator");null!==r&&r.remove(),n=parseInt(F._PageCursor)+parseInt(F.PageSize),n>F._DataCount&&F._DataCount>0&&(n=F._DataCount),i=F._DataCount-n,i>F.PageSize&&(i=F.PageSize)}if("ItemList"===F.Type&&0===t.length&&""!==F.EmptyMessage&&!F.isEmptyHide){var a=F.ListElement.match(/\s?([\w]+) /)[0].replace(/\s/g,""),o=document.createElement(a);return o.classList.add("mt-empty"),o.innerHTML=F.EmptyMessage,void F.Content.appendChild(o)}if("ItemList"===F.Type&&0===t.length&&F.isEmptyHide)return void(F.Content.style.display="none");if(0!==t.length){for(var s=F._PageCursor;s<n;s++)e+=F._LineBuilder(t[s],s,t.length);if(F.Content.children.length<1?F.Content.innerHTML=e:(e=Lure.CreateElementsFromString(e,F.Content.tagName),null!==e&&e.forEach(function(t){F.Content.appendChild(t)})),F.PageSize>0&&(F._PageCursor=n),F.PageSize>0&&F._PageCursor<F._DataCount){var l=void 0,u="<span>  (Не загружено "+(F._DataCount-F._PageCursor)+") </span>";F.isShowAllButton&&(u='<span> или </span><span class="mt-btn-nextAll dotted pointer"> Все ( '+(F._DataCount-F._PageCursor)+" )</span>");var c="table"===F.Content.tagName||"thead"===F.Content.tagName||"tbody"===F.Content.tagName;if(c){var d=F.Content.querySelector("tr:first-child th").length+1;l='<tr class="mt-paginator"><td colspan="'+d+'" class="element block-head"><span class="tpltr-next dotted pointer">Показать еще '+i+"</span>"+u+"</td></tr>",l=Lure.CreateElementFromString(l,F.Content.tagName)}else l=Lure.CreateElementFromString("<div class='mt-paginator'><span class=\"mt-btn-next dotted pointer\">Показать еще "+i+"</span>"+u+"</div>");var h=l.querySelector(".mt-btn-next");h.onclick=function(){F._PageCursor>=t.length?F._PageGet(F._PageCursor,F.PageSize,V):I()};var f=l.querySelector(".mt-btn-nextAll");f.onclick=function(){F.PageSize=F._DataCount,null!==F._PageGet?F._PageGet(F._PageCursor,F._DataCount-F._PageCursor,V):I()},F.Content.appendChild(l)}}};var I=function(){F.BeforeBuild(),"Refresh"===F.Type?W():"ItemList"===F.Type&&F._Rebuilder(),F.AfterBuild()},V=function(t){for(var e=0;e<t.length;e++)F._Data.push(t[e]);I()};if(this.FieldAdd=function(t){for(var e=t.attributes,i=[],n=-1,r=0;r<e.length;r++)e[r].value.indexOf("{{")>-1&&("value"!==e[r].name?i.push({Target:"attributes."+e[r].name,BuildValue:Lure.Compile(e[r].value)}):i.push({Target:e[r].name,BuildValue:Lure.Compile(e[r].value)}),n=0);t.childNodes.length<2&&t.innerHTML.indexOf("{{")>-1&&(i.push({Target:"innerHTML",BuildValue:Lure.Compile(t.innerHTML)}),n=0!==n?1:2),n>-1&&N.push({obj:t,fields:i})},this.Refresh=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;F.PageSize=F._PageSize,F._PageCursor=0,null!==t&&(F._Data=t),F.PageCursor=0,null===e?I():F.RefreshOne(e)},this.RefreshOne=function(t){var e=Lure.CreateElementFromString(F._LineBuilder(F._Data[t],t,F._Data.length),F.Content.tagName),i=F.Items[t];F.Items[t].parentNode.replaceChild(e,i)},this.Add=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];0===F._Data.length&&null!==F.Content.querySelector(".mt-empty")&&F.Content.querySelector(".mt-empty").remove();var r=document.createDocumentFragment(),a=document.createElement(F.Content.tagName),o=void 0;if(i){for(o=0,F.Items.forEach(function(t){console.log(t),console.log(t.dataset.line),t.dataset.line=parseInt(t.dataset.line)+1}),a.innerHTML=F._LineBuilder(t,0,F._Data.length+1);a.childNodes[0];)r.appendChild(a.childNodes[0]);e&&r.children[0].classList.add(e),n&&F._Data.unshift(t),F.Content.prepend(r)}else{for(o=F._Data.length,n||o--,a.innerHTML=F._LineBuilder(t,o,o+1);a.childNodes[0];)r.appendChild(a.childNodes[0]);e&&r.children[0].classList.add(e),n&&F._Data.push(t),F.Content.appendChild(r)}null!==F.LineAdd&&F.LineAdd(t,function(){var t=F.Content.querySelector("."+e);t&&t.classList.remove(e)}),F.AfterAdd(t,o)},this.Edit=function(t,e){console.log("edit itemData",e,t),Array.from(F.Items).filter(function(t){return parseInt(t.dataset.line)===e})[0].classList.add("editable-waiting"),F.LineSave(e,"$this",t,function(){F._Data[e]=t,F.RefreshOne(e)})},this.Remove=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];F.Content.querySelector('.mt-line[data-line="'+t+'"]').remove();for(var i=t;i<F.Items.length;i++)F.Items[i].dataset.line=parseInt(F.Items[i].dataset.line)-1,F.Items[i].querySelectorAll("[data-line]").forEach(function(t){t.dataset.line=parseInt(t.dataset.line)-1});e&&F._Data.splice(t,1),0===F._Data.length&&F.Refresh()},this.SwitchToEditMode=function(){Lure.Editable.EditMode=!0,Lure.SelectAll(".editable",F.Content).forEach(function(t){Lure.Editable.AddEdits(t)})},Array.isArray(this._Data)){this.Type="ItemList";var R=null!==s.match(/^[a-zA-Z0-9.,\-_ *#]+$/g);if(R){var Y=this.Content.querySelector(s);Y.classList.add("mt-line"),s=Y.outerHTML,Y.remove()}else{var j=s.match(/<[^>]+>/)[0],z=void 0,q=j.indexOf('class="');q<0?z=j.substr(0,j.length-1)+' class="mt-line"'+j.substr(j.length-1):(q=j.indexOf('"',q+8),z=j.substr(0,q)+" mt-line"+j.substr(q)),s=s.replace(j,z)}s=s.replace(/<[\s\S]+?(>)/,function(t,e){return t.replace(e,' data-line="{{i}}">')}),this.ListElement=s,this._LineBuilder=Lure.Compile(s,!0),null!==s.match(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/)&&(this.isHasEditable=!0,null!==$&&Lure.Select($).addEventListener("change",function(t){t.currentTarget.checked?F.SwitchToEditMode():(Lure.Editable.EditMode=!1,document.body.click())})),this.Content.MonsieurController=this,this.Content.classList.add("mt-content")}else{this.Type="Refresh";var X=Array.prototype.slice.call(this.Content.querySelectorAll("*:not(g):not(path):not(clipPath):not(text):not(br)"));X.push(this.Content),X.forEach(function(t){F.FieldAdd(t)})}Lure.TemplatorList.push(this),O||I()}return _createClass(t,[{key:"Data",get:function(){return this._Data},set:function(t){this._Data=t}},{key:"Items",get:function(){return this.Content.querySelectorAll(".mt-line")}}]),t}(),TreeBuilder:function(){function t(e){var i=e.Target,n=void 0===i?null:i,r=e.Data,a=void 0===r?[]:r,o=e.ListElement,s=void 0===o?null:o,l=e.Drop,u=void 0!==l&&l,c=e.SubSelector,d=void 0===c?null:c,h=e.SubSelectorHandler,f=void 0===h?function(){}:h,p=e.BeforeBuild,g=void 0===p?function(){}:p,v=e.AfterBuild,m=void 0===v?function(){}:v,C=e.Parent,b=void 0===C?null:C;_classCallCheck(this,t),this.isController=!0,this.Content=Lure.Select(n),this.Target=this.Content,this.Parent=b,this._Data=a,this.SubSelector=d,this.SubSelectorHandler=f.bind(this),this.BeforeBuild=g.bind(this),this.AfterBuild=m.bind(this);var S=u?"mtb-sub_tree dropable":"mtb-sub_tree",y=0,_=null===s?this.Content.innerHTML:s;null===this.SubSelector&&(this.SubSelector=".mtb-sub_tree",_=_.replace(/^([\s\S]*)(<\/\w+>)$/,function(t,e,i){return i='<div class="'+S+'"></div>'+i,e+i})),this.LineBuilder=Lure.Compile(_,!0);var L=this,T=0,$=function x(t,e,i){T++;var n={$lvl:y,$key:e,$index:T,$j:i},r=Lure.CreateElementFromString(L.LineBuilder(t,T,null,n));r.classList.add("mtb-branch");for(var a in t){var o=t[a];if(Array.isArray(o)){y++;for(var s=0;s<o.length;s++)if(null===L.SubSelector)r.appendChild(x(o[s],a,s));else{r.classList.add("mtb-has_tree"),u&&r.classList.add("dropable");var l=r.querySelector(L.SubSelector);l.appendChild(x(o[s],a,s))}y--}}return r},D=function(){if(L.BeforeBuild(),Array.isArray(L._Data)){L.Content.innerHTML="",y++;for(var t=0;t<L._Data.length;t++)L.Content.appendChild($(L._Data[t],"root",0));y--}else L.Content.appendChild($(L._Data,"root",0));y=0,T=0,L.AfterBuild()};D(this._Data),this.Refresh=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L._Data;L._Data=t,D()}}return _createClass(t,[{key:"Data",get:function(){return this._Data},set:function(t){this._Data=t}}]),t}()}},Lure.Content=Lure.Plugin.Content.Content,Lure.Plugin.Tutor=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,e);var n=this;this.TargetButton=Lure.Select(t),this.TargetContent=Lure.Select(i);var r='<div class="lure-tutor">\n                        <div class="cd-caption">\n                            <span>Шаг </span>\n                            <span class="lure-tutor_step"></span>\n                        </div>\n                        <div class="lure-tutor_desc"></div>\n                        <div class="lure-tutor_btns">\n                            <button class="button btn-tutor btn-tutor-stop">Прервать обучение</button>\n                            <button class="button btn-tutor btn-tutor-next">Далeе →</button></div>\n                   </div>';this.Content=Lure.CreateElementFromString(r),this.ContentBG=Lure.CreateElementFromString('<div class="lure-tutor-bg dialog-wrapper"></div>'),this.Content.style.display="none",this.ContentBG.style.display="none",this._Description=this.Content.querySelector(".lure-tutor_desc"),this._Step=this.Content.querySelector(".lure-tutor_step"),this._ButtonNext=this.Content.querySelector(".btn-tutor-next"),this._ButtonStop=this.Content.querySelector(".btn-tutor-stop"),n.Data=[];var a=this._ButtonNext.innerHTML,o=0,s=document.createElement("div");s.style.display="none",document.body.appendChild(s);var l=window.getComputedStyle(s).backgroundColor;s.remove();var u=function(){var t=n.Data[o-1].obj;if("tr"!==t.tagName.toLowerCase())return t.style.zIndex="",t.style.position="",t.style.outline="",t.style.display="",void(t.style.backgroundColor="");var e=t.querySelectorAll("th, td");e.forEach(function(t){t.style.position="",t.style.zIndex=""})},c=function(t){if("tr"!==t.tagName.toLowerCase()){t.style.zIndex="11",t.style.position="relative",t.style.outline="5px #bee0ff solid";var e=window.getComputedStyle(t);return e.backgroundColor===l&&(t.style.backgroundColor="#fff"),void(Lure.isVisible(t)||("table"!==t.tagName.toLowerCase()?t.style.display="block":t.style.display="table"))}var i=t.querySelectorAll("th, td");i.forEach(function(t){t.style.zIndex="11",t.style.position="relative";var e=window.getComputedStyle(t);e.backgroundColor===l&&(t.style.backgroundColor="#fff")})},d=function(){if(console.log("tutor run"),null!==n.TargetContent){var t=n.TargetContent.querySelectorAll('*[data-tutor]:not([data-line]), *[data-tutor][data-line="0"]');if(t.length<1)return void Lure.Confirm("Сообщение","На этом экране нет подсказок");t.forEach(function(t){n.Data.push({obj:t,desc:t.dataset.tutor})}),n.Content.style.display="",n.ContentBG.style.display="",h()}},h=function(){if(o>0&&u(),o===n.Data.length)return void f();var t=n.Data[o].obj,e=n.Data[o].desc,i=e.match(/{([\s\S]+)}/);null!==i&&(i=i[1],e=e.replace(/{([\s\S]+)}/,""),t=t.closest(i),n.Data[o].obj=t),c(t),n._Step.innerHTML=o+1+"/"+n.Data.length,n._Description.innerHTML=e,o+1===n.Data.length&&(n._ButtonNext.innerHTML="Завершить",n._ButtonStop.style.opacity="0");var r=t.offsetLeft+t.clientWidth+10,a=t.offsetTop-n.Content.clientHeight-10;a<10&&(a=10),r+n.Content.clientWidth>window.innerWidth&&(r=t.offsetLeft-n.Content.clientWidth-10,window.innerWidth<n.Content.clientWidth+t.clientWidth&&(r=t.offsetLeft+t.clientWidth-n.Content.clientWidth-20)),(document.documentElement.scrollTop>a||document.documentElement.scrollTop+window.innerHeight<t.offsetTop+t.offsetHeight)&&(document.documentElement.scrollTop=a-10+"px"),r<10&&(r=10),n.Content.style.left=r+"px",n.Content.style.top=a+"px",o++},f=function(){u(),n.Content.style.display="none",n.ContentBG.style.display="none",n._ButtonNext.innerHTML=a,n._ButtonStop.style.opacity="",o=0,n.Data=[]};this.TargetButton.onclick=d,this._ButtonNext.onclick=h,this._ButtonStop.onclick=f,document.body.appendChild(this.Content),document.body.appendChild(this.ContentBG),this.Run=d},Lure.Plugin.Load=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.Target,n=void 0===i?"body":i;_classCallCheck(this,t),this.Target=Lure.Select(n),this.Target.style.position="relative",this.Content=Lure.CreateElementFromString('<div class="ajax-loading" style="display: none"></div>');var r=60,a=60,o=function(t,e){for(var i=" M "+(r+t)+" "+a,n=0;n<e;n++){var o=n*(Math.PI/180),s=r+Math.cos(o)*t,l=a+Math.sin(o)*t;i+=" L "+s+" "+l}return i},s='<svg xmlns="http://www.w3.org/2000/svg">\n                     <path d="'+o(45,160)+'" class="lure-arc1" fill="none" stroke="#449b22" stroke-width="5"></path>\n                     <path d="'+o(40,130)+'" class="lure-arc2" fill="none" stroke="#61c8de" stroke-width="5"></path>\n                     <path d="'+o(35,100)+'" class="lure-arc3" fill="none" stroke="#761c19" stroke-width="5"></path>\n                     <path d="'+o(30,70)+'"  class="lure-arc4" fill="none" stroke="#333333" stroke-width="5"></path>\n                   </svg>';this.Target.appendChild(this.Content),this.Content.innerHTML=s,this.Timeout=null}return _createClass(t,[{key:"Show",value:function(){var t=this;this.Content.style.display="",clearTimeout(this.TimeoutHide),this.Timeout=setTimeout(function(){t.Content.style.display="block"},70)}},{key:"Hide",value:function(){var t=this;clearTimeout(this.Timeout),this.TimeoutHide=setTimeout(function(){t.Content.style.display="none"},250)}}]),t}(),Lure.Plugin.Tooltip=function i(t){var e=t.Target,n=void 0===e?document:e,r=t.Attribute,a=void 0===r?"data-tooltip":r,o=t.Delay,s=void 0===o?400:o,l=t.Time,u=void 0===l?1100:l,c=(t.Cursor,t.Custom),d=void 0===c?'<div class="lure-tooltip">':c,h=t.AfterBuild,f=void 0===h?function(){}:h;_classCallCheck(this,i);var p=this;this.ToolTip=Lure.CreateElementFromString(d);var g=null,v=null;this.Target=Lure.Select(n);var m=function(t){this.ToolTip.innerHTML=t,p.Target.appendChild(this.ToolTip)}.bind(this);Lure.AddEventListenerGlobal("mouseover","["+a+"]",function(t){var e=t.currentTarget.dataset[a.replace("data-","")];clearTimeout(v),g=setTimeout(function(){m(e)},s)},this.Target),Lure.AddEventListenerGlobal("mouseout","["+a+"]",function(t){clearTimeout(g),v=setTimeout(function(){},u)},this.Target),setTimeout(function(){f.bind(p)},0)},Lure.Tutor=Lure.Plugin.Tutor,Lure.Load=Lure.Plugin.Load,Lure.Tooltip=Lure.Plugin.Tooltip,Lure.Plugin.Chart={Core:"",Chart:function(){function t(){function e(){y.SeriesBar=0,L.Series(),this.Block.Legend=y.Legend,L.AxisY(),L.AxisX(),_.AxisX(),L.ScaleY(),this.Block.Grid=_.MakeGrid(),this.Block.AxisY=_.MakeAxisY(),"line"!==this.Options.Type&&"bar"!==this.Options.Type||(this.Block.Svg=S.__GetSvgCasual()),"pie"!==this.Options.Type&&"ring"!==this.Options.Type||(this.Block.Svg=S.__GetSvgPie()),this.Block.AxisY.style.height=this.Height+"px";var t=Lure.SelectAll('.mt-chart-serie[data-type="Line"] path',this.Content);T.Height=this.Height,T.Width=this.Width,t.forEach(function(t){var e=t.getTotalLength();t.style.strokeDasharray=e,t.style.strokeDashoffset=e})}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.Type,a=void 0===r?"Line":r,o=n.Title,s=void 0===o?"":o,l=n.Labels,u=void 0===l?{Rotation:"auto",Data:[]}:l,c=n.Grid,d=void 0===c?{}:c,h=n.Series,f=void 0===h?[]:h,p=n.Tooltip,g=void 0===p?{Template:null}:p,v=n.AxisY,m=void 0===v?{Scale:["auto","auto","auto"],Visible:!0}:v;n.Height,n.SeriesOptions;_classCallCheck(this,t);var C=["red","green","cornflowerblue","purple","palevioletred","orange","tomato","darkblue"],b={Line:"Name: {{Name}}<br>Value: {{Value}}",Pie:"Name: {{Name}}<br>Value: {{Value}}"};Lure.Chart.Count++;var S=this;this.Content=Lure.Select(i),this.Content.classList.add("mt-chart"),this.Content.style.position="relative",this.isGraph=!0;var y={Legend:"",AxisX:"",AxisY:"",Grid:"",Svg:"",Height:0,Width:0,Abscissa:null,SeriesPoints:[],SeriesCount:{Line:0,Bar:0,Pie:0,Ring:0},SeriesBar:0,ParametersAxisX:null};this._Series=f,this.Options={Type:a?a.toLowerCase():"line",Title:s?s:"",Legend:{Visible:!0},Labels:{Visible:"undefined"==typeof u.Visible||u.Visible,Rotation:u.Rotation?u.Rotation:"auto",Data:u.Data?u.Data:[],Font:{Family:"sans-serif",Size:"0.8rem"}},Grid:{Visible:"undefined"==typeof d.Visible||d.Visible},Series:null,SeriesOptions:{BarStack:!1,BarGradient:!0,PieStack:!1,PieType:"pie"},AxisY:{Font:{Family:"sans-serif",Size:"0.8rem"},Scale:m.Scale?[Lure.isNumeric(m.Scale[0])?m.Scale[0]:"auto",Lure.isNumeric(m.Scale[1])?m.Scale[1]:"auto",Lure.isNumeric(m.Scale[2])?m.Scale[2]:"auto"]:["auto","auto","auto"],Visible:"undefined"==typeof m.Visible||m.Visible},Padding:0,Tooltip:{Template:null}},this.Block=function(){this.Content.innerHTML='<div class="mt-chart col">\n                                        <div class="mt-chart-caption">\n                                          <div class=\'mt-chart-title\'>'+s+'</div>\n                                          <div class="mt-chart-legend row"></div>\n                                        </div>\n                                        <div class="mt-chart-kek row flex-100">\n                                          <div class="mt-chart-y row"></div>\n                                          <div class="col flex-100">\n                                            <div class="mt-chart-area row flex-100">\n                                              <svg class="mt-chart-svg"></svg>\n                                              <div class="mt-chart-grid" style=" position: absolute;"></div>\n                                            </div>\n                                            <div class="mt-chart-x row"></div>\n                                           </div>\n                                        </div>\n                                      </div>';var t=this.Content.querySelector(".mt-chart-legend"),e=this.Content.querySelector(".mt-chart-x"),i=this.Content.querySelector(".mt-chart-y"),n=this.Content.querySelector(".mt-chart-area"),r=this.Content.querySelector(".mt-chart-grid"),a=this.Content.querySelector(".mt-chart-svg");return{get Legend(){return t},set Legend(e){t.innerHTML=e},get AxisX(){return e},set AxisX(t){e.innerHTML=t},get AxisY(){return i},set AxisY(t){i.innerHTML=t},get ChartArea(){return n},set ChartArea(t){n.innerHTML=t},get Grid(){return r},set Grid(t){r.innerHTML=t},get Svg(){return a},set Svg(t){a.innerHTML=t}}}.bind(this)();var _={Legend:function(){},AxisX:function(){if(!S.Options.Labels.Visible)return void(this.Block.AxisX="");for(var t=S.Options.Labels.Data,e="transform: translate("+y.AxisXParams.MarginLeft+"px) rotate("+y.AxisXParams.Angle+"deg); margin-top: "+y.AxisXParams.MarginTop+"px ; width: "+y.AxisXParams.Width+"px;",i="",n=0;n<t.length;n++)i+='<div class="mt-chart-label mt-chart-label__x" style="font-family: '+S.Options.Labels.Font.Family+"; font-size: "+S.Options.Labels.Font.Size+'"><span style="'+e+'">'+t[n]+"</span></div>";y.AxisX=i,this.Block.AxisX=i,this.Block.AxisX.style.borderTop="1px #111 solid"}.bind(this),AxisY:function(){return!this.Options.Labels.Visible,""}.bind(this),Make3Legend:function(t,e){return'<div class="mt-chart-legend__item row">\n                          <input class="mt-legend-checkbox" type="checkbox" checked="checked" id="legcheck'+t.Name+e+'">\n                          <div class="mt-legend-icon" style="background-color: '+t.Color+'"></div>\n                          <label class="mt-legend-label" for="legcheck'+t.Name+e+'">'+t.Name+"</label>\n                        </div>"},MakeAxisY:function(){var t=0;if(!S.Options.AxisY.Visible&&(t=1,S._ScaleY.Scales.length<2))return"";var e="font-family: "+S.Options.Labels.Font.Family+"; font-size: "+S.Options.Labels.Font.Size+";",i="";for(t;t<S._ScaleY.Scales.length;t++){var n=S._ScaleY.Dict.indexOf(t),r=S._ScaleY.Scales[t],a="";t>0&&(a='<div class="mt-chart-axis-caption"><div style="transform: rotate(-90deg)">'+S.Options.Series[n].Title+"</div></div>");for(var o="",s=0;s<r.length;s++)o+='<div class="mt-chart-label mt-chart-label__y"><span>'+r[s]+"</span></div>";t>0&&(e+=" color: "+S.Options.Series[n].Color+"; font-weight: bold;"),i+='<div class="mt-chart-axis__y row" style="'+e+'" data-line="'+t+'">'+a+'<div class="mt-chart-labels col">'+o+"</div></div>"}return i},MakeAxisX:function(){if(!S.Options.Labels.Visible)return"";for(var t=S.Options.Labels.Data,e="transform: translate("+y.AxisXParams.MarginLeft+"px) rotate("+y.AxisXParams.Angle+"deg); margin-top: "+y.AxisXParams.MarginTop+"px ; width: "+y.AxisXParams.Width+"px;",i="",n=0;n<t.length;n++)i+='<div class="mt-chart-label mt-chart-label__x" style="font-family: '+S.Options.Labels.Font.Family+"; font-size: "+S.Options.Labels.Font.Size+'"><span style="'+e+'">'+t[n]+"</span></div>";return i},MakeGrid:function(t,e){return S.Options.Grid.Visible?Lure.Chart.GetGrid(S.Options.Labels.Data.length,S._ScaleY.Scales[0].length-1,S.Options.Padding):""},MakeGraph:function(t,e){var i=S._ScaleY.Dict[e],n=S._ScaleY.Scales[i],r=S._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(t.Data,n,r,S.Height),o=Lure.Chart.GetAbscissa(S.Options.Labels.Data,S.Width),s=Lure.Chart.GetPoints(o,a);return Lure.Chart.GetPath(s,S.Options.Series[e].Type,e,S.Options.Series[e].Color,S.Options.Series[e].Width)},CalcAxi6sX:function(){var t=Lure.CreateElementFromString('<div class="mt-chart-label mt-chart-label__x"><span>'+S.Options.Labels.Data[0]+"</span></div>"),e=Lure.GetInlineSize(t,getComputedStyle(Lure.Select("span")).fontSize),i=S.Width/S.Options.Labels.Data.length;S.Options.Padding=i/2,S.Block.AxisX.style.paddingLeft=i/2+"px";var n=e.height,r=e.width,a=void 0;if("auto"!==S.Options.Labels.Rotation)a=parseFloat(S.Options.Labels.Rotation);else{var o=(i-n)/(r+n);o<.1&&(o=0),o>1&&(o=1),a=-90*(1-o)}return{Height:Math.round(n/4+Math.sqrt(Math.pow(r,2)-Math.pow(i,2))),Width:r,MarginTop:r>i?Math.sqrt(Math.pow(r,2)-Math.pow(i,2))-n:0,MarginLeft:r>i?-i/2:-r/2,Angle:a}}},L={Tooltip:function(){return g.Template?void(this.Options.Tooltip.Template=g.Template):"line"===this.Options.Type||"bar"===this.Options.Type?void(this.Options.Tooltip.Template=b.Line):"pie"===this.Options.Type||"ring"===this.Options.Type?void(this.Options.Tooltip.Template=b.Pie):void 0}.bind(this),Series:function(){var t=[];if(null===this.Options.Series){for(var e=0;e<this._Series.length;e++){var i={};i.Name=this._Series[e].Name?this._Series[e].Name:"Unnamed",i.Title=this._Series[e].Title?this._Series[e].Title:i.Name,i.Color=this._Series[e].Color?this._Series[e].Color:C[e]?C[e]:"#000",i.Width=this._Series[e].Width?this._Series[e].Width:2,i.Data=this._Series[e].Data,i.Type=this._Series[e].Type?this._Series[e].Type.toLowerCase():a?a.toLowerCase():"line","pie"!==i.Type&&"ring"!==i.Type||(i.Colors=this._Series[e].Colors?this._Series[e].Colors:C,i.Width=this._Series[e].Width?this._Series[e].Width:30,i.Labels=this._Series[e].Labels?this._Series[e].Labels:!!this.Options.Labels.Data&&this.Options.Labels.Data),i.Line=e,i.isVisible="undefined"==typeof this._Series[e].Visible||this._Series[e].Visible,i.OwnAxis=this._Series[e].OwnAxis,i.Point=this._Series[e].Point,i.Point=Lure.Chart.GetSeriePointOptions(i),y.Legend+=Lure.Chart.MakeLegend(i,e),y.SeriesCount[i.Type.capitalize()]++,t.push(i)}this.Options.Series=t}}.bind(this),AxisY:function(){if(this.Width!==T.Width){for(var t=(this.Options.AxisY.Visible?1:0,0),e=0,i=0;i<this.Options.Series.length;i++)if(this.Options.Series[i].isVisible&&this.Options.Series[i].OwnAxis){for(var n=0,r=0;r<this.Options.Series[i].Data.length;r++){var a=Lure.GetTextWidth(this.Options.Series[i].Data[r],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);a>n&&(n=this.Options.Series[i].Data[r])}var o=Lure.GetTextWidth(this.Options.Series[i].OwnAxis[1],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);o>n&&(n=o),e+=n+8;var s=Lure.GetTextWidth(this.Options.Series[i].Title,this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);e+=s>30?30:s}else if(this.Options.Series[i].isVisible&&!Array.isArray(this.Options.Series[i].OwnAxis))for(var l=0;l<this.Options.Series[i].Data.length;l++){var u=Lure.GetTextWidth(this.Options.Series[i].Data[l],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);u>t&&(t=this.Options.Series[i].Data[l])}e+=t+10+7,y.AxisYWidth=e}}.bind(this),AxisX:function(){if(this.Width!==T.Width){if(!this.Options.Labels.Visible)return void(y.AxisXParams={Height:0,Width:0,MarginTop:0,MarginLeft:0,Angle:0});for(var t=0,e=0;e<this.Options.Labels.Data.length;e++){var i=Lure.GetTextWidth(this.Options.Labels.Data[e],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);i>t&&(t=i)}var n=(this.Content.clientWidth-y.AxisYWidth)/this.Options.Labels.Data.length;n=(this.Content.clientWidth-y.AxisYWidth-n/2)/this.Options.Labels.Data.length,this.Options.Padding=n/2,this.Block.AxisX.style.paddingLeft=n/2+"px";var r=0,a=t,o=void 0;if("auto"!==this.Options.Labels.Rotation)o=parseFloat(this.Options.Labels.Rotation);else{var s=n/a;s<.15&&(s=0),s>1&&(s=1),o=-(180*Math.acos(s)/Math.PI).toFixed(2)}y.AxisXParams={Height:Math.round(Math.sqrt(Math.pow(a,2)-Math.pow(n,2)))+parseFloat(getComputedStyle(this.Block.AxisX).lineHeight),Width:a,MarginTop:a>n?Math.sqrt(Math.pow(a,2)-Math.pow(n,2))-r:0,MarginLeft:a>n?-n/2:-a/2,Angle:o}}}.bind(this),ScaleY:function(){return void(this._ScaleY=Lure.Chart.GetScaleY(this.Options.Series,this.Height-y.AxisXParams.Height,this))}.bind(this)},T={Width:0,Height:0,DataLength:0};this.__GetPathLine=function(t,e){y.Abscissa&&y.Width===this.Width||(y.Abscissa=Lure.Chart.GetAbscissa(S.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[e],n=this._ScaleY.Scales[i],r=S._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(t.Data,n,r,S.Height),o=Lure.Chart.GetPoints(y.Abscissa,a,this.Options.Padding);y.SeriesPoints[e]=o;for(var s=o.length,l=[],u=[],c=[],d=[],h=[],f=[],p=0;p<s;p++)l[p]=o[p][0],u[p]=o[p][1];for(var g=0;g<s-1;g++)c[g]=u[g+1]-u[g],d[g]=l[g+1]-l[g],h[g]=c[g]/d[g];f[0]=h[0],f[s-1]=h[s-2];for(var v=1;v<s-1;v++)0===h[v]||0===h[v-1]||h[v-1]>0!=h[v]>0?f[v]=0:(f[v]=3*(d[v-1]+d[v])/((2*d[v]+d[v-1])/h[v-1]+(d[v]+2*d[v-1])/h[v]),isFinite(f[v])||(f[v]=0));for(var m="M "+l[0]+","+u[0],C='<g class="mt-chart-dots">',b=0;b<s-1;b++)m+=" C "+(l[b]+d[b]/3)+","+(u[b]+f[b]*d[b]/3)+" "+(l[b+1]-d[b]/3)+","+(u[b+1]-f[b+1]*d[b]/3)+" "+l[b+1]+","+u[b+1],t.Point.Visible&&(C+=Lure.Chart.GetPathLineDot(l[b],u[b],e,b,t.Color,t.Point.Radius));return t.Point.Visible&&(C+=Lure.Chart.GetPathLineDot(l[s-1],u[s-1],e,s-1,t.Color,t.Point.Radius)),C+="</g>",'<g class="mt-chart-serie" data-type="Line"><path data-line="'+e+'" d="'+m+'" fill="none" stroke="'+t.Color+'" stroke-width="'+t.Width+'"></path> '+C+"</g>"}.bind(this),this.__GetPathBar=function(t,e){y.Abscissa&&y.Width===this.Width||(y.Abscissa=Lure.Chart.GetAbscissa(S.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[e],n=this._ScaleY.Scales[i],r=S._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(t.Data,n,r,S.Height),o=Lure.Chart.GetPoints(y.Abscissa,a,this.Options.Padding);y.SeriesPoints[e]=o;var s=this.Height,l=1;this.Options.SeriesOptions.BarStack||(l=.8*y.SeriesCount.Bar);var u=this.Width/this.Options.Labels.Data.length/2/l,c=1.2*u*y.SeriesBar-(1.2*u*y.SeriesCount.Bar/2-1.2*u/2),d='<g class="mt-chart-serie" data-type="Bar">',h="";this.Options.SeriesOptions.BarGradient&&(h="lc-gradient-"+Lure.Chart.Count,d+='<linearGradient id="'+h+'"  x1="0" y1="0%"><stop offset="0%" stop-color="rgba(0,0,0,0.2)"/><stop offset="33%" stop-color="rgba(255,255,255,0.2)"/><stop offset="100%" stop-color="rgba(0,0,0,0.3)"/></linearGradient>');for(var f="",p=0;p<o.length;p++){var g="M "+(c+o[p][0]-u/2)+" "+s+" L "+(c+o[p][0]+u/2)+" "+s+" "+(c+o[p][0]+u/2)+" "+o[p][1]+" "+(c+o[p][0]-u/2)+" "+o[p][1]+"Z";d+='<g class="lc-bar-elem"><path class="lc-bar-elem" data-line="'+e+'" data-item="'+p+'" d="'+g+'" fill="'+t.Color+'" stroke="#000" stroke-width="0"></path>',this.Options.SeriesOptions.BarGradient&&(d+='<path class="lc-bar-elem-gradient"  data-line="'+e+'" data-item="'+p+'" d="'+g+'" fill="url(#'+h+')" ></path>'),d+='<path class="mt-chart-tooltipable" data-type="bar" data-line="'+e+'" data-item="'+p+'" d="'+g+'" fill="#fff" fill-opacity="0" stroke="#fff" stroke-width="0"></path>',d+="</g>"}return d+=f+"</g>",y.SeriesBar++,d}.bind(this),this.__GetSvgCasual=function(){for(var t="",e="",i=0;i<this.Options.Series.length;i++)if(this.Options.Series[i].isVisible)switch(this.Options.Series[i].Type){case"line":t+=this.__GetPathLine(this.Options.Series[i],i);break;case"bar":e+=this.__GetPathBar(this.Options.Series[i],i)}return e+t}.bind(this),this.__GetSvgPie=function(){for(var t="",e=this.Height<this.Width?.9*this.Height:.9*this.Width,i=0;i<this.Options.Series.length;i++){var n=0,r=-45,a=e/4*(this.Options.Series.length-i)/(y.SeriesCount.Pie+y.SeriesCount.Ring),o=2*a;"ring"===this.Options.Series[i].Type&&(o=this.Options.Series[i].Width,a=2*a-o/2);for(var s=0;s<this.Options.Series[i].Data.length;s++)n+=this.Options.Series[i].Data[s];for(var l=0;l<this.Options.Series[i].Data.length;l++){var u=this.Options.Series[i].Data[l]/n*360;t+="<g>",t+='<path d="'+Lure.Chart.PieArc(this.Width/2,this.Height/2,a,r,r+u)+'" fill="none" stroke="'+this.Options.Series[i].Colors[l]+'" stroke-width="'+o+'" stroke-opacity="1"></path>',t+='<path class="mt-chart-tooltipable" data-type="pie" data-line="'+i+'" data-item="'+l+'" d="'+Lure.Chart.PieArc(this.Width/2,this.Height/2,a,r,r+u)+'" fill="none" stroke="#fff" stroke-width="'+o+'" stroke-opacity="0"></path>',
t+="</g>",r+=u}}return t}.bind(this),L.Tooltip(),this.Tooltip=new Lure.Content({Name:"Tooltipchek",Target:this.Block.ChartArea,Content:'<div class="mt-chart-tooltip">\n                        <div class="val">'+this.Options.Tooltip.Template+"</div>\n                      </div>",Visible:!1,Controller:{Data:{}},BeforeShow:function(t,e){},Prop:function(){this._Timer=null,this._Timer2=null},Shower:function(){clearTimeout(this._Timer),clearTimeout(this._Timer2),this.Content.style.display="",this.Content.style.opacity="1"},Hider:function(){clearTimeout(this._Timer),this._Timer=setTimeout(function(){this.Content.style.opacity="0",this._Timer2=setTimeout(function(){this.Content.style.display="none"}.bind(this),200)}.bind(this),800)},Show:function(t){clearTimeout(this._Timer),this.Data.Name=t.data[0],this.Data.Value=t.data[1],this.Refresh(),this.Content.style.left=t.pos[0]+7+"px",this.Content.style.top=t.pos[1]-this.Content.clientHeight-7+"px",this.Content.style.backgroundColor=t.color},Methods:function(){this.Do=function(t){var e=t.currentTarget.dataset.type;switch(e){case"line":this.DoCircle(t);break;case"bar":this.DoBar(t);break;case"pie":this.DoPie(t)}}.bind(this),this.DoCircle=function(t){var e=t.currentTarget,i=parseInt(e.dataset.line),n=parseInt(e.dataset.item),r=e.attributes.stroke.value,a=parseInt(e.attributes["stroke-width"].value);e.attributes.fill.value=r,e.attributes.r.value=parseInt(e.attributes.r.value)+a,e.attributes.stroke.value="#fff";var o={data:[f[i].Name,f[i].Data[n]],color:r,pos:y.SeriesPoints[i][n]};this.Show(o)}.bind(this),this.DoBar=function(t){var e=t.currentTarget;e.setAttribute("fill-opacity",.2);var i=parseInt(e.dataset.line),n=parseInt(e.dataset.item),r={data:[S.Options.Series[i].Name,S.Options.Series[i].Data[n]],color:S.Options.Series[i].Color,pos:y.SeriesPoints[i][n]};this.Show(r)}.bind(this),this.DoPie=function(t){var e=t.currentTarget;e.setAttribute("stroke-opacity",.2);var i=parseInt(e.dataset.line),n=parseInt(e.dataset.item),r={data:[S.Options.Series[i].Labels?S.Options.Series[i].Labels[n]:S.Options.Series[i].Name,S.Options.Series[i].Data[n]],color:S.Options.Series[i].Colors[n],pos:[t.offsetX,t.offsetY]};this.Show(r)}.bind(this),this.Undo=function(t){var e=t.currentTarget.dataset.type;switch(e){case"line":this.UndoCircle(t);break;case"bar":this.UndoBar(t);break;case"pie":this.UndoPie(t)}},this.UndoCircle=function(t){var e=t.currentTarget,i=parseInt(e.attributes["stroke-width"].value);e.attributes.stroke.value=e.attributes.fill.value,e.attributes.fill.value="#fff",e.attributes.r.value-=i,this.Hide()},this.UndoBar=function(t){var e=t.currentTarget;e.setAttribute("fill-opacity",0),this.Hide()},this.UndoPie=function(t){var e=t.currentTarget;e.setAttribute("stroke-opacity",0),this.Hide()}},AfterBuild:function(){}}),Lure.AddEventListenerGlobal("mouseover",".mt-chart-point, .mt-chart-tooltipable",function(t){this.Tooltip.Do(t)},this.Content,this),Lure.AddEventListenerGlobal("mouseout",".mt-chart-point, .mt-chart-tooltipable",function(t){S.Tooltip.Undo(t)},this.Content),this.TestB=function(){var t=performance.now();Lure.Perf(t,"builder")},this.Buffer=y,this.Width,e.call(this),this.Refresh=function(){e.call(this)}.bind(this)}return _createClass(t,[{key:"Height",get:function(){return this.Block.Svg.clientHeight}},{key:"Width",get:function(){return this.Block.Svg.clientWidth-this.Options.Padding}}],[{key:"GetSeriePointOptions",value:function(t,e){var i=t.Point?t.Point:{};return i.Visible="undefined"==typeof i.Visible||i.Visible,i.Radius=i.Radius?i.Radius:4+t.Width/4,Number.isNaN(i.Radius),i}},{key:"GetScaleY",value:function(t,e,i){if("pie"===i.Type)return[];var n=t[0].Data[0],r=t[0].Data[0],a=!0,o=!0;"auto"!==i.Options.AxisY.Scale[0]&&"auto"!==i.Options.AxisY.Scale[1]&&(a=!1,n=i.Options.AxisY.Scale[0],r=i.Options.AxisY.Scale[1]),"auto"!==i.Options.AxisY.Scale[2]&&(o=!1);for(var s=[[t[0].Data[0],t[0].Data[0]]],l=0,u={Scales:[],Dict:[],MinMax:null},c=0;c<t.length;c++){u.Dict[c]=0,t[c].OwnAxis&&(l++,"undefined"!=typeof t[c].OwnAxis[0]?s.push(t[c].OwnAxis):s.push([t[c].Data[0],t[c].Data[0]]),u.Dict[c]=l);for(var d=0;d<t[c].Data.length;d++)a&&(t[c].Data[d]<n&&(n=t[c].Data[d]),t[c].Data[d]>r&&(r=t[c].Data[d])),t[c].OwnAxis&&"undefined"==typeof t[c].OwnAxis[0]&&(t[c].Data[d]<s[l][0]&&(s[l][0]=t[c].Data[d]),t[c].Data[d]>s[l][1]&&(s[l][1]=t[c].Data[d]))}s[0]=[n,r],u.MinMax=s;for(var h=0;h<s.length;h++){var f=s[h][1].toString().length,p=void 0;p=0!==h||o?s[h][2]?s[h][2]:(40*(s[h][1]-s[h][0])/e/Math.pow(10,f-1)/5).toFixed(1)*Math.pow(10,f-1)*5:i.Options.AxisY.Scale[2];for(var g=s[h][0],v=[];g<=s[h][1]+i.Options.Series[h].Width/2;)v.push(g),g+=p;v.push(g),u.Scales.push(v)}return u}},{key:"GetAbscissa",value:function(t,e){var i=e/t.length;return t.map(function(t,e){return e*i})}},{key:"GetOrdinata",value:function(t,e,i,n){for(var r=i[0],a=i[1],o=e[e.length-1]/a,s=[],l=0;l<t.length;l++)s.push(n-(t[l]-r)*n/(a-r)/o);return s}},{key:"GetPoints",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=[],r=0;r<e.length;r++)n.push([t[r]+i,e[r]]);return n}},{key:"aGetPath",value:function(t,e,i,n,r){switch(e){case"line":return Lure.Chart.GetPathLine(t,i,n,r);case"bar":return Lure.Chart.GetPathBar(t,i,n,r);case"pie":return""}}},{key:"aGetPathLine",value:function(t,e,i,n){for(var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=t.length,o=[],s=[],l=[],u=[],c=[],d=[],h=0;h<a;h++)o[h]=t[h][0],s[h]=t[h][1];for(var f=0;f<a-1;f++)l[f]=s[f+1]-s[f],u[f]=o[f+1]-o[f],c[f]=l[f]/u[f];d[0]=c[0],d[a-1]=c[a-2];for(var p=1;p<a-1;p++)0===c[p]||0===c[p-1]||c[p-1]>0!=c[p]>0?d[p]=0:(d[p]=3*(u[p-1]+u[p])/((2*u[p]+u[p-1])/c[p-1]+(u[p]+2*u[p-1])/c[p]),isFinite(d[p])||(d[p]=0));for(var g="M "+o[0]+","+s[0],v='<g class="mt-chart-dots">',m=0;m<a-1;m++)g+=" C "+(o[m]+u[m]/3)+","+(s[m]+d[m]*u[m]/3)+" "+(o[m+1]-u[m]/3)+","+(s[m+1]-d[m+1]*u[m]/3)+" "+o[m+1]+","+s[m+1],r&&(v+=Lure.Chart.GetPathLineDot(o[m],s[m],e,m,i,n));return v+="</g>",'<g class="mt-chart-serie"><path data-line="'+e+'" d="'+g+'" fill="none" stroke="'+i+'" stroke-width="'+n+'"></path> '+v+"</g>"}},{key:"GetPathLineDot",value:function(t,e,i,n,r,a){return'<circle class="mt-chart-point" data-type="line" data-line="'+i+'" data-item="'+n+'" cx="'+t+'" cy="'+e+'" r="'+a+'" stroke="'+r+'" stroke-width="2" fill="#fff" ></circle>'}},{key:"aGetPathBar",value:function(t,e,i,n){console.log("GetPathBar",t);for(var r=0;r<t.length;r++){"M "+t[r][0]+" "+t[r][1]+" L "+t[r][0]+" "+t[r][1]}return do2ts}},{key:"PolarToCartesius",value:function(t,e,i,n){var r=(n-0)*Math.PI/180;return{x:t+i*Math.cos(r),y:e+i*Math.sin(r)}}},{key:"PieArc",value:function(t,e,i,n,r){var a=Lure.Chart.PolarToCartesius(t,e,i,r),o=Lure.Chart.PolarToCartesius(t,e,i,n),s=r-n<=180?"0":"1",l=["M",a.x,a.y,"A",i,i,0,s,0,o.x,o.y].join(" ");return l}},{key:"CheckOwnAxis",value:function(t){if(!t.OwnAxis)return!1;if(Array.isArray(t.OwnAxis)){var e=!1,i=!1;if("auto"===t.OwnAxis[0]&&"undefined"==typeof t.OwnAxis[0]||(e=t.Data[0]),"auto"===t.OwnAxis[1]&&"undefined"==typeof t.OwnAxis[1]||(i=t.Data[1]),!e&&!i)return t.OwnAxis;for(var n=0;n<t.Data.length;n++)t.Data[n]<e&&(e=t.Data[n]),t.Data[n]>i&&(i=t.Data[n])}}},{key:"MakeLegend",value:function(t,e){var i="lc-legeng_ch"+Lure.Chart.Count;return'<div class="mt-chart-legend__item row">\n                          <input class="mt-legend-checkbox" type="checkbox" '+(t.isVisible?'checked="cheched"':"")+' id="'+i+'">\n                          <div class="mt-legend-icon" style="background-color: '+t.Color+'"></div>\n                          <label class="mt-legend-label" for="'+i+'">'+t.Name+"</label>\n                        </div>"}},{key:"GetGrid",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n="",r=0;r<e;r++){n+='<div class="mt-chart__grid-line row flex-100 flex-between" >';for(var a=0;a<t;a++)0===a&&(n+="<div class='mt-chart__grid-item flex-100' style=\"width: "+i+"px; max-width: "+i+'px"></div>'),n+="<div class='mt-chart__grid-item flex-100'></div>";n+="</div>"}return n+=""}}]),t}()},Lure.Chart=Lure.Plugin.Chart.Chart,Lure.Chart.Count=0,Lure._GenerateString=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=t+(Math.random().toString(36)+Math.random().toString(36)+Math.random().toString(36)).replace("0.","").replace(/[\d]+/,"").substring(0,1);return Lure.Select("#"+e)&&(e=Lure._GenerateString(t)),e};
//# sourceMappingURL=lure.all.min.js.map
