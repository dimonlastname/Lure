"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();Date.prototype.format||(Date.prototype.format=function(e){return Lure._DateFormat(this,e)});var Lure=function(){var LureClass=function(){function LureClass(){_classCallCheck(this,LureClass),this.Plugin={};var $this=this;this.Debug=!1,this.isEditableEventsEnabled=!1;var regexEach=new RegExp(/{{#each\s+([^}]+)}}/g),regexIfOuter=new RegExp(/{{#if\s+([^}]+)}}([\s\S]*?){{#endif}}/g),regexIfInner=new RegExp(/{{#if([\s\S]*?)}}/g),regexExpressions=new RegExp(/{{([^#}]+)}}/g),regexEditable=new RegExp(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/g),spaces="    ",preCompileIfOuter=function(e){return e=e.replace(/#IF/g,"#if").replace(/#ENDIF/g,"#endif").replace(regexIfOuter,function(e,t,i){return'`+\n/* OUTER "IF" */\n(function($this){\n    if ('+preParseObjectChecker(t)+") {\n        return `"+i+"`;\n    }\n    return '';\n})($this)+`"})},preCompileIfInner=function(e){return e=e.replace(regexIfInner,function(e,t){return t=t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/#less/g," < ").replace(/#more/g," > ").replace(/&amp;/g,"&").replace(/\|/g,'"'),'`+\n    /* LOCAL "IF" */\n    (function(){\n        return ('+t+"); \n        return '';})()+`"})},preCompileEach=function(e){e=e.replace(/{{#EACH/g,"{{#each").replace(/{{#ENDEACH/g,"{{#endeach");var t=e.match(regexEach),i=0;if(null!==t)for(var n=t.length-1;n>=0;n--){var r=t[n],a=!1;i++;var o=e.indexOf(r),s=e.indexOf("{{#endeach}}",o),l=e.slice(0,o).match(regexEach);l=null!==l?l.length:0;var u=e.slice(0,o).match(/{{#endeach}}/g);u=null!==u?u.length:0,l>u&&(a=!0,i=0);var c=e.slice(o,s+12),d=c.slice(r.length,c.length-12),h=r.replace(/{{#each\s+([\s\S]+)}}/,function(e,t){return t});h=preParseObjectChecker(h);var f="`+"+spaces.repeat(i)+"/* EACH */(function(inner, $parent){                                                                   \r\n"+spaces.repeat(i)+"    if (!inner || (Object.keys(inner).length === 0 && inner.constructor === Object && isNaN(inner)))   \r\n"+spaces.repeat(i)+'        return "";                                                                                     \r\n'+spaces.repeat(i)+'    let string_result= "";                                                                             \r\n'+spaces.repeat(i)+"    for(let j = 0; j < inner.length; j++){                                                             \r\n"+spaces.repeat(i)+"        let $this = inner[j];                                                                          \r\n"+spaces.repeat(i)+"        let o = inner[j];                                                                              \r\n"+spaces.repeat(i)+"        string_result = string_result + `"+preParse(d)+"`;                                \r\n"+spaces.repeat(i)+"    }                                                                                                  \r\n"+spaces.repeat(i)+"    return string_result;                                                                              \r\n"+spaces.repeat(i)+"})("+h+', {$parent: typeof $parent !== "undefined"?$parent:null, $this: $this, i: i} ) +`         ';e=e.replace(c,f)}return e},preCompileEditable=function(e){return e.replace(regexEditable,function(e,t,i){return e=e.replace(/<[\s\S]+?(>)/,function(e,t){return e.replace(t,' data-line="{{i}}" data-property="'+i.replace("{{","").replace("}}","")+'">')}),e.replace(i,'<div class="editable-helper editable-value">'+i+'</div><div class="editable-helper editable-icon"></div>')})},preParseObjectChecker=function(e){function t(e){var t=e.replace(/\s/g,""),i=t.indexOf("$item")>-1||t.indexOf("$this")>-1||t.indexOf("$parent")>-1,n=t.indexOf("$index")>-1||t.indexOf("$j")>-1||t.indexOf("$key")>-1||t.indexOf("$lvl")>-1||t.indexOf("$g.")>-1,r="?"===t||t.indexOf("=")>-1||t.indexOf(">")>-1||t.indexOf("<")>-1,a=null!==t.match(/^["'\\][\s\S]*["'\\]$/),o="i"===t||"j"===t,s=!isNaN(t);return i||n||o||s||a||r?t.indexOf("$g.")>-1?t.replace("$g.",""):e:"o."+t}return e.indexOf("Available + Dis")>-1,e=e.replace(/[^\-+\/%()*]+/g,function(e){var i=e.match(/&/g);if(null!==i){for(var n=0;n<i.length;n++)e=n<i.length-1?e.replace("&","$parent"):e.replace("&","$parent.$this");return e}return t(e)}),e=e.replace(/\\'/g,"'"),e="("+e+")"},preParse=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.replace(regexExpressions,function(e,i){return t?"${"+preParseObjectChecker(i)+"}":"${"+i+"}"})};this.Compile=function(e,t){e=e.replace(/[\n]+/g," ").replace(/[ ]{3,}/g,""),e=e.replace(/'/g,"\\'"),t&&(e=preCompileEditable(e),e=preCompileIfOuter(e),e=preCompileEach(e)),e=preParse(e),e=preCompileIfInner(e);var i="\nlet $this = o;\nlet $item = o;\nlet $num = i+1;\nlet $denum = length-i;\n//treebuilder's\nlet $index;\nlet $key;\nlet $lvl;\nlet $j;\nif (extra){\n    $index = extra.$index;\n    $key = extra.$key;\n    $lvl = extra.$lvl;\n    $j = extra.$j;\n}\nlet string_Result = \"\";\nif (o === undefined || (Object.keys(o).length === 0 && o.constructor === Object && isNaN(o)) ) \n    return '';\nreturn `";i+=e+"`;",i=i.replace(/`/g,"'").replace(/\$\{([^}]*)\}/g,function(e,t){return"'+"+t+"+'"});var n=void 0;try{n=new Function("o","i","length","extra",i)}catch(r){console.info(i),console.error(r)}return n},this._EditablesEventListenerRun=function(e){$this.AddEventListenerGlobal("dblclick",".editable",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget)},e),$this.AddEventListenerGlobal("click",".editable-icon",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget.closest(".editable"))},e),$this.AddEventListenerGlobal("dblclick",".editable",function(e){$this.Editable.RemoveEdits(),$this.Editable.AddEdits(e.currentTarget)},e),$this.AddEventListenerGlobal("change",".editable-editor",function(e){var t=e.currentTarget.value,i=e.currentTarget.parentElement.dataset.value;t!==i?e.currentTarget.parentElement.classList.add("editable-waiting"):e.currentTarget.parentElement.classList.remove("editable-waiting")},e),$this.AddEventListenerGlobal("keyup",".editable-textbox",function(e){if(13===e.keyCode)return $this.Editable.Save(e.currentTarget.closest(".editable"),e.currentTarget.value),!1;var t=e.currentTarget.value,i=e.currentTarget.parentElement.dataset.value;t!==i?e.currentTarget.parentElement.classList.add("editable-waiting"):e.currentTarget.parentElement.classList.remove("editable-waiting")},e),$this.AddEventListenerGlobal("click",".editable-save-button",function(e){var t=e.currentTarget.closest(".editable");$this.Editable.Save(e.currentTarget.closest(".editable"),t.querySelector(".editable-editor").value)},e),$this.isHasEditablesEventsEnabled||(document.addEventListener("click",function(e){e.target.classList.contains("editable-helper")&&null!==document.querySelectorAll(".editable-helper, .editable-editing")||$this.Editable.RemoveEdits()}),$this.isHasEditablesEventsEnabled=!0)},this.CreateElementFromString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=document.createDocumentFragment(),n=document.createElement(t);for(n.innerHTML=e;n.childNodes[0];)i.appendChild(n.childNodes[0]);return i.childNodes[0]},this.CreateElementsFromString=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div",i=document.createDocumentFragment(),n=document.createElement(t);for(n.innerHTML=e;n.childNodes[0];)i.appendChild(n.childNodes[0]);if(i.childNodes.length>0){for(var r=[],a=0;a<i.childNodes.length;a++)r.push(i.childNodes[a]);return r}return null},this.Select=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return""===e||null===e?null:e instanceof Node?e:t.querySelector(e)},this.SelectAll=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return"undefined"==typeof e?[]:"undefined"!=typeof e.tagName||e===document?[e]:t.querySelectorAll(e)},this.AddEventListenerGlobal=function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:document,r=arguments[4];n.addEventListener(e,function(e){var a=e.target,o=!1,s=Lure._EventClone(e),l=n.querySelectorAll(t);if(l[0]===a&&(s.currentTarget=a,o=!0),!o)for(var u=0;u<l.length;u++)if(l[u].contains(a)){o=!0,s.currentTarget=a.closest(t);break}o&&i.call(r?r:s.currentTarget,s)})},this.isVisible=function(e){var t=function(e){var t=window.getComputedStyle(e);return"none"!==t.display&&"0"!==t.opacity&&"hidden"!==t.visibility&&((0!==parseInt(t.minWidth)&&"auto"!==t.minWidth||0!==parseInt(t.width))&&(0!==parseInt(t.minHeight)&&"auto"!==t.minHeight||0!==parseInt(t.height)))},i=function(e){for(;e.parentElement;){if(!t(e.parentElement))return!1;e=e.parentElement}return!0};return!!t(e)&&i(e)},this._EventClone=function(e){function t(){}var i=new t;for(var n in e){var r=Object.getOwnPropertyDescriptor(e,n);!r||r.writable&&r.configurable&&r.enumerable&&!r.get&&!r.set?i[n]=e[n]:Object.defineProperty(i,n,r)}return Object.setPrototypeOf(i,e),i},this.GetFileText=function(e){return new Promise(function(t,i){var n=new XMLHttpRequest;n.onload=function(){t(n.response)},n.onerror=function(){i(new Error("XMLHttpRequest Error: "+this.statusText))},e=e.indexOf("..")>-1?e.replace("..",document.location.protocol+"//"+document.location.host):document.location.href.substring(0,document.location.href.lastIndexOf("/")+1)+e,console.log("Lure.GetFileText",e),n.open("GET",e),n.send()})},this.GetTextWidth=function(e,t,i){return void 0===this.c&&(this.c=document.createElement("canvas"),this.ctx=this.c.getContext("2d")),this.ctx.font=i+" "+t,this.ctx.measureText(e).width},this.GetInlineSize=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1rem",i="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",n=document.createElement("div");for(var r in e.style)try{""!==e.style[r]&&e.style[r].indexOf(":")>0&&(n.style[r]=e.style[r])}catch(a){}document.all?n.style.setAttribute("cssText",i):n.setAttribute("style",i),n.style.fontSize=t,n.innerHTML=e.innerHTML,parent.document.body.appendChild(n);var o={width:n.clientWidth,height:n.clientHeight};return parent.document.body.removeChild(n),o},this.GetInlineSize1=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"12px//",i=performance.now(),n="left:-10000px;top:-10000px;height:auto;width:auto;position:absolute;",r=document.createElement("div");for(var a in e.style)try{""!==e.style[a]&&e.style[a].indexOf(":")>0&&(r.style[a]=e.style[a])}catch(o){}document.all?r.style.setAttribute("cssText",n):r.setAttribute("style",n),r.style.fontSize=t,r.innerHTML=e.innerHTML,parent.document.body.appendChild(r);var s=getComputedStyle(r),l=performance.now(),u={width:$this.GetTextWidth(e.innerText,s.getPropertyValue("font-family"),s.getPropertyValue("font-size")),height:12};return Lure.Perf(l,"--size"),parent.document.body.removeChild(r),console.log("sizes",u,s),Lure.Perf(i,"--calxXwidth"),u},this.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},this._DateFormat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD.MM.YYYY HH:mm:ss";if(null===e||"undefined"==typeof e)return"";var i=e.getDate(),n=e.getMonth(),r=e.getFullYear(),a=e.getHours(),o=e.getMinutes(),s=e.getSeconds();return t.replace("DD",i.toString().length<2?"0"+i:i).replace("D",i).replace("MMM",$this.Culture.MonthNames[n]).replace("MM",n.toString().length<2?"0"+n:n).replace("M",n).replace("YYYY",r).replace("YY",r.toString().substring(2,2)).replace("Y",r).replace("HH",a.toString().length<2?"0"+a:a).replace("hh",a).replace("mm",o.toString().length<2?"0"+o:o).replace("ss",s.toString().length<2?"0"+s:s)},this.Editable={EditMode:!1,RemoveWaiting:function(){var e=document.querySelectorAll(".editable-waiting");e.forEach(function(e){e.classList.remove("editable-waiting")})},RemoveEdits:function(){if(!$this.Editable.EditMode){var e=document.querySelectorAll(".editable-editing");e.forEach(function(e){e.innerHTML=e._innerHTML,e.classList.remove("editable-editing")}),$this.Editable.RemoveWaiting()}},AddEdits:function AddEdits(EditableElement){EditableElement._innerHTML=EditableElement.innerHTML;var ValuePrev=EditableElement.querySelector(".editable-value").innerHTML;EditableElement.classList.add("editable-editing"),EditableElement.dataset.value=ValuePrev;var SaveButton=$this.Editable.EditMode?"":'<div class="editable-helper editable-save-button"></div>';if(EditableElement.dataset.object){var string_Select='<select class="select editable-helper editable-editor editable-select">',SelectData=eval(EditableElement.dataset.object),Property=EditableElement.dataset.property,SelectOptions="";SelectData.forEach(function(e){var t="";if(("undefined"==typeof e?"undefined":_typeof(e))===_typeof({})){for(var i in e)t+=" data-property_"+i+'="'+e[i]+'"';string_Select+='<option class="editable-helper" '+t+">"+e[Property]+"</option>"}else string_Select+='<option class="editable-helper" '+(e===ValuePrev?"selected":"")+">"+e+"</option>"}),string_Select+="</select>"+SaveButton+"</div>",EditableElement.innerHTML=string_Select}else{var EditType=EditableElement.dataset.type;"undefined"==typeof EditType&&(EditType="text"),EditableElement.innerHTML='<input class="textbox editable-helper editable-editor editable-textbox" type="'+EditType+'" value="'+ValuePrev+'"> '+SaveButton,EditableElement.querySelector(".editable-editor").focus(),EditableElement.querySelector(".editable-editor").select()}},Save:function(e,t){var i=e.closest(".mt-content"),n=i.MonsieurController,r=e.dataset.line,a=e.dataset.property,o=n.Data[r];return""===t||null===t||"undefined"==typeof t?(console.info("New Value is empty"),void Lure.ErrorHint(e,"Пустое поле или неправильные данные")):(e.innerHTML=e._innerHTML,e.dataset.value=t,e.querySelector(".editable-value").innerHTML=t,e.classList.remove("editable-editing"),"$this"!==a&&"$item"!==a?o[a]=t:o=t,void n.LineSave(r,a,t,function(){Lure.Editable.RemoveWaiting(),"$this"!==a&&"$item"!==a?n.Data[r][a]=t:n.Data[r]=t}))}},this.Settings={DialogBlur:null,DialogAnimation:"lure-animation-dialog",EditableClass:"editable",EditableWaiting:"editable-waiting"},this.Culture={MonthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],MonthNamesShort:["янв.","фев.","мар.","апр.","май","июн.","июл.","авг.","сен.","окт.","ноя.","дек."],WeekDays:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],WeekDaysShort:["пн","вт","ср","чт","пт","сб","вс"]},this.TemplatorList=[],this.ContentList={},this._DialogCount=0}return _createClass(LureClass,[{key:"Perf",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Perf",i=Math.floor(100*(window.performance.now()-e))/100;return console.info("["+t+"]: "+i+"ms"),i}},{key:"Confirm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Achtung",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.CaptionColor,r=void 0===n?"":n,a=i.CaptionBackground,o=void 0===a?"":a,s=i.OnAgree,l=void 0===s?function(){}:s,u=i.OnCancel,c=void 0===u?null:u;document.activeElement.blur();var d=document.createElement("div");d.classList.add("lure-confirm"),Lure.Settings.DialogAnimation&&d.classList.add(Lure.Settings.DialogAnimation);var h=document.createElement("div");h.classList.add("cd-caption"),h.innerHTML=e,h.style.color=r,h.style.background=o,d.appendChild(h);var f=document.createElement("div");f.classList.add("cd-text"),f.innerHTML=t,d.appendChild(f);var p=document.createElement("div");p.classList.add("cd-buttons"),d.appendChild(p);var g=document.createElement("div");if(g.classList.add("button","cd-button","btn-diag-confirm"),g.innerHTML="Ok",g.onclick=function(){Lure._DialogCount--,null!==l&&void 0!==l&&l(),Lure.Settings.DialogBlur&&Lure._DialogCount<1&&Lure.Select(Lure.Settings.DialogBlur).classList.remove("lure-blur"),C.remove(),d.remove()},d.getElementsByClassName("cd-buttons")[0].appendChild(g),null!==c){var v=document.createElement("div");v.classList.add("button","cd-button","btn-diag-cancel"),v.innerHTML="Отмена",v.onclick=function(){Lure._DialogCount--,null!==c&&c(),Lure.Settings.DialogBlur&&Lure._DialogCount<1&&Lure.Select(Lure.Settings.DialogBlur).classList.remove("lure-blur"),C.remove(),d.remove()},d.getElementsByClassName("cd-buttons")[0].appendChild(v)}var C=document.createElement("div");C.classList.add("ConfirmDialog-wrapper"),document.body.appendChild(C),document.body.appendChild(d),Lure._DialogCount++,Lure.Settings.DialogBlur&&(C.style.background="none",Lure.Select(Lure.Settings.DialogBlur).classList.add("lure-blur"))}},{key:"NoFeature",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""!==e&&(e='"'+e+'"'),this.Confirm("Error","Sorry, function "+e+" is not available yet")}},{key:"ErrorHint",value:function(e,t){t||(t="Поле не может быть пустым");var i=document.createElement("div");i.classList.add("lure-error-hint"),i.innerHTML=t,e.parentElement.style.position="relative",e.parentElement.appendChild(i),i.style.display="block";try{i.animate({opacity:[0,1]},{duration:300})}catch(n){}setTimeout(function(){try{i.animate({opacity:[1,0]},{duration:300}).onfinish=function(){i.style.display="none"}}catch(t){i.style.display="none"}setTimeout(function(){e.parentElement.style.position="",i.remove()},500)},2e3)}},{key:"RoundBy",value:function(e,t){var i=e%t;return i&&(e=e-i+t),e}},{key:"GetNumberOrder",value:function(e){var t=e.toString().split(".");if(0!==parseInt(t[0]))return t=t[0].length,t-1;var i=t[1]?t[1].match(/[^0]/):null;return i=i?i.index+1:1,-i}}]),LureClass}();return new LureClass}();Lure.Diagnostics={},Lure.Diagnostics.Perf=function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_classCallCheck(this,e);var i=performance.now(),n=i;this.Reset=function(){return i=performance.now(),n=i,0},this.Elapsed=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Perf";if(!t)return 0;var n=(performance.now()-i).toFixed(2);return console.info("["+e+"]: "+n+"ms"),n},this.Perf=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Perf";if(!t)return 0;var i=performance.now(),r=(i-n).toFixed(2);return console.info("["+e+"]: "+r+"ms"),n=i,r}},"undefined"==typeof Lure&&console.error("[Lure] Lure core is not defined"),Lure.Plugin.Content={Version:"0.9.1",Content:function(){function LureContent(_ref2){function MakeContent(e){null===Controller||Array.isArray(Controller.Data)?this.Content=Lure.CreateElementFromString(e):null===Controller||Array.isArray(Controller.Data)||(e=e.replace(/>[^>]*({{[^#}]+}})[^>]*</g,function(e,t){var i=e.replace(/{{[^#}]+}}/g,function(e){return"<span>"+e+"</span>"});return i}),this.Content=Lure.CreateElementFromString(e)),this.Target.appendChild(this.Content)}function construct(){this.Type=Type,this.Name=Name,this.AllContents=Lure.ContentList,this.Refresh=Refresh.bind(this),this.Select=function(e){return Lure.Select(e,$this.Content)},this.SelectAll=function(e){return Lure.SelectAll(e,$this.Content)},this.GetParent=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",t=$this;null!==t.Parent&&t.Name!==e;)t=t.Parent;return t},this.GetContent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",t=this.GetParent(e);if(t.Name===e)return t;var i=t;if("root"===e)return i;var n=function r(t){for(var n in t)if("Parent"!==n&&t[n]&&t[n].isContent){if(t[n].Name===e)return t[n];i=r(t[n])}return i};return n(i)},this.GetIndex=function(e){return e=$this.Select(e),Array.prototype.slice.call(e.parentElement.children).indexOf(e)},this.AddEventListener=function(e,t,i){Lure.AddEventListenerGlobal(e,t,i,$this.Content,$this)},this.AddTutor=function(e){$this.MonsieurTutor=new MonsieurTutor($this.Select(e),$this.Content)},this._SortBy=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t.length<2)){console.log("sort by",e),t.sort(function(t,i){return t[e]<i[e]&&$this._Sorting[e].Sorted?1:t[e]>i[e]&&$this._Sorting[e].Sorted?-1:t[e]<i[e]&&!$this._Sorting[e].Sorted?-1:t[e]>i[e]&&!$this._Sorting[e].Sorted?1:0}),$this._Sorting[e].Sorted=!$this._Sorting[e].Sorted;for(var i in $this._Sorting)$this._Sorting.hasOwnProperty(i)&&"_sorter"!==i&&($this._Sorting[i].Target.classList.remove("mt-sorting-up"),$this._Sorting[i].Target.classList.remove("mt-sorting-down"),e!==i&&($this._Sorting[i].Sorted=!1));$this._Sorting[e].Target.classList.add($this._Sorting[e].Sorted?"mt-sorting-down":"mt-sorting-up"),$this.Refresh()}},this._FilterBy=function(){var e=performance.now(),t=0,i=$this._Filter._DataDefault.slice(0),n=function(e){$this._Filter.hasOwnProperty(e)&&$this._Filter[e].Filter&&""!==$this._Filter[e].Filter&&(i=i.filter(function(t){return t[e].toString().toLowerCase().indexOf($this._Filter[e].Filter)>-1}),t++)};for(var r in $this._Filter)n(r);console.log(i),0===t?($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,$this.Controller._Data)),$this.Controller.Refresh()):($this._Sorting._sorter&&($this._Sorting[$this._Sorting._sorter].Sorted=!$this._Sorting[$this._Sorting._sorter].Sorted,$this._SortBy($this._Sorting._sorter,i)),$this.Controller.PageSize=$this._PageSize,$this.Controller._PageCursor=0,$this.Controller._Rebuilder(i)),mr.PerformanceNow(e,"FilterBy")},Props.call(this);for(var k in GetSet)Object.defineProperty($this,k,Object.getOwnPropertyDescriptor(GetSet,k));if(Methods.call(this),this.Show=function(e){this.isActive=!0,this.Control&&this.Control.Active();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));if(duration<durationAni&&(duration=durationAni),duration++,"Untyped"===$this.Type||$this.isVisible||Lure.ContentList[$this.Type].forEach(function(e){e!==$this&&e.isActive&&e.Hide()}),Dialog){if(Lure._DialogCount++,$this.Content.classList.add("lure-dialog"),DialogWrapper){$this.DialogWrapper=Lure.CreateElementFromString('<div class="dialog-wrapper">'),document.body.appendChild($this.DialogWrapper),$this.DialogWrapper.onclick=$this.Hide.bind($this);var zIndexWrapper=parseInt(window.getComputedStyle($this.DialogWrapper).zIndex),zIndexContent=parseInt(window.getComputedStyle($this.Content).zIndex);(Number.isNaN(zIndexContent)||zIndexContent<zIndexWrapper)&&($this.Content.style.zIndex=zIndexWrapper+1)}DialogBlur&&($this.DialogWrapper.style.background="none",Lure.Select(DialogBlur).classList.add("lure-blur")),DialogAnimation&&$this.Content.classList.add(DialogAnimation)}BeforeShow.call($this,e),Shower.call($this,e),$this.Content.style.display="",clearTimeout($this.__private.ToggleTimer),null!==Show&&($this.__private.ToggleTimer=setTimeout(function(){Show.call($this,e)},duration))},this.Hide=function(e){this.isActive=!1,this.Control&&this.Control.Disactive();var style=window.getComputedStyle($this.Content),duration=eval(style.transitionDuration.replace("ms","*1").replace("s","*1000")),durationAni=eval(style.animationDuration.replace("ms","*1").replace("s","*1000"));duration<durationAni&&(duration=durationAni),duration++,Dialog&&(Lure._DialogCount--,$this.DialogWrapper&&$this.DialogWrapper.remove(),DialogBlur&&Lure._DialogCount<1&&Lure.Select(DialogBlur).classList.remove("lure-blur")),Hider.call($this,e),clearTimeout($this.__private.ToggleTimer),null!==Hide&&($this.__private.ToggleTimer=setTimeout(function(){Hide.call($this,e)},duration))},this.Toggle=function(e){$this.isVisible?$this.Hide(e):$this.Show(e)},this.__private={},this.__private.ToggleTimer=null,this.Control=new Lure.Plugin.Content.Control(Control,$this),this.Content.onclick=OnClick?OnClick.bind($this):null,Array.isArray(SubContent))for(var i=0;i<SubContent.length;i++)SubContent[i].Parent||(SubContent[i].Parent=$this),$this[SubContent[i].Name]=new Lure.Content(SubContent[i]);else for(var cname in SubContent)SubContent[cname].Parent=$this,SubContent[cname].Name=cname,$this[cname]=new Lure.Content(SubContent[cname]);if(this.TitleContent=Lure.Select(Title,this.Content),"Untyped"!==Type||Visible===!1||Dialog?("Untyped"!==Type&&Visible!==!0||Dialog&&Visible!==!0)&&(Visible=!1):Visible=!0,Visible?(this.Content.style.display="",this.Control&&this.Control.Active()):(this.isActive=!1,this.Content.style.display="none"),Controller&&(Controller.isController?(this.Controller=Controller,this.Controller.Parent=this):(Controller.Target||(Controller.Target=this.Content),Controller.Type||(Controller.Type="Templator"),Controller.Parent=this,this.Controller=new Lure.Plugin.Content.Controller[Controller.Type](Controller)),this.Controller.isHasEditable&&Lure._EditablesEventListenerRun($this.Content)),Sorting){$this._Sorting={},$this._Sorting._sorter=null;var _loop2=function(e){Sorting.hasOwnProperty(e)&&"_sorter"!==e&&($this._Sorting[e]={Target:$this.Select(Sorting[e]),Sorted:!1},$this._Sorting[e].Target.classList.add("mt-sorting"),$this._Sorting[e].Target.addEventListener("click",function(){$this._Sorting._sorter=e,$this._SortBy(e,$this.Controller._Data)}))};for(var f in Sorting)_loop2(f);console.info("mt-sortable",$this._Sorting)}if(Filtering){$this._Filter={},$this._Filter._DataDefault=$this.Controller._Data.slice(0);var _loop3=function(e){Filtering.hasOwnProperty(e)&&"_format"!==e&&($this._Filter[e]={Target:$this.Select(Filtering[e]),Filter:""},$this._Filter[e].Target.classList.add("mt-filtering"),$this._Filter[e].Target.innerHTML='<input type="text" class="mt-filtering-input">',$this._Filter[e].Target.querySelector(".mt-filtering-input").addEventListener("keyup",function(t){$this._Filter[e].Filter=t.target.value.toLowerCase(),$this._FilterBy()}))};for(var f in Filtering)_loop3(f)}Lure.ContentList[$this.Type]||(Lure.ContentList[$this.Type]=[]),Lure.ContentList[$this.Type].push(this),Array.from(this.Content.children).forEach(function(e){e.classList.contains("close")&&(e.onclick=function(e){$this.Hide(e)})}),setTimeout(function(){AfterBuild.call($this)},1)}var _ref2$Target=_ref2.Target,Target=void 0===_ref2$Target?null:_ref2$Target,_ref2$Content=_ref2.Content,Content=void 0===_ref2$Content?null:_ref2$Content,_ref2$CSS=_ref2.CSS,CSS=void 0===_ref2$CSS?"":_ref2$CSS,_ref2$Name=_ref2.Name,Name=void 0===_ref2$Name?null:_ref2$Name,_ref2$Global=_ref2.Global,Global=void 0!==_ref2$Global&&_ref2$Global,_ref2$Title=_ref2.Title,Title=void 0===_ref2$Title?"":_ref2$Title,_ref2$Type=_ref2.Type,Type=void 0===_ref2$Type?"Untyped":_ref2$Type,_ref2$Visible=_ref2.Visible,Visible=void 0===_ref2$Visible?void 0:_ref2$Visible,_ref2$SubContent=_ref2.SubContent,SubContent=void 0===_ref2$SubContent?[]:_ref2$SubContent,_ref2$Dialog=_ref2.Dialog,Dialog=void 0!==_ref2$Dialog&&_ref2$Dialog,_ref2$DialogWrapper=_ref2.DialogWrapper,DialogWrapper=void 0===_ref2$DialogWrapper||_ref2$DialogWrapper,_ref2$DialogBlur=_ref2.DialogBlur,DialogBlur=void 0===_ref2$DialogBlur?null:_ref2$DialogBlur,_ref2$DialogAnimation=_ref2.DialogAnimation,DialogAnimation=void 0===_ref2$DialogAnimation?null:_ref2$DialogAnimation,_ref2$Show=_ref2.Show,Show=void 0===_ref2$Show?null:_ref2$Show,_ref2$Hide=_ref2.Hide,Hide=void 0===_ref2$Hide?null:_ref2$Hide,_ref2$Shower=_ref2.Shower,Shower=void 0===_ref2$Shower?function(){this.Content.style.display=""}:_ref2$Shower,_ref2$Hider=_ref2.Hider,Hider=void 0===_ref2$Hider?function(){this.Content.style.display="none"}:_ref2$Hider,_ref2$BeforeShow=_ref2.BeforeShow,BeforeShow=void 0===_ref2$BeforeShow?function(){}:_ref2$BeforeShow,_ref2$Refresh=_ref2.Refresh,Refresh=void 0===_ref2$Refresh?function(e,t){this.Controller&&this.Controller.Refresh(e,t)}:_ref2$Refresh,_ref2$Sorting=_ref2.Sorting,Sorting=void 0!==_ref2$Sorting&&_ref2$Sorting,_ref2$Filtering=_ref2.Filtering,Filtering=void 0!==_ref2$Filtering&&_ref2$Filtering,_ref2$OnClick=_ref2.OnClick,OnClick=void 0===_ref2$OnClick?null:_ref2$OnClick,_ref2$Controller=_ref2.Controller,Controller=void 0===_ref2$Controller?null:_ref2$Controller,_ref2$Control=_ref2.Control,Control=void 0===_ref2$Control?null:_ref2$Control,_ref2$Props=_ref2.Props,Props=void 0===_ref2$Props?function(){}:_ref2$Props,_ref2$Methods=_ref2.Methods,Methods=void 0===_ref2$Methods?function(){}:_ref2$Methods,_ref2$GetSet=_ref2.GetSet,GetSet=void 0===_ref2$GetSet?{}:_ref2$GetSet,_ref2$AfterBuild=_ref2.AfterBuild,AfterBuild=void 0===_ref2$AfterBuild?function(){}:_ref2$AfterBuild,_ref2$Disabled=_ref2.Disabled,Disabled=void 0!==_ref2$Disabled&&_ref2$Disabled,_ref2$Parent=_ref2.Parent,Parent=void 0===_ref2$Parent?null:_ref2$Parent;if(_classCallCheck(this,LureContent),!Disabled){var $this=this;if(this.isContent=!0,this.isActive=!0,this.Parent=Parent,null!==Parent?(this.Target=Global?Lure.Select(Target):Lure.Select(Target,this.Parent.Content),null===this.Target&&(this.Target=this.Parent.Content)):null!==Target&&(this.Target=Lure.Select(Target)),null===Content?(this.Content=this.Target,construct.call($this)):null===Content.match(/<[^>]+>/)?(console.log("get load"),Lure.GetFileText(Content).then(function(e){MakeContent.call($this,e),construct.call($this)})):(MakeContent.call($this,Content),construct.call($this)),null===this.Content||null===this.Target)return void(this.isContent=!1);if(""!==CSS){var node=document.createElement("style");node.innerHTML=CSS,document.body.appendChild(node)}}}return _createClass(LureContent,[{key:"RefreshOne",value:function(e){this.Controller&&this.Controller.RefreshOne(e)}},{key:"Remove",value:function(e,t){this.Controller&&this.Controller.Remove(e,t)}},{key:"Add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.Controller&&this.Controller.Add(e,t,i,n)}},{key:"Edit",value:function(e,t){this.Controller&&this.Controller.Edit(e,t)}},{key:"Dispose",value:function(){this.Content.remove(),this.Control.Disactive(),delete this.Controller,delete this.Control}},{key:"isVisible",get:function(){return Lure.isVisible(this.Content)}},{key:"Title",get:function(){return this.TitleContent.innerHTML},set:function(e){this.TitleContent.innerHTML=e}},{key:"Data",get:function(){return this.Controller?this.Controller.Data:null},set:function(e){this.Controller&&(this.Controller.Data=e)}},{key:"Items",get:function(){return this.Controller?this.Controller.Items:null}}]),LureContent}(),Control:function(){function e(t,i){var n=this;_classCallCheck(this,e),null!==t&&t.length>0&&!function(){for(var e=n,r=function(n){t[n].Name||(t[n].Name="unnamed_"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10)),e[t[n].Name]={Content:Lure.SelectAll(t[n].Target),_Content:t[n].Target,Type:t[n].Type?t[n].Type:"Untyped",isGlobal:t[n].Global,OnClick:t[n].OnClick?t[n].OnClick:i.Show,OnChange:t[n].OnChange,Active:function(){Lure.SelectAll(t[n].Target).forEach(function(e){e.classList.add("active")})},Disactive:function(){Lure.SelectAll(t[n].Target).forEach(function(e){e.classList.remove("active")})}},e[t[n].Name].Content.forEach(function(e){e.classList.add("pointer")}),t[n].Global?Lure.AddEventListenerGlobal("click",t[n].Target,function(r){Lure.SelectAll(t[n].Target).forEach(function(e){e.classList.remove("active")}),r.target.classList.add("active"),e[t[n].Name].OnClick&&e[t[n].Name].OnClick.call(i,r)}):e[t[n].Name].Content.forEach(function(r){r.onclick=function(r){Lure.ContentList[i.Type].forEach(function(e){e!==i&&e.Control&&e.Control.Disactive();
}),e[t[n].Name].Content.forEach(function(e){e.classList.remove("active")}),r.currentTarget.classList.add("active"),e[t[n].Name].OnClick.call(i,r)}}),t[n].OnChange&&(t[n].Global?Lure.AddEventListenerGlobal("change",t[n].Target,function(e){t[n].OnChange.call(i,e)}):e[t[n].Name].Content.forEach(function(e){e.onchange=function(e){t[n].OnChange.call(i,e)}}))},a=0;a<t.length;a++)r(a)}()}return _createClass(e,[{key:"Active",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var t in this)this[t].Type===e&&this[t].Content.forEach(function(e){e.classList.add("active")})}},{key:"Disactive",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untyped";for(var t in this)this[t].Type===e&&(this[t].Content.forEach(function(e){e.classList.remove("active")}),this[t].isGlobal&&Lure.SelectAll(this[t]._Content).forEach(function(e){e.classList.remove("active")}))}}]),e}(),Controller:{Templator:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.Target,n=void 0===i?null:i,r=t.Data,a=void 0===r?[]:r,o=t.ListElement,s=void 0===o?".list_element":o,l=t.EmptyMessage,u=void 0===l?"":l,c=t.EmptyHide,d=void 0!==c&&c,h=t.PageSize,f=void 0===h?-1:h,p=t.DataCount,g=void 0===p?-1:p,v=t.PageGet,C=void 0===v?null:v,b=t.ShowAllButton,m=void 0===b||b,S=t.LineSave,y=void 0===S?function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};setTimeout(function(){n()},500)}:S,_=t.LineAdd,L=void 0===_?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};setTimeout(function(){t()},500)}:_,T=t.EditModeSwitch,$=void 0===T?null:T,D=(t.DataSaveAll,t.NoAnimation),A=void 0!==D&&D,x=t.NoBuild,O=void 0!==x&&x,E=t.BeforeBuild,k=void 0===E?function(){}:E,P=t.AfterBuild,w=void 0===P?function(){}:P,B=t.AfterAdd,M=void 0===B?function(){}:B,H=t.Parent,G=void 0===H?null:H;_classCallCheck(this,e);var N=this;this.isController=!0,null!==G?this.Content=Lure.Select(n,G.Content):this.Content=Lure.Select(n),this.Target=this.Content,this._Data=a,this.EmptyMessage=u,this.ListElement="",this.BeforeBuild=k.bind(this),this.AfterBuild=w.bind(this),this.AfterAdd=M.bind(this),this.Parent=G,this.PageSize=f,this._PageSize=f,this._DataCount=g>0?g:this._Data.length,this._PageCursor=0,this._PageGet=C,this.LineAdd=L,this.LineSave=y,this.Type=null,this.isShowAllButton=m,this.isNoAnimaton=A,this.isEmptyHide=d;var F=[];this._Dictionary=F;var I=function(){N._Data||(N._Data={});for(var e=0;e<F.length;e++)for(var t=0;t<F[e].fields.length;t++){var i=F[e].fields[t].Target.indexOf("attributes")>-1,n=F[e].fields[t].BuildValue(N._Data);i?F[e].obj.attributes[F[e].fields[t].Target.split(".")[1]].value=n:F[e].obj[F[e].fields[t].Target]=F[e].fields[t].BuildValue(N._Data)}};this._Rebuilder=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N._Data,t="";0===N._PageCursor&&N.Content.querySelectorAll(".mt-line, .mt-paginator, .mt-empty").forEach(function(e){e.remove()});var i=void 0,n=e.length;if(N._DataCount=g>0?g:n,N.PageSize>0){N._DataCount=N._DataCount>0?N._DataCount:e.length;var r=N.Content.querySelector(".mt-paginator");null!==r&&r.remove(),n=parseInt(N._PageCursor)+parseInt(N.PageSize),n>N._DataCount&&N._DataCount>0&&(n=N._DataCount),i=N._DataCount-n,i>N.PageSize&&(i=N.PageSize)}if("ItemList"===N.Type&&0===e.length&&""!==N.EmptyMessage&&!N.isEmptyHide){var a=N.ListElement.match(/\s?([\w]+) /)[0].replace(/\s/g,""),o=document.createElement(a);return o.classList.add("mt-empty"),o.innerHTML=N.EmptyMessage,void N.Content.appendChild(o)}if("ItemList"===N.Type&&0===e.length&&N.isEmptyHide)return void(N.Content.style.display="none");if(0!==e.length){for(var s=N._PageCursor;s<n;s++)t+=N._LineBuilder(e[s],s,e.length);if(N.Content.children.length<1?N.Content.innerHTML=t:(t=Lure.CreateElementsFromString(t,N.Content.tagName),null!==t&&t.forEach(function(e){N.Content.appendChild(e)})),N.PageSize>0&&(N._PageCursor=n),N.PageSize>0&&N._PageCursor<N._DataCount){var l=void 0,u="<span>  (Не загружено "+(N._DataCount-N._PageCursor)+") </span>";N.isShowAllButton&&(u='<span> или </span><span class="mt-btn-nextAll dotted pointer"> Все ( '+(N._DataCount-N._PageCursor)+" )</span>");var c="table"===N.Content.tagName||"thead"===N.Content.tagName||"tbody"===N.Content.tagName;if(c){var d=N.Content.querySelector("tr:first-child th").length+1;l='<tr class="mt-paginator"><td colspan="'+d+'" class="element block-head"><span class="tpltr-next dotted pointer">Показать еще '+i+"</span>"+u+"</td></tr>",l=Lure.CreateElementFromString(l,N.Content.tagName)}else l=Lure.CreateElementFromString("<div class='mt-paginator'><span class=\"mt-btn-next dotted pointer\">Показать еще "+i+"</span>"+u+"</div>");var h=l.querySelector(".mt-btn-next");h.onclick=function(){N._PageCursor>=e.length?N._PageGet(N._PageCursor,N.PageSize,V):W()};var f=l.querySelector(".mt-btn-nextAll");f.onclick=function(){N.PageSize=N._DataCount,null!==N._PageGet?N._PageGet(N._PageCursor,N._DataCount-N._PageCursor,V):W()},N.Content.appendChild(l)}}};var W=function(){N.BeforeBuild(),"Refresh"===N.Type?I():"ItemList"===N.Type&&N._Rebuilder(),N.AfterBuild()},V=function(e){for(var t=0;t<e.length;t++)N._Data.push(e[t]);W()};if(this.FieldAdd=function(e){for(var t=e.attributes,i=[],n=-1,r=0;r<t.length;r++)t[r].value.indexOf("{{")>-1&&("value"!==t[r].name?i.push({Target:"attributes."+t[r].name,BuildValue:Lure.Compile(t[r].value)}):i.push({Target:t[r].name,BuildValue:Lure.Compile(t[r].value)}),n=0);e.childNodes.length<2&&e.innerHTML.indexOf("{{")>-1&&(i.push({Target:"innerHTML",BuildValue:Lure.Compile(e.innerHTML)}),n=0!==n?1:2),n>-1&&F.push({obj:e,fields:i})},this.Refresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;N.PageSize=N._PageSize,N._PageCursor=0,null!==e&&(N._Data=e),N.PageCursor=0,null===t?W():N.RefreshOne(t)},this.RefreshOne=function(e){var t=Lure.CreateElementFromString(N._LineBuilder(N._Data[e],e,N._Data.length),N.Content.tagName),i=N.Items[e];N.Items[e].parentNode.replaceChild(t,i)},this.Add=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];0===N._Data.length&&null!==N.Content.querySelector(".mt-empty")&&N.Content.querySelector(".mt-empty").remove();var r=document.createDocumentFragment(),a=document.createElement(N.Content.tagName),o=void 0;if(i){for(o=0,N.Items.forEach(function(e){console.log(e),console.log(e.dataset.line),e.dataset.line=parseInt(e.dataset.line)+1}),a.innerHTML=N._LineBuilder(e,0,N._Data.length+1);a.childNodes[0];)r.appendChild(a.childNodes[0]);t&&r.children[0].classList.add(t),n&&N._Data.unshift(e),N.Content.prepend(r)}else{for(o=N._Data.length,n||o--,a.innerHTML=N._LineBuilder(e,o,o+1);a.childNodes[0];)r.appendChild(a.childNodes[0]);t&&r.children[0].classList.add(t),n&&N._Data.push(e),N.Content.appendChild(r)}null!==N.LineAdd&&N.LineAdd(e,function(){var e=N.Content.querySelector("."+t);e&&e.classList.remove(t)}),N.AfterAdd(e,o)},this.Edit=function(e,t){console.log("edit itemData",t,e),Array.from(N.Items).filter(function(e){return parseInt(e.dataset.line)===t})[0].classList.add("editable-waiting"),N.LineSave(t,"$this",e,function(){N._Data[t]=e,N.RefreshOne(t)})},this.Remove=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];N.Content.querySelector('.mt-line[data-line="'+e+'"]').remove();for(var i=e;i<N.Items.length;i++)N.Items[i].dataset.line=parseInt(N.Items[i].dataset.line)-1,N.Items[i].querySelectorAll("[data-line]").forEach(function(e){e.dataset.line=parseInt(e.dataset.line)-1});t&&N._Data.splice(e,1),0===N._Data.length&&N.Refresh()},this.SwitchToEditMode=function(){Lure.Editable.EditMode=!0,Lure.SelectAll(".editable",N.Content).forEach(function(e){Lure.Editable.AddEdits(e)})},Array.isArray(this._Data)){this.Type="ItemList";var R=null!==s.match(/^[a-zA-Z0-9.,\-_ *#]+$/g);if(R){var Y=this.Content.querySelector(s);Y.classList.add("mt-line"),s=Y.outerHTML,Y.remove()}else{var j=s.match(/<[^>]+>/)[0],z=void 0,q=j.indexOf('class="');q<0?z=j.substr(0,j.length-1)+' class="mt-line"'+j.substr(j.length-1):(q=j.indexOf('"',q+8),z=j.substr(0,q)+" mt-line"+j.substr(q)),s=s.replace(j,z)}s=s.replace(/<[\s\S]+?(>)/,function(e,t){return e.replace(t,' data-line="{{i}}">')}),this.ListElement=s,this._LineBuilder=Lure.Compile(s,!0),null!==s.match(/<[^>]+class=['"][\w\d\s-]*(editable)[\w\d\s-]*['"][^>]*>([^<]*)<[^>]*>/)&&(this.isHasEditable=!0,null!==$&&Lure.Select($).addEventListener("change",function(e){e.currentTarget.checked?N.SwitchToEditMode():(Lure.Editable.EditMode=!1,document.body.click())})),this.Content.MonsieurController=this,this.Content.classList.add("mt-content")}else{this.Type="Refresh";var X=Array.prototype.slice.call(this.Content.querySelectorAll("*:not(g):not(path):not(clipPath):not(text):not(br)"));X.push(this.Content),X.forEach(function(e){N.FieldAdd(e)})}Lure.TemplatorList.push(this),O||W()}return _createClass(e,[{key:"Data",get:function(){return this._Data},set:function(e){this._Data=e}},{key:"Items",get:function(){return this.Content.querySelectorAll(".mt-line")}}]),e}(),TreeBuilder:function(){function e(t){var i=t.Target,n=void 0===i?null:i,r=t.Data,a=void 0===r?[]:r,o=t.ListElement,s=void 0===o?null:o,l=t.Drop,u=void 0!==l&&l,c=t.SubSelector,d=void 0===c?null:c,h=t.SubSelectorHandler,f=void 0===h?function(){}:h,p=t.BeforeBuild,g=void 0===p?function(){}:p,v=t.AfterBuild,C=void 0===v?function(){}:v,b=t.Parent,m=void 0===b?null:b;_classCallCheck(this,e),this.isController=!0,this.Content=Lure.Select(n),this.Target=this.Content,this.Parent=m,this._Data=a,this.SubSelector=d,this.SubSelectorHandler=f.bind(this),this.BeforeBuild=g.bind(this),this.AfterBuild=C.bind(this);var S=u?"mtb-sub_tree dropable":"mtb-sub_tree",y=0,_=null===s?this.Content.innerHTML:s;null===this.SubSelector&&(this.SubSelector=".mtb-sub_tree",_=_.replace(/^([\s\S]*)(<\/\w+>)$/,function(e,t,i){return i='<div class="'+S+'"></div>'+i,t+i})),this.LineBuilder=Lure.Compile(_,!0);var L=this,T=0,$=function A(e,t,i){T++;var n={$lvl:y,$key:t,$index:T,$j:i},r=Lure.CreateElementFromString(L.LineBuilder(e,T,null,n));r.classList.add("mtb-branch");for(var a in e){var o=e[a];if(Array.isArray(o)){y++;for(var s=0;s<o.length;s++)if(null===L.SubSelector)r.appendChild(A(o[s],a,s));else{r.classList.add("mtb-has_tree"),u&&r.classList.add("dropable");var l=r.querySelector(L.SubSelector);l.appendChild(A(o[s],a,s))}y--}}return r},D=function(){if(L.BeforeBuild(),Array.isArray(L._Data)){L.Content.innerHTML="",y++;for(var e=0;e<L._Data.length;e++)L.Content.appendChild($(L._Data[e],"root",0));y--}else L.Content.appendChild($(L._Data,"root",0));y=0,T=0,L.AfterBuild()};D(this._Data),this.Refresh=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L._Data;L._Data=e,D()}}return _createClass(e,[{key:"Data",get:function(){return this._Data},set:function(e){this._Data=e}}]),e}()}},Lure.Content=Lure.Plugin.Content.Content,Lure.Plugin.Tutor=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,t);var n=this;this.TargetButton=Lure.Select(e),this.TargetContent=Lure.Select(i);var r='<div class="lure-tutor">\n                        <div class="cd-caption">\n                            <span>Шаг </span>\n                            <span class="lure-tutor_step"></span>\n                        </div>\n                        <div class="lure-tutor_desc"></div>\n                        <div class="lure-tutor_btns">\n                            <button class="button btn-tutor btn-tutor-stop">Прервать обучение</button>\n                            <button class="button btn-tutor btn-tutor-next">Далeе →</button></div>\n                   </div>';this.Content=Lure.CreateElementFromString(r),this.ContentBG=Lure.CreateElementFromString('<div class="lure-tutor-bg dialog-wrapper"></div>'),this.Content.style.display="none",this.ContentBG.style.display="none",this._Description=this.Content.querySelector(".lure-tutor_desc"),this._Step=this.Content.querySelector(".lure-tutor_step"),this._ButtonNext=this.Content.querySelector(".btn-tutor-next"),this._ButtonStop=this.Content.querySelector(".btn-tutor-stop"),n.Data=[];var a=this._ButtonNext.innerHTML,o=0,s=document.createElement("div");s.style.display="none",document.body.appendChild(s);var l=window.getComputedStyle(s).backgroundColor;s.remove();var u=function(){var e=n.Data[o-1].obj;if("tr"!==e.tagName.toLowerCase())return e.style.zIndex="",e.style.position="",e.style.outline="",e.style.display="",void(e.style.backgroundColor="");var t=e.querySelectorAll("th, td");t.forEach(function(e){e.style.position="",e.style.zIndex=""})},c=function(e){if("tr"!==e.tagName.toLowerCase()){e.style.zIndex="11",e.style.position="relative",e.style.outline="5px #bee0ff solid";var t=window.getComputedStyle(e);return t.backgroundColor===l&&(e.style.backgroundColor="#fff"),void(Lure.isVisible(e)||("table"!==e.tagName.toLowerCase()?e.style.display="block":e.style.display="table"))}var i=e.querySelectorAll("th, td");i.forEach(function(e){e.style.zIndex="11",e.style.position="relative";var t=window.getComputedStyle(e);t.backgroundColor===l&&(e.style.backgroundColor="#fff")})},d=function(){if(console.log("tutor run"),null!==n.TargetContent){var e=n.TargetContent.querySelectorAll('*[data-tutor]:not([data-line]), *[data-tutor][data-line="0"]');if(e.length<1)return void Lure.Confirm("Сообщение","На этом экране нет подсказок");e.forEach(function(e){n.Data.push({obj:e,desc:e.dataset.tutor})}),n.Content.style.display="",n.ContentBG.style.display="",h()}},h=function(){if(o>0&&u(),o===n.Data.length)return void f();var e=n.Data[o].obj,t=n.Data[o].desc,i=t.match(/{([\s\S]+)}/);null!==i&&(i=i[1],t=t.replace(/{([\s\S]+)}/,""),e=e.closest(i),n.Data[o].obj=e),c(e),n._Step.innerHTML=o+1+"/"+n.Data.length,n._Description.innerHTML=t,o+1===n.Data.length&&(n._ButtonNext.innerHTML="Завершить",n._ButtonStop.style.opacity="0");var r=e.offsetLeft+e.clientWidth+10,a=e.offsetTop-n.Content.clientHeight-10;a<10&&(a=10),r+n.Content.clientWidth>window.innerWidth&&(r=e.offsetLeft-n.Content.clientWidth-10,window.innerWidth<n.Content.clientWidth+e.clientWidth&&(r=e.offsetLeft+e.clientWidth-n.Content.clientWidth-20)),(document.documentElement.scrollTop>a||document.documentElement.scrollTop+window.innerHeight<e.offsetTop+e.offsetHeight)&&(document.documentElement.scrollTop=a-10+"px"),r<10&&(r=10),n.Content.style.left=r+"px",n.Content.style.top=a+"px",o++},f=function(){u(),n.Content.style.display="none",n.ContentBG.style.display="none",n._ButtonNext.innerHTML=a,n._ButtonStop.style.opacity="",o=0,n.Data=[]};this.TargetButton.onclick=d,this._ButtonNext.onclick=h,this._ButtonStop.onclick=f,document.body.appendChild(this.Content),document.body.appendChild(this.ContentBG),this.Run=d},Lure.Plugin.Load=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.Target,n=void 0===i?"body":i;_classCallCheck(this,e),this.Target=Lure.Select(n),this.Target.style.position="relative",this.Content=Lure.CreateElementFromString('<div class="ajax-loading" style="display: none"></div>');var r=60,a=60,o=function(e,t){for(var i=" M "+(r+e)+" "+a,n=0;n<t;n++){var o=n*(Math.PI/180),s=r+Math.cos(o)*e,l=a+Math.sin(o)*e;i+=" L "+s+" "+l}return i},s='<svg xmlns="http://www.w3.org/2000/svg">\n                     <path d="'+o(45,160)+'" class="lure-arc1" fill="none" stroke="#449b22" stroke-width="5"></path>\n                     <path d="'+o(40,130)+'" class="lure-arc2" fill="none" stroke="#61c8de" stroke-width="5"></path>\n                     <path d="'+o(35,100)+'" class="lure-arc3" fill="none" stroke="#761c19" stroke-width="5"></path>\n                     <path d="'+o(30,70)+'"  class="lure-arc4" fill="none" stroke="#333333" stroke-width="5"></path>\n                   </svg>';this.Target.appendChild(this.Content),this.Content.innerHTML=s,this.Timeout=null}return _createClass(e,[{key:"Show",value:function(){var e=this;this.Content.style.display="",clearTimeout(this.TimeoutHide),this.Timeout=setTimeout(function(){e.Content.style.display="block"},70)}},{key:"Hide",value:function(){var e=this;clearTimeout(this.Timeout),this.TimeoutHide=setTimeout(function(){e.Content.style.display="none"},250)}}]),e}(),Lure.Plugin.Tooltip=function i(e){var t=e.Target,n=void 0===t?document:t,r=e.Attribute,a=void 0===r?"data-tooltip":r,o=e.Delay,s=void 0===o?400:o,l=e.Time,u=void 0===l?1100:l,c=(e.Cursor,e.Custom),d=void 0===c?'<div class="lure-tooltip">':c,h=e.AfterBuild,f=void 0===h?function(){}:h;_classCallCheck(this,i);var p=this;this.ToolTip=Lure.CreateElementFromString(d);var g=null,v=null;this.Target=Lure.Select(n);var C=function(e){this.ToolTip.innerHTML=e,p.Target.appendChild(this.ToolTip)}.bind(this);Lure.AddEventListenerGlobal("mouseover","["+a+"]",function(e){var t=e.currentTarget.dataset[a.replace("data-","")];clearTimeout(v),g=setTimeout(function(){C(t)},s)},this.Target),Lure.AddEventListenerGlobal("mouseout","["+a+"]",function(e){clearTimeout(g),v=setTimeout(function(){},u)},this.Target),setTimeout(function(){f.bind(p)},0)},Lure.Tutor=Lure.Plugin.Tutor,Lure.Load=Lure.Plugin.Load,Lure.Tooltip=Lure.Plugin.Tooltip,Lure.Plugin.Chart={Version:"v0.1.0    05.09.2017",Core:{Defaults:{Color:["red","green","cornflowerblue","purple","palevioletred","orange","tomato","darkblue"],TemplateLabel:{Line:"Name: {{Name}}<br>Value: {{Value}}",Pie:"Name: {{Name}}<br>Value: {{Value}}"}}},Chart:function(){function e(){function t(){console.log("------refresh------"),_.SeriesBar=0,_.SeriesCount.Line=0,_.SeriesCount.Bar=0,_.SeriesCount.Pie=0,_.SeriesCount.Ring=0,_.Svg="",S.Reset(),$.Series(),S.Perf("Init-Series"),L.Legend(),S.Perf("Render-Legend"),$.AxisY(),S.Perf("Init-AxisY"),$.AxisX(),L.AxisX(),S.Perf("Init-AxisX"),$.ScaleY(),S.Perf("Init-AxisYScales"),this.Block.Grid=L.MakeGrid(),S.Perf("Render-Grid"),this.Block.AxisY=L.MakeAxisY(),S.Perf("Render-AxisY"),this.isCasual?this.Block.Svg=y.__GetSvgCasual():this.Block.Svg=y.__GetSvgPie(),this.Block.AxisY.style.height=this.Height+"px",S.Perf("Render-Svg");var e=Lure.SelectAll('.l-chart-serie[data-type="Line"] path',this.Content);D.Height=this.Height,D.Width=this.Width,e.forEach(function(e){var t=e.getTotalLength();e.style.strokeDasharray=t,e.style.strokeDashoffset=t}),S.Perf("Animations-add"),S.Elapsed("-elapsed-")}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.Type,a=void 0===r?"Line":r,o=n.Title,s=void 0===o?"":o,l=n.Labels,u=void 0===l?{Rotation:"auto",Data:[]}:l,c=n.Grid,d=void 0===c?{}:c,h=n.Series,f=void 0===h?[]:h,p=n.Tooltip,g=void 0===p?{Template:null}:p,v=n.AxisY,C=void 0===v?{Scale:["auto","auto","auto"],Visible:!0}:v,b=(n.Height,n.SeriesOptions,n.Disabled),m=void 0!==b&&b;if(_classCallCheck(this,e),!m){var S=new Lure.Diagnostics.Perf;Lure.Chart.Count++;var y=this;this.Content=Lure.Select(i),this.isCasual=!0;var _={Legend:"",AxisX:"",AxisY:"",Grid:"",Svg:"",Height:0,Width:0,Abscissa:null,SeriesPoints:[],SeriesCount:{Line:0,Bar:0,Pie:0,Ring:0},SeriesBar:0,ParametersAxisX:null};this._Series=f,this.Options={Type:a?a.toLowerCase():"line",Title:s?s:"",Legend:{Visible:!0},Labels:{Visible:"undefined"==typeof u.Visible||u.Visible,Rotation:u.Rotation?u.Rotation:"auto",Data:u.Data?u.Data:[],Font:{Family:"sans-serif",Size:"0.8rem"}},Grid:{Visible:"undefined"==typeof d.Visible||d.Visible},Series:null,SeriesOptions:{BarStack:!1,BarGradient:!0,PieStack:!1,PieType:"pie"},AxisY:{Font:{Family:"sans-serif",Size:"0.8rem"},Scale:C.Scale?[Lure.isNumeric(C.Scale[0])?C.Scale[0]:"auto",Lure.isNumeric(C.Scale[1])?C.Scale[1]:"auto",Lure.isNumeric(C.Scale[2])?C.Scale[2]:"auto"]:["auto","auto","auto"],Visible:"undefined"==typeof C.Visible||C.Visible,Title:C.Title},Padding:0,Tooltip:{Template:null}},this.Block=function(){this.Content.innerHTML='<div class="l-chart col">\n                                        <div>\n                                          <div class="l-title">'+s+'</div>\n                                          <div class="l-legend row"></div>\n                                        </div>\n                                        <div class="row flex-100">\n                                          <div class="l-axis-y row"></div>\n                                          <div class="col flex-100">\n                                            <div class="l-chart-area row flex-100" style="position: relative">\n                                              <svg class="l-chart-svg flex-100" style="position: relative; z-index: 1"></svg>\n                                              <div class="l-grid col flex-between"></div>\n                                            </div>\n                                            <div class="l-axis-x row"></div>\n                                           </div>\n                                        </div>\n                                      </div>';var e=this.Content.querySelector(".l-legend"),t=this.Content.querySelector(".l-axis-x"),i=this.Content.querySelector(".l-axis-y"),n=this.Content.querySelector(".l-chart-area"),r=this.Content.querySelector(".l-grid"),a=this.Content.querySelector(".l-chart-svg");return{get Legend(){return e},set Legend(t){e.innerHTML=t},get AxisX(){return t},set AxisX(e){t.innerHTML=e},get AxisY(){return i},set AxisY(e){i.innerHTML=e},get ChartArea(){return n},set ChartArea(e){n.innerHTML=e},get Grid(){return r},set Grid(e){r.innerHTML=e},get Svg(){return a},set Svg(e){a.innerHTML=e}}}.bind(this)();var L={Legend:function(){if(""===_.Legend){var e=Lure.Chart.MakeLegend;this.isCasual||(e=Lure.Chart.MakeLegendPie);for(var t=0;t<this.Options.Series.length;t++)_.Legend+=e(this.Options.Series[t],t);this.Block.Legend=_.Legend}}.bind(this),AxisX:function(){if(!y.Options.Labels.Visible)return void(this.Block.AxisX="");for(var e=y.Options.Labels.Data,t="transform: translate("+_.AxisXParams.MarginLeft+"px) rotate("+_.AxisXParams.Angle+"deg); margin-top: "+_.AxisXParams.MarginTop+"px ; width: "+_.AxisXParams.Width+"px;",i="",n=0;n<e.length;n++)i+='<div class="l-label l-label__x" style="font-family: '+y.Options.Labels.Font.Family+"; font-size: "+y.Options.Labels.Font.Size+'"><span style="'+t+'">'+e[n]+"</span></div>";_.AxisX=i,this.Block.AxisX=i,this.Block.AxisX.style.borderTop="1px #111 solid"}.bind(this),AxisY:function(){return!this.Options.Labels.Visible,""}.bind(this),MakeAxisY:function(){var e=0;if(!y.Options.AxisY.Visible&&(e=1,!y._ScaleY.Scales||y._ScaleY.Scales.length<2))return"";var t="font-family: "+y.Options.Labels.Font.Family+"; font-size: "+y.Options.Labels.Font.Size+";",i="";for(e;e<y._ScaleY.Scales.length;e++){var n=y._ScaleY.Dict.indexOf(e),r=y._ScaleY.Scales[e],a="";e>0?a='<div class="l-caption"><div style="transform: matrix(0, -1, 1, 0, 0, 0);">'+y.Options.Series[n].Title+"</div></div>":0===e&&y.Options.AxisY.Title&&(a='<div class="l-caption"><div style="transform: matrix(0, -1, 1, 0, 0, 0); font-weight: bold;">'+y.Options.AxisY.Title+"</div></div>");for(var o="",s=0;s<r.length;s++)o+='<div class="l-label l-label__y"><span>'+r[s]+"</span></div>";e>0&&(t+=" color: "+y.Options.Series[n].Color+"; font-weight: bold;"),i+='<div class="l-axis-y-scale row" style="'+t+'" data-line="'+e+'">'+a+'<div class="l-labels col">'+o+"</div></div>"}return i},MakeAxisX:function(){if(!y.Options.Labels.Visible)return"";for(var e=y.Options.Labels.Data,t="transform: translate("+_.AxisXParams.MarginLeft+"px) rotate("+_.AxisXParams.Angle+"deg); margin-top: "+_.AxisXParams.MarginTop+"px ; width: "+_.AxisXParams.Width+"px;",i="",n=0;n<e.length;n++)i+='<div class="l-label l-label__x" style="font-family: '+y.Options.Labels.Font.Family+"; font-size: "+y.Options.Labels.Font.Size+'"><span style="'+t+'">'+e[n]+"</span></div>";return i},MakeGrid:function(e,t){return y.Options.Grid.Visible?Lure.Chart.GetGrid(y.Options.Labels.Data.length,y._ScaleY.Scales[0].length-1,y.Options.Padding):""},MakeGraph:function(e,t){var i=y._ScaleY.Dict[t],n=y._ScaleY.Scales[i],r=y._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(e.Data,n,r,y.Height),o=Lure.Chart.GetAbscissa(y.Options.Labels.Data,y.Width),s=Lure.Chart.GetPoints(o,a);return Lure.Chart.GetPath(s,y.Options.Series[t].Type,t,y.Options.Series[t].Color,y.Options.Series[t].Width)}},T={Activate:function(e){var t=e.dataset.type;switch(t){case"line":T.ActivateCircle(e);break;case"bar":T.ActivateBar(e);break;case"pie":T.ActivatePie(e)}},Disactivate:function(e){var t=e.dataset.type;switch(t){case"line":T.DisactivateCircle(e);break;case"bar":T.DisactivateBar(e);break;case"pie":T.DisactivatePie(e)}},ActivateCircle:function(e){var t=(parseInt(e.dataset.line),parseInt(e.dataset.item),e.attributes.stroke.value),i=parseInt(e.attributes["stroke-width"].value);e.attributes.fill.value=t,e.attributes.r.value=parseInt(e.attributes.r.value)+i,e.attributes.stroke.value="#fff"},ActivateBar:function(e){e.setAttribute("fill-opacity",.2);parseInt(e.dataset.line),parseInt(e.dataset.item)},ActivatePie:function(e){e.setAttribute("stroke-opacity",.2);parseInt(e.dataset.line),parseInt(e.dataset.item)},DisactivateCircle:function(e){var t=parseInt(e.attributes["stroke-width"].value),i=e.attributes.fill.value;"#fff"!==i&&(e.attributes.stroke.value=i,e.attributes.fill.value="#fff",e.attributes.r.value-=t)},DisactivateBar:function(e){e.setAttribute("fill-opacity",0)},DisactivatePie:function(e){e.setAttribute("stroke-opacity",0)}},$={Tooltip:function(){return g.Template?void(this.Options.Tooltip.Template=g.Template):"line"===this.Options.Type||"bar"===this.Options.Type?void(this.Options.Tooltip.Template=Lure.Plugin.Chart.Core.Defaults.TemplateLabel.Line):void("pie"!==this.Options.Type&&"ring"!==this.Options.Type||(this.Options.Tooltip.Template=Lure.Plugin.Chart.Core.Defaults.TemplateLabel.Pie))}.bind(this),Series:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];if(null===this.Options.Series||e){for(var i=0;i<this._Series.length;i++){var n={};n.Name=this._Series[i].Name?this._Series[i].Name:"Unnamed",n.Title=this._Series[i].Title?this._Series[i].Title:n.Name,n.Color=this._Series[i].Color?this._Series[i].Color:Lure.Plugin.Chart.Core.Defaults.Color[i]?Lure.Plugin.Chart.Core.Defaults.Color[i]:"#000",n.Width=this._Series[i].Width?this._Series[i].Width:2,n.Data=JSON.parse(JSON.stringify(this._Series[i].Data)),n.Type=this._Series[i].Type?this._Series[i].Type.toLowerCase():a?a.toLowerCase():"line","pie"!==n.Type&&"ring"!==n.Type||(this.isCasual&&(this.isCasual=!1),n.Colors=this._Series[i].Colors?this._Series[i].Colors:Lure.Plugin.Chart.Core.Defaults.Color,n.Width=this._Series[i].Width?this._Series[i].Width:30,n.Labels=this._Series[i].Labels?this._Series[i].Labels:!!this.Options.Labels.Data&&this.Options.Labels.Data),n.Line=i,n.isVisible="undefined"==typeof this._Series[i].Visible||this._Series[i].Visible,n.OwnAxis=this._Series[i].OwnAxis,n.Point=this._Series[i].Point,n.Point=Lure.Chart.GetSeriePointOptions(n),n.isVisible&&_.SeriesCount[n.Type.capitalize()]++,t.push(n)}this.Options.Series=t}else for(var r=0;r<this.Options.Series.length;r++)this.Options.Series[r].isVisible&&_.SeriesCount[this.Options.Series[r].Type.capitalize()]++}.bind(this),AxisY:function(){if(this.Width!==D.Width){for(var e=(this.Options.AxisY.Visible?1:0,0),t=0,i=0;i<this.Options.Series.length;i++)if(this.Options.Series[i].isVisible&&this.Options.Series[i].OwnAxis){for(var n=0,r=0;r<this.Options.Series[i].Data.length;r++){var a=Lure.GetTextWidth(this.Options.Series[i].Data[r],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);a>n&&(n=this.Options.Series[i].Data[r])}var o=Lure.GetTextWidth(this.Options.Series[i].OwnAxis[1],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);o>n&&(n=o),t+=n+8;var s=Lure.GetTextWidth(this.Options.Series[i].Title,this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);t+=s>30?30:s}else if(this.Options.Series[i].isVisible&&!Array.isArray(this.Options.Series[i].OwnAxis))for(var l=0;l<this.Options.Series[i].Data.length;l++){var u=Lure.GetTextWidth(this.Options.Series[i].Data[l],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);u>e&&(e=this.Options.Series[i].Data[l])}t+=e+10+7,_.AxisYWidth=t}}.bind(this),AxisX:function(){if(this.Width!==D.Width){if(!this.Options.Labels.Visible)return void(_.AxisXParams={Height:0,Width:0,MarginTop:0,MarginLeft:0,Angle:0});for(var e=0,t=0;t<this.Options.Labels.Data.length;t++){var i=Lure.GetTextWidth(this.Options.Labels.Data[t],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);i>e&&(e=i)}var n=(this.Content.clientWidth-_.AxisYWidth)/this.Options.Labels.Data.length;n=(this.Content.clientWidth-_.AxisYWidth-n/2)/this.Options.Labels.Data.length,this.Options.Padding=n/2,this.Block.AxisX.style.paddingLeft=n/2+"px";var r=0,a=e,o=void 0;if("auto"!==this.Options.Labels.Rotation)o=parseFloat(this.Options.Labels.Rotation);else{var s=n/a;s<.15&&(s=0),s>1&&(s=1),o=-(180*Math.acos(s)/Math.PI).toFixed(2)}_.AxisXParams={Height:Math.round(Math.sqrt(Math.pow(a,2)-Math.pow(n,2)))+parseFloat(getComputedStyle(this.Block.AxisX).lineHeight),Width:a,MarginTop:a>n?Math.sqrt(Math.pow(a,2)-Math.pow(n,2))-r:0,MarginLeft:a>n?-n/2:-a/2,Angle:o}}}.bind(this),ScaleY:function(){return void(this._ScaleY=Lure.Chart.GetScaleY(this.Options.Series,this.Height,this))}.bind(this),Listeners:function(){Lure.AddEventListenerGlobal("mouseover",".lc-legend-casual-label",function(e){var t=e.currentTarget.dataset.line;if(this.Options.Series[t].isVisible){for(var i=Lure.SelectAll('.l-tooltipable[data-line="'+t+'"]',y.Block.Svg),n=0;n<i.length;n++)T.Activate(i[n]);var r=Lure.Select('.l-chart-serie[data-line="'+t+'"] path',y.Block.Svg);if(r){var a=parseFloat(r.getAttribute("stroke-width"));r.setAttribute("stroke-width",a+1)}}}.bind(this),this.Block.Legend),Lure.AddEventListenerGlobal("mouseout",".lc-legend-casual-label",function(e){var t=e.currentTarget.dataset.line;if(this.Options.Series[t].isVisible){for(var i=Lure.SelectAll('.l-tooltipable[data-line="'+t+'"]',y.Block.Svg),n=0;n<i.length;n++)T.Disactivate(i[n]);var r=Lure.Select('.l-chart-serie[data-line="'+t+'"] path',y.Block.Svg);if(r){var a=parseFloat(r.getAttribute("stroke-width"));r.setAttribute("stroke-width",a-1)}}}.bind(this),this.Block.Legend),Lure.AddEventListenerGlobal("change",".l-legend-checkbox",function(e){this.SerieSwitch(e.currentTarget.dataset.line,e.currentTarget.dataset.item)}.bind(this),this.Block.Legend),Lure.AddEventListenerGlobal("mouseover",".l-tooltipable",function(e){this.Tooltip.Do(e)},this.Content,this),Lure.AddEventListenerGlobal("mouseout",".l-tooltipable",function(e){y.Tooltip.Undo(e)},this.Content)}.bind(this)},D={Width:0,Height:0,DataLength:0};this.__GetPathLine=function(e,t){_.Abscissa&&_.Width===this.Width||(_.Abscissa=Lure.Chart.GetAbscissa(y.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[t],n=this._ScaleY.Scales[i],r=y._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(e.Data,n,r,y.Height),o=Lure.Chart.GetPoints(_.Abscissa,a,this.Options.Padding);_.SeriesPoints[t]=o;for(var s=o.length,l=[],u=[],c=[],d=[],h=[],f=[],p=0;p<s;p++)l[p]=o[p][0],u[p]=o[p][1];for(var g=0;g<s-1;g++)c[g]=u[g+1]-u[g],d[g]=l[g+1]-l[g],h[g]=c[g]/d[g];f[0]=h[0],f[s-1]=h[s-2];for(var v=1;v<s-1;v++)0===h[v]||0===h[v-1]||h[v-1]>0!=h[v]>0?f[v]=0:(f[v]=3*(d[v-1]+d[v])/((2*d[v]+d[v-1])/h[v-1]+(d[v]+2*d[v-1])/h[v]),isFinite(f[v])||(f[v]=0));for(var C="M "+l[0]+","+u[0],b='<g class="mt-chart-dots">',m=0;m<s-1;m++)C+=" C "+(l[m]+d[m]/3)+","+(u[m]+f[m]*d[m]/3)+" "+(l[m+1]-d[m]/3)+","+(u[m+1]-f[m+1]*d[m]/3)+" "+l[m+1]+","+u[m+1],e.Point.Visible&&(b+=Lure.Chart.GetPathLineDot(l[m],u[m],t,m,e.Color,e.Point.Radius));return e.Point.Visible&&(b+=Lure.Chart.GetPathLineDot(l[s-1],u[s-1],t,s-1,e.Color,e.Point.Radius)),b+="</g>",'<g class="l-chart-serie" data-type="Line" data-line="'+t+'"><path data-line="'+t+'" d="'+C+'" fill="none" stroke="'+e.Color+'" stroke-width="'+e.Width+'"></path> '+b+"</g>";
}.bind(this),this.__GetPathBar=function(e,t){_.Abscissa&&_.Width===this.Width||(_.Abscissa=Lure.Chart.GetAbscissa(y.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[t],n=this._ScaleY.Scales[i],r=y._ScaleY.MinMax[i],a=Lure.Chart.GetOrdinata(e.Data,n,r,y.Height),o=Lure.Chart.GetPoints(_.Abscissa,a,this.Options.Padding);_.SeriesPoints[t]=o;var s=this.Height,l=1;this.Options.SeriesOptions.BarStack||(l=.8*_.SeriesCount.Bar);var u=this.Width/this.Options.Labels.Data.length/2/l,c=1.2*u*_.SeriesBar-(1.2*u*_.SeriesCount.Bar/2-1.2*u/2),d='<g class="l-chart-serie" data-type="Bar" data-line="'+t+'">',h="";this.Options.SeriesOptions.BarGradient&&(h="lc-gradient-"+Lure.Chart.Count,d+='<linearGradient id="'+h+'"  x1="0" y1="0%"><stop offset="0%" stop-color="rgba(0,0,0,0.2)"/><stop offset="33%" stop-color="rgba(255,255,255,0.2)"/><stop offset="100%" stop-color="rgba(0,0,0,0.3)"/></linearGradient>');for(var f="",p=0;p<o.length;p++){var g="M "+(c+o[p][0]-u/2)+" "+s+" L "+(c+o[p][0]+u/2)+" "+s+" "+(c+o[p][0]+u/2)+" "+o[p][1]+" "+(c+o[p][0]-u/2)+" "+o[p][1]+"Z";d+='<g class="lc-bar-elem"><path class="lc-bar-elem" data-line="'+t+'" data-item="'+p+'" d="'+g+'" fill="'+e.Color+'" stroke="#000" stroke-width="0"></path>',this.Options.SeriesOptions.BarGradient&&(d+='<path class="lc-bar-elem-gradient"  data-line="'+t+'" data-item="'+p+'" d="'+g+'" fill="url(#'+h+')" ></path>'),d+='<path class="l-tooltipable" data-type="bar" data-line="'+t+'" data-item="'+p+'" d="'+g+'" fill="#fff" fill-opacity="0" stroke="#fff" stroke-width="0"></path>',d+="</g>"}return d+=f+"</g>",_.SeriesBar++,d}.bind(this),this.__GetSvgCasual=function(){for(var e="",t="",i=0;i<this.Options.Series.length;i++)if(this.Options.Series[i].isVisible)switch(this.Options.Series[i].Type){case"line":e+=this.__GetPathLine(this.Options.Series[i],i);break;case"bar":t+=this.__GetPathBar(this.Options.Series[i],i)}return t+e}.bind(this),this.__GetSvgPie=function(){for(var e="",t=this.Height<this.Width?.9*this.Height:.9*this.Width,i=0;i<this.Options.Series.length;i++)if(this.Options.Series[i].isVisible){var n=0,r=-45,a=t/4*(this.Options.Series.length-i)/(_.SeriesCount.Pie+_.SeriesCount.Ring),o=2*a;"ring"===this.Options.Series[i].Type&&(o=this.Options.Series[i].Width,a=2*a-o/2);for(var s=0;s<this.Options.Series[i].Data.length;s++)null!==this.Options.Series[i].Data[s]&&(n+=this.Options.Series[i].Data[s]);for(var l=0;l<this.Options.Series[i].Data.length;l++)if(this.Options.Series[i].Data[l]){var u=this.Options.Series[i].Data[l]/n*360;360===u&&(u=359.99,r=0),e+="<g>",e+='<path d="'+Lure.Chart.PieArc(this.Width/2,this.Height/2,a,r,r+u)+'" fill="none" stroke="'+this.Options.Series[i].Colors[l]+'" stroke-width="'+o+'" stroke-opacity="1"></path>',e+='<path class="l-tooltipable" data-type="pie" data-line="'+i+'" data-item="'+l+'" d="'+Lure.Chart.PieArc(this.Width/2,this.Height/2,a,r,r+u)+'" fill="none" stroke="#fff" stroke-width="'+o+'" stroke-opacity="0"></path>',e+="</g>",r+=u}}return e}.bind(this),$.Tooltip(),this.Tooltip=new Lure.Content({Name:"Tooltipchek",Target:this.Block.ChartArea,Content:'<div class="mt-chart-tooltip">\n                        <div class="val">'+this.Options.Tooltip.Template+"</div>\n                      </div>",Visible:!1,Controller:{Data:{}},BeforeShow:function(e,t){},Prop:function(){this._Timer=null,this._Timer2=null,this.isInit=!1},Shower:function(){clearTimeout(this._Timer),clearTimeout(this._Timer2),this.Content.style.display="",this.Content.style.opacity="1"},Hider:function(){clearTimeout(this._Timer),this._Timer=setTimeout(function(){this.Content.style.opacity="0",this._Timer2=setTimeout(function(){this.Content.style.display="none"}.bind(this),200)}.bind(this),800)},Show:function(e){clearTimeout(this._Timer),this.Data.Name=e.data[0],this.Data.Value=e.data[1],this.Refresh(),this.Content.style.left=e.pos[0]+7+"px",this.Content.style.top=e.pos[1]-this.Content.clientHeight-7+"px",this.Content.style.backgroundColor=e.color,this.isInit||(this.Content.style.transition="100ms all ease-in",this.isInit=!0)},Methods:function(){this.Do=function(e){var t=e.currentTarget.dataset.type;switch(t){case"line":this.DoCircle(e);break;case"bar":this.DoBar(e);break;case"pie":this.DoPie(e)}}.bind(this),this.DoCircle=function(e){var t=e.currentTarget,i=parseInt(t.dataset.line),n=parseInt(t.dataset.item),r=t.attributes.stroke.value,a=parseInt(t.attributes["stroke-width"].value);t.attributes.fill.value=r,t.attributes.r.value=parseInt(t.attributes.r.value)+a,t.attributes.stroke.value="#fff";var o={data:[f[i].Name,f[i].Data[n]],color:r,pos:_.SeriesPoints[i][n]};this.Show(o)}.bind(this),this.DoBar=function(e){var t=e.currentTarget;t.setAttribute("fill-opacity",.2);var i=parseInt(t.dataset.line),n=parseInt(t.dataset.item),r={data:[y.Options.Series[i].Name,y.Options.Series[i].Data[n]],color:y.Options.Series[i].Color,pos:_.SeriesPoints[i][n]};this.Show(r)}.bind(this),this.DoPie=function(e){var t=e.currentTarget;t.setAttribute("stroke-opacity",.2);var i=parseInt(t.dataset.line),n=parseInt(t.dataset.item),r={data:[y.Options.Series[i].Labels?y.Options.Series[i].Labels[n]:y.Options.Series[i].Name,y.Options.Series[i].Data[n]],color:y.Options.Series[i].Colors[n],pos:[e.offsetX,e.offsetY]};this.Show(r)}.bind(this),this.Undo=function(e){var t=e.currentTarget.dataset.type;switch(t){case"line":this.UndoCircle(e);break;case"bar":this.UndoBar(e);break;case"pie":this.UndoPie(e)}},this.UndoCircle=function(e){var t=e.currentTarget,i=parseInt(t.attributes["stroke-width"].value);t.attributes.stroke.value=t.attributes.fill.value,t.attributes.fill.value="#fff",t.attributes.r.value-=i,this.Hide()},this.UndoBar=function(e){var t=e.currentTarget;t.setAttribute("fill-opacity",0),this.Hide()},this.UndoPie=function(e){var t=e.currentTarget;t.setAttribute("stroke-opacity",0),this.Hide()}},AfterBuild:function(){}}),this.Buffer=_,this.Width,$.Listeners(),S.Perf("Constructor"),t.call(this),this.SerieSwitch=function(e,t){if(this.Options.Series[e]){var i=Lure.Select('.l-legend-serie[data-line="'+e+'"] .l-legend-checkbox',this.Block.Legend);if(this.isCasual){if(this.Options.Series[e].isVisible=!this.Options.Series[e].isVisible,i.checked=this.Options.Series[e].isVisible,this.Options.Series.filter(function(e){return e.isVisible}).length<1)return this.Options.Series[e].isVisible=!this.Options.Series[e].isVisible,void(i.checked=!0)}else this.Options.Series[e].Data[t]=null!==this.Options.Series[e].Data[t]?null:this._Series[e].Data[t];this.Refresh()}}.bind(this),this.Refresh=function(){t.call(this)}.bind(this),this.Redraw=function(){}.bind(this)}}return _createClass(e,[{key:"Height",get:function(){return this.Block.Svg.clientHeight}},{key:"Width",get:function(){return this.Block.Svg.clientWidth-this.Options.Padding}}],[{key:"GetSeriePointOptions",value:function(e,t){var i=e.Point?e.Point:{};return i.Visible="undefined"==typeof i.Visible||i.Visible,i.Radius=i.Radius?i.Radius:4+e.Width/5,Number.isNaN(i.Radius),i}},{key:"GetScaleY",value:function(e,t,i){if(!i.isCasual)return[];var n=e[0].Data[0],r=e[0].Data[0],a=!0,o=!0;"auto"!==i.Options.AxisY.Scale[0]&&"auto"!==i.Options.AxisY.Scale[1]&&(a=!1,n=i.Options.AxisY.Scale[0],r=i.Options.AxisY.Scale[1]),"auto"!==i.Options.AxisY.Scale[2]&&(o=!1);for(var s=[[e[0].Data[0],e[0].Data[0]]],l=0,u={Scales:[],Dict:[],MinMax:null},c=0;c<e.length;c++)if(e[c].isVisible){u.Dict[c]=0,e[c].OwnAxis&&(l++,"undefined"!=typeof e[c].OwnAxis[0]?s.push(e[c].OwnAxis):s.push([e[c].Data[0],e[c].Data[0]]),u.Dict[c]=l);for(var d=0;d<e[c].Data.length;d++)a&&(e[c].Data[d]<n&&(n=e[c].Data[d]),e[c].Data[d]>r&&(r=e[c].Data[d])),e[c].OwnAxis&&"undefined"==typeof e[c].OwnAxis[0]&&(e[c].Data[d]<s[l][0]&&(s[l][0]=e[c].Data[d]),e[c].Data[d]>s[l][1]&&(s[l][1]=e[c].Data[d]))}s[0]=[n,r],u.MinMax=s;for(var h=20,f=0;f<s.length;f++){var p=s[f][1]-s[f][0],g=Lure.GetNumberOrder(p),v=void 0,C=void 0,b=Math.pow(10,g),m=10*b;C=p>m/2?1e3*b:500*b,p<1.5*b&&(C/=10),v=0!==f||o?s[f][2]?s[f][2]:Lure.RoundBy(p*h/t*1e3,C)/1e3:i.Options.AxisY.Scale[2];for(var S=s[f][0],y=[];S<s[f][1]+i.Options.Series[f].Width;)y.push(S),S+=v,(g<0||v<1)&&(S=1*S.toFixed(1+Math.abs(g)));y.push(S),u.Scales.push(y)}return u}},{key:"GetAbscissa",value:function(e,t){var i=t/e.length;return e.map(function(e,t){return t*i})}},{key:"GetOrdinata",value:function(e,t,i,n){for(var r=i[0],a=i[1],o=t[t.length-1]/a,s=[],l=0;l<e.length;l++)s.push(n-(e[l]-r)*n/(a-r)/o);return s}},{key:"GetPoints",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=[],r=0;r<t.length;r++)n.push([e[r]+i,t[r]]);return n}},{key:"GetPathLineDot",value:function(e,t,i,n,r,a){return'<circle class="mt-chart-point l-tooltipable" data-type="line" data-line="'+i+'" data-item="'+n+'" cx="'+e+'" cy="'+t+'" r="'+a+'" stroke="'+r+'" stroke-width="2" fill="#fff" ></circle>'}},{key:"PolarToCartesius",value:function(e,t,i,n){var r=(n-0)*Math.PI/180;return{x:e+i*Math.cos(r),y:t+i*Math.sin(r)}}},{key:"PieArc",value:function(e,t,i,n,r){var a=Lure.Chart.PolarToCartesius(e,t,i,r),o=Lure.Chart.PolarToCartesius(e,t,i,n),s=r-n<=180?"0":"1",l=["M",a.x,a.y,"A",i,i,0,s,0,o.x,o.y].join(" ");return l}},{key:"MakeLegend",value:function(e,t){var i="lc-legeng_ch"+Lure.Chart.Count+t;return'<div class="l-legend-serie row" data-line="'+t+'">\n                      <input class="l-legend-checkbox" type="checkbox" '+(e.isVisible?'checked="checked"':"")+' id="'+i+'" data-line="'+t+'">\n                      \n                      <label class="l-legend-label lc-legend-casual-label" for="'+i+'" data-line="'+t+'" style="cursor: pointer"><div class="l-legend-icon" style="background-color: '+e.Color+'"></div><span>'+e.Name+"</span></label>\n                    </div>"}},{key:"MakeLegendPie",value:function(e,t){for(var i="lc-legeng_ch"+Lure.Chart.Count+t,n="",r=0;r<e.Data.length;r++)n+='<div class="l-legend-serie row" data-line="'+t+'">\n                      <input class="l-legend-checkbox" type="checkbox" '+(e.isVisible?'checked="checked"':"")+' id="'+i+r+'" data-line="'+t+'" data-item="'+r+'">\n                      \n                      <label class="l-legend-label  lc-legend-pie-label" for="'+i+r+'"  style="cursor: pointer"><div class="l-legend-icon" style="background-color: '+e.Colors[r]+'"></div><span>'+e.Labels[r]+"</span></label>\n                    </div>";return n}},{key:"GetGrid",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n="",r=0;r<t;r++){n+='<div class="l-grid-row row flex-100 flex-between" >';for(var a=0;a<e;a++)0===a&&(n+="<div class='l-grid-cell flex-100' style=\"width: "+i+"px; max-width: "+i+'px"></div>'),n+="<div class='l-grid-cell flex-100'></div>";n+="</div>"}return n+=""}}]),e}()},Lure.Chart=Lure.Plugin.Chart.Chart,Lure.Chart.Count=0,Lure._GenerateStrin2g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e+(Math.random().toString(36)+Math.random().toString(36)+Math.random().toString(36)).replace("0.","").replace(/[\d]+/,"").substring(0,1);return Lure.Select("#"+t)&&(t=Lure._GenerateString(e)),t};
//# sourceMappingURL=lure.all.min.js.map
