"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();Lure.Plugin.Chart={Version:"v0.1.0    05.09.2017",Core:{Defaults:{Color:["red","green","cornflowerblue","purple","palevioletred","orange","tomato","darkblue"],TemplateLabel:{Line:"Name: {{Name}}<br>Value: {{Value}}",Pie:"Name: {{Name}}<br>Value: {{Value}}"}}},Chart:function(){function t(){function e(){console.log("------refresh------"),x.SeriesBar=0,x.SeriesCount.Line=0,x.SeriesCount.Bar=0,x.SeriesCount.Pie=0,x.SeriesCount.Ring=0,x.Svg="",L.Reset(),m.Series(),L.Perf("Init-Series"),y.Legend(),L.Perf("Render-Legend"),m.AxisY(),L.Perf("Init-AxisY"),m.AxisX(),y.AxisX(),L.Perf("Init-AxisX"),m.ScaleY(),L.Perf("Init-AxisYScales"),this.Block.Grid=y.MakeGrid(),L.Perf("Render-Grid"),this.Block.AxisY=y.MakeAxisY(),L.Perf("Render-AxisY"),this.isCasual?this.Block.Svg=C.__GetSvgCasual():this.Block.Svg=C.__GetSvgPie(),this.Block.AxisY.style.height=this.Height+"px",L.Perf("Render-Svg");var t=Lure.SelectAll('.l-chart-serie[data-type="Line"] path',this.Content);k.Height=this.Height,k.Width=this.Width,t.forEach(function(t){var e=t.getTotalLength();t.style.strokeDasharray=e,t.style.strokeDashoffset=e}),L.Perf("Animations-add"),L.Elapsed("-elapsed-")}var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=s.Type,r=void 0===a?"Line":a,n=s.Title,o=void 0===n?"":n,l=s.Labels,h=void 0===l?{Rotation:"auto",Data:[]}:l,c=s.Grid,u=void 0===c?{}:c,d=s.Series,p=void 0===d?[]:d,f=s.Tooltip,b=void 0===f?{Template:null}:f,v=s.AxisY,S=void 0===v?{Scale:["auto","auto","auto"],Visible:!0}:v,g=(s.Height,s.SeriesOptions,s.Disabled),O=void 0!==g&&g;if(_classCallCheck(this,t),!O){var L=new Lure.Diagnostics.Perf;Lure.Chart.Count++;var C=this;this.Content=Lure.Select(i),this.isCasual=!0;var x={Legend:"",AxisX:"",AxisY:"",Grid:"",Svg:"",Height:0,Width:0,Abscissa:null,SeriesPoints:[],SeriesCount:{Line:0,Bar:0,Pie:0,Ring:0},SeriesBar:0,ParametersAxisX:null};this._Series=p,this.Options={Type:r?r.toLowerCase():"line",Title:o?o:"",Legend:{Visible:!0},Labels:{Visible:"undefined"==typeof h.Visible||h.Visible,Rotation:h.Rotation?h.Rotation:"auto",Data:h.Data?h.Data:[],Font:{Family:"sans-serif",Size:"0.8rem"}},Grid:{Visible:"undefined"==typeof u.Visible||u.Visible},Series:null,SeriesOptions:{BarStack:!1,BarGradient:!0,PieStack:!1,PieType:"pie"},AxisY:{Font:{Family:"sans-serif",Size:"0.8rem"},Scale:S.Scale?[Lure.isNumeric(S.Scale[0])?S.Scale[0]:"auto",Lure.isNumeric(S.Scale[1])?S.Scale[1]:"auto",Lure.isNumeric(S.Scale[2])?S.Scale[2]:"auto"]:["auto","auto","auto"],Visible:"undefined"==typeof S.Visible||S.Visible,Title:S.Title},Padding:0,Tooltip:{Template:null}},this.Block=function(){this.Content.innerHTML='<div class="l-chart col">\n                                        <div>\n                                          <div class="l-title">'+o+'</div>\n                                          <div class="l-legend row"></div>\n                                        </div>\n                                        <div class="row flex-100">\n                                          <div class="l-axis-y row"></div>\n                                          <div class="col flex-100">\n                                            <div class="l-chart-area row flex-100" style="position: relative">\n                                              <svg class="l-chart-svg flex-100" style="position: relative; z-index: 1"></svg>\n                                              <div class="l-grid col flex-between"></div>\n                                            </div>\n                                            <div class="l-axis-x row"></div>\n                                           </div>\n                                        </div>\n                                      </div>';var t=this.Content.querySelector(".l-legend"),e=this.Content.querySelector(".l-axis-x"),i=this.Content.querySelector(".l-axis-y"),s=this.Content.querySelector(".l-chart-area"),a=this.Content.querySelector(".l-grid"),r=this.Content.querySelector(".l-chart-svg");return{get Legend(){return t},set Legend(e){t.innerHTML=e},get AxisX(){return e},set AxisX(t){e.innerHTML=t},get AxisY(){return i},set AxisY(t){i.innerHTML=t},get ChartArea(){return s},set ChartArea(t){s.innerHTML=t},get Grid(){return a},set Grid(t){a.innerHTML=t},get Svg(){return r},set Svg(t){r.innerHTML=t}}}.bind(this)();var y={Legend:function(){if(""===x.Legend){var t=Lure.Chart.MakeLegend;this.isCasual||(t=Lure.Chart.MakeLegendPie);for(var e=0;e<this.Options.Series.length;e++)x.Legend+=t(this.Options.Series[e],e);this.Block.Legend=x.Legend}}.bind(this),AxisX:function(){if(!C.Options.Labels.Visible)return void(this.Block.AxisX="");for(var t=C.Options.Labels.Data,e="transform: translate("+x.AxisXParams.MarginLeft+"px) rotate("+x.AxisXParams.Angle+"deg); margin-top: "+x.AxisXParams.MarginTop+"px ; width: "+x.AxisXParams.Width+"px;",i="",s=0;s<t.length;s++)i+='<div class="l-label l-label__x" style="font-family: '+C.Options.Labels.Font.Family+"; font-size: "+C.Options.Labels.Font.Size+'"><span style="'+e+'">'+t[s]+"</span></div>";x.AxisX=i,this.Block.AxisX=i,this.Block.AxisX.style.borderTop="1px #111 solid"}.bind(this),AxisY:function(){return!this.Options.Labels.Visible,""}.bind(this),MakeAxisY:function(){var t=0;if(!C.Options.AxisY.Visible&&(t=1,!C._ScaleY.Scales||C._ScaleY.Scales.length<2))return"";var e="font-family: "+C.Options.Labels.Font.Family+"; font-size: "+C.Options.Labels.Font.Size+";",i="";for(t;t<C._ScaleY.Scales.length;t++){var s=C._ScaleY.Dict.indexOf(t),a=C._ScaleY.Scales[t],r="";t>0?r='<div class="l-caption"><div style="transform: matrix(0, -1, 1, 0, 0, 0);">'+C.Options.Series[s].Title+"</div></div>":0===t&&C.Options.AxisY.Title&&(r='<div class="l-caption"><div style="transform: matrix(0, -1, 1, 0, 0, 0); font-weight: bold;">'+C.Options.AxisY.Title+"</div></div>");for(var n="",o=0;o<a.length;o++)n+='<div class="l-label l-label__y"><span>'+a[o]+"</span></div>";t>0&&(e+=" color: "+C.Options.Series[s].Color+"; font-weight: bold;"),i+='<div class="l-axis-y-scale row" style="'+e+'" data-line="'+t+'">'+r+'<div class="l-labels col">'+n+"</div></div>"}return i},MakeAxisX:function(){if(!C.Options.Labels.Visible)return"";for(var t=C.Options.Labels.Data,e="transform: translate("+x.AxisXParams.MarginLeft+"px) rotate("+x.AxisXParams.Angle+"deg); margin-top: "+x.AxisXParams.MarginTop+"px ; width: "+x.AxisXParams.Width+"px;",i="",s=0;s<t.length;s++)i+='<div class="l-label l-label__x" style="font-family: '+C.Options.Labels.Font.Family+"; font-size: "+C.Options.Labels.Font.Size+'"><span style="'+e+'">'+t[s]+"</span></div>";return i},MakeGrid:function(t,e){return C.Options.Grid.Visible?Lure.Chart.GetGrid(C.Options.Labels.Data.length,C._ScaleY.Scales[0].length-1,C.Options.Padding):""},MakeGraph:function(t,e){var i=C._ScaleY.Dict[e],s=C._ScaleY.Scales[i],a=C._ScaleY.MinMax[i],r=Lure.Chart.GetOrdinata(t.Data,s,a,C.Height),n=Lure.Chart.GetAbscissa(C.Options.Labels.Data,C.Width),o=Lure.Chart.GetPoints(n,r);return Lure.Chart.GetPath(o,C.Options.Series[e].Type,e,C.Options.Series[e].Color,C.Options.Series[e].Width)}},A={Activate:function(t){var e=t.dataset.type;switch(e){case"line":A.ActivateCircle(t);break;case"bar":A.ActivateBar(t);break;case"pie":A.ActivatePie(t)}},Disactivate:function(t){var e=t.dataset.type;switch(e){case"line":A.DisactivateCircle(t);break;case"bar":A.DisactivateBar(t);break;case"pie":A.DisactivatePie(t)}},ActivateCircle:function(t){var e=(parseInt(t.dataset.line),parseInt(t.dataset.item),t.attributes.stroke.value),i=parseInt(t.attributes["stroke-width"].value);t.attributes.fill.value=e,t.attributes.r.value=parseInt(t.attributes.r.value)+i,t.attributes.stroke.value="#fff"},ActivateBar:function(t){t.setAttribute("fill-opacity",.2);parseInt(t.dataset.line),parseInt(t.dataset.item)},ActivatePie:function(t){t.setAttribute("stroke-opacity",.2);parseInt(t.dataset.line),parseInt(t.dataset.item)},DisactivateCircle:function(t){var e=parseInt(t.attributes["stroke-width"].value),i=t.attributes.fill.value;"#fff"!==i&&(t.attributes.stroke.value=i,t.attributes.fill.value="#fff",t.attributes.r.value-=e)},DisactivateBar:function(t){t.setAttribute("fill-opacity",0)},DisactivatePie:function(t){t.setAttribute("stroke-opacity",0)}},m={Tooltip:function(){return b.Template?void(this.Options.Tooltip.Template=b.Template):"line"===this.Options.Type||"bar"===this.Options.Type?void(this.Options.Tooltip.Template=Lure.Plugin.Chart.Core.Defaults.TemplateLabel.Line):void("pie"!==this.Options.Type&&"ring"!==this.Options.Type||(this.Options.Tooltip.Template=Lure.Plugin.Chart.Core.Defaults.TemplateLabel.Pie))}.bind(this),Series:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];if(null===this.Options.Series||t){for(var i=0;i<this._Series.length;i++){var s={};s.Name=this._Series[i].Name?this._Series[i].Name:"Unnamed",s.Title=this._Series[i].Title?this._Series[i].Title:s.Name,s.Color=this._Series[i].Color?this._Series[i].Color:Lure.Plugin.Chart.Core.Defaults.Color[i]?Lure.Plugin.Chart.Core.Defaults.Color[i]:"#000",s.Width=this._Series[i].Width?this._Series[i].Width:2,s.Data=JSON.parse(JSON.stringify(this._Series[i].Data)),s.Type=this._Series[i].Type?this._Series[i].Type.toLowerCase():r?r.toLowerCase():"line","pie"!==s.Type&&"ring"!==s.Type||(this.isCasual&&(this.isCasual=!1),s.Colors=this._Series[i].Colors?this._Series[i].Colors:Lure.Plugin.Chart.Core.Defaults.Color,s.Width=this._Series[i].Width?this._Series[i].Width:30,s.Labels=this._Series[i].Labels?this._Series[i].Labels:!!this.Options.Labels.Data&&this.Options.Labels.Data),s.Line=i,s.isVisible="undefined"==typeof this._Series[i].Visible||this._Series[i].Visible,s.OwnAxis=this._Series[i].OwnAxis,s.Point=this._Series[i].Point,s.Point=Lure.Chart.GetSeriePointOptions(s),s.isVisible&&x.SeriesCount[s.Type.capitalize()]++,e.push(s)}this.Options.Series=e}else for(var a=0;a<this.Options.Series.length;a++)this.Options.Series[a].isVisible&&x.SeriesCount[this.Options.Series[a].Type.capitalize()]++}.bind(this),AxisY:function(){if(this.Width!==k.Width){for(var t=(this.Options.AxisY.Visible?1:0,0),e=0,i=0;i<this.Options.Series.length;i++)if(this.Options.Series[i].isVisible&&this.Options.Series[i].OwnAxis){for(var s=0,a=0;a<this.Options.Series[i].Data.length;a++){var r=Lure.GetTextWidth(this.Options.Series[i].Data[a],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);r>s&&(s=this.Options.Series[i].Data[a])}var n=Lure.GetTextWidth(this.Options.Series[i].OwnAxis[1],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);n>s&&(s=n),e+=s+8;var o=Lure.GetTextWidth(this.Options.Series[i].Title,this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);e+=o>30?30:o}else if(this.Options.Series[i].isVisible&&!Array.isArray(this.Options.Series[i].OwnAxis))for(var l=0;l<this.Options.Series[i].Data.length;l++){var h=Lure.GetTextWidth(this.Options.Series[i].Data[l],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);h>t&&(t=this.Options.Series[i].Data[l])}e+=t+10+7,x.AxisYWidth=e}}.bind(this),AxisX:function(){if(this.Width!==k.Width){if(!this.Options.Labels.Visible)return void(x.AxisXParams={Height:0,Width:0,MarginTop:0,MarginLeft:0,Angle:0});for(var t=0,e=0;e<this.Options.Labels.Data.length;e++){var i=Lure.GetTextWidth(this.Options.Labels.Data[e],this.Options.AxisY.Font.Family,this.Options.AxisY.Font.Size);i>t&&(t=i)}var s=(this.Content.clientWidth-x.AxisYWidth)/this.Options.Labels.Data.length;s=(this.Content.clientWidth-x.AxisYWidth-s/2)/this.Options.Labels.Data.length,this.Options.Padding=s/2,this.Block.AxisX.style.paddingLeft=s/2+"px";var a=0,r=t,n=void 0;if("auto"!==this.Options.Labels.Rotation)n=parseFloat(this.Options.Labels.Rotation);else{var o=s/r;o<.15&&(o=0),o>1&&(o=1),n=-(180*Math.acos(o)/Math.PI).toFixed(2)}x.AxisXParams={Height:Math.round(Math.sqrt(Math.pow(r,2)-Math.pow(s,2)))+parseFloat(getComputedStyle(this.Block.AxisX).lineHeight),Width:r,MarginTop:r>s?Math.sqrt(Math.pow(r,2)-Math.pow(s,2))-a:0,MarginLeft:r>s?-s/2:-r/2,Angle:n}}}.bind(this),ScaleY:function(){return void(this._ScaleY=Lure.Chart.GetScaleY(this.Options.Series,this.Height,this))}.bind(this),Listeners:function(){Lure.AddEventListenerGlobal("mouseover",".lc-legend-casual-label",function(t){var e=t.currentTarget.dataset.line;if(this.Options.Series[e].isVisible){for(var i=Lure.SelectAll('.l-tooltipable[data-line="'+e+'"]',C.Block.Svg),s=0;s<i.length;s++)A.Activate(i[s]);var a=Lure.Select('.l-chart-serie[data-line="'+e+'"] path',C.Block.Svg);if(a){var r=parseFloat(a.getAttribute("stroke-width"));a.setAttribute("stroke-width",r+1)}}}.bind(this),this.Block.Legend),Lure.AddEventListenerGlobal("mouseout",".lc-legend-casual-label",function(t){var e=t.currentTarget.dataset.line;if(this.Options.Series[e].isVisible){for(var i=Lure.SelectAll('.l-tooltipable[data-line="'+e+'"]',C.Block.Svg),s=0;s<i.length;s++)A.Disactivate(i[s]);var a=Lure.Select('.l-chart-serie[data-line="'+e+'"] path',C.Block.Svg);if(a){var r=parseFloat(a.getAttribute("stroke-width"));a.setAttribute("stroke-width",r-1)}}}.bind(this),this.Block.Legend),Lure.AddEventListenerGlobal("change",".l-legend-checkbox",function(t){this.SerieSwitch(t.currentTarget.dataset.line,t.currentTarget.dataset.item)}.bind(this),this.Block.Legend),Lure.AddEventListenerGlobal("mouseover",".l-tooltipable",function(t){this.Tooltip.Do(t)},this.Content,this),Lure.AddEventListenerGlobal("mouseout",".l-tooltipable",function(t){C.Tooltip.Undo(t)},this.Content)}.bind(this)},k={Width:0,Height:0,DataLength:0};this.__GetPathLine=function(t,e){x.Abscissa&&x.Width===this.Width||(x.Abscissa=Lure.Chart.GetAbscissa(C.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[e],s=this._ScaleY.Scales[i],a=C._ScaleY.MinMax[i],r=Lure.Chart.GetOrdinata(t.Data,s,a,C.Height),n=Lure.Chart.GetPoints(x.Abscissa,r,this.Options.Padding);x.SeriesPoints[e]=n;for(var o=n.length,l=[],h=[],c=[],u=[],d=[],p=[],f=0;f<o;f++)l[f]=n[f][0],h[f]=n[f][1];for(var b=0;b<o-1;b++)c[b]=h[b+1]-h[b],u[b]=l[b+1]-l[b],d[b]=c[b]/u[b];p[0]=d[0],p[o-1]=d[o-2];for(var v=1;v<o-1;v++)0===d[v]||0===d[v-1]||d[v-1]>0!=d[v]>0?p[v]=0:(p[v]=3*(u[v-1]+u[v])/((2*u[v]+u[v-1])/d[v-1]+(u[v]+2*u[v-1])/d[v]),isFinite(p[v])||(p[v]=0));for(var S="M "+l[0]+","+h[0],g='<g class="mt-chart-dots">',O=0;O<o-1;O++)S+=" C "+(l[O]+u[O]/3)+","+(h[O]+p[O]*u[O]/3)+" "+(l[O+1]-u[O]/3)+","+(h[O+1]-p[O+1]*u[O]/3)+" "+l[O+1]+","+h[O+1],t.Point.Visible&&(g+=Lure.Chart.GetPathLineDot(l[O],h[O],e,O,t.Color,t.Point.Radius));return t.Point.Visible&&(g+=Lure.Chart.GetPathLineDot(l[o-1],h[o-1],e,o-1,t.Color,t.Point.Radius)),g+="</g>",'<g class="l-chart-serie" data-type="Line" data-line="'+e+'"><path data-line="'+e+'" d="'+S+'" fill="none" stroke="'+t.Color+'" stroke-width="'+t.Width+'"></path> '+g+"</g>"}.bind(this),this.__GetPathBar=function(t,e){x.Abscissa&&x.Width===this.Width||(x.Abscissa=Lure.Chart.GetAbscissa(C.Options.Labels.Data,this.Width));var i=this._ScaleY.Dict[e],s=this._ScaleY.Scales[i],a=C._ScaleY.MinMax[i],r=Lure.Chart.GetOrdinata(t.Data,s,a,C.Height),n=Lure.Chart.GetPoints(x.Abscissa,r,this.Options.Padding);x.SeriesPoints[e]=n;var o=this.Height,l=1;this.Options.SeriesOptions.BarStack||(l=.8*x.SeriesCount.Bar);var h=this.Width/this.Options.Labels.Data.length/2/l,c=1.2*h*x.SeriesBar-(1.2*h*x.SeriesCount.Bar/2-1.2*h/2),u='<g class="l-chart-serie" data-type="Bar" data-line="'+e+'">',d="";this.Options.SeriesOptions.BarGradient&&(d="lc-gradient-"+Lure.Chart.Count,u+='<linearGradient id="'+d+'"  x1="0" y1="0%"><stop offset="0%" stop-color="rgba(0,0,0,0.2)"/><stop offset="33%" stop-color="rgba(255,255,255,0.2)"/><stop offset="100%" stop-color="rgba(0,0,0,0.3)"/></linearGradient>');for(var p="",f=0;f<n.length;f++){var b="M "+(c+n[f][0]-h/2)+" "+o+" L "+(c+n[f][0]+h/2)+" "+o+" "+(c+n[f][0]+h/2)+" "+n[f][1]+" "+(c+n[f][0]-h/2)+" "+n[f][1]+"Z";u+='<g class="lc-bar-elem"><path class="lc-bar-elem" data-line="'+e+'" data-item="'+f+'" d="'+b+'" fill="'+t.Color+'" stroke="#000" stroke-width="0"></path>',this.Options.SeriesOptions.BarGradient&&(u+='<path class="lc-bar-elem-gradient"  data-line="'+e+'" data-item="'+f+'" d="'+b+'" fill="url(#'+d+')" ></path>'),u+='<path class="l-tooltipable" data-type="bar" data-line="'+e+'" data-item="'+f+'" d="'+b+'" fill="#fff" fill-opacity="0" stroke="#fff" stroke-width="0"></path>',u+="</g>"}return u+=p+"</g>",x.SeriesBar++,u}.bind(this),this.__GetSvgCasual=function(){for(var t="",e="",i=0;i<this.Options.Series.length;i++)if(this.Options.Series[i].isVisible)switch(this.Options.Series[i].Type){case"line":t+=this.__GetPathLine(this.Options.Series[i],i);break;case"bar":e+=this.__GetPathBar(this.Options.Series[i],i)}return e+t}.bind(this),this.__GetSvgPie=function(){for(var t="",e=this.Height<this.Width?.9*this.Height:.9*this.Width,i=0;i<this.Options.Series.length;i++)if(this.Options.Series[i].isVisible){var s=0,a=-45,r=e/4*(this.Options.Series.length-i)/(x.SeriesCount.Pie+x.SeriesCount.Ring),n=2*r;"ring"===this.Options.Series[i].Type&&(n=this.Options.Series[i].Width,r=2*r-n/2);for(var o=0;o<this.Options.Series[i].Data.length;o++)null!==this.Options.Series[i].Data[o]&&(s+=this.Options.Series[i].Data[o]);for(var l=0;l<this.Options.Series[i].Data.length;l++)if(this.Options.Series[i].Data[l]){var h=this.Options.Series[i].Data[l]/s*360;360===h&&(h=359.99,a=0),t+="<g>",t+='<path d="'+Lure.Chart.PieArc(this.Width/2,this.Height/2,r,a,a+h)+'" fill="none" stroke="'+this.Options.Series[i].Colors[l]+'" stroke-width="'+n+'" stroke-opacity="1"></path>',t+='<path class="l-tooltipable" data-type="pie" data-line="'+i+'" data-item="'+l+'" d="'+Lure.Chart.PieArc(this.Width/2,this.Height/2,r,a,a+h)+'" fill="none" stroke="#fff" stroke-width="'+n+'" stroke-opacity="0"></path>',t+="</g>",a+=h}}return t}.bind(this),m.Tooltip(),this.Tooltip=new Lure.Content({Name:"Tooltipchek",Target:this.Block.ChartArea,Content:'<div class="mt-chart-tooltip">\n                        <div class="val">'+this.Options.Tooltip.Template+"</div>\n                      </div>",Visible:!1,Controller:{Data:{}},BeforeShow:function(t,e){},Prop:function(){this._Timer=null,this._Timer2=null,this.isInit=!1},Shower:function(){clearTimeout(this._Timer),clearTimeout(this._Timer2),this.Content.style.display="",this.Content.style.opacity="1"},Hider:function(){clearTimeout(this._Timer),this._Timer=setTimeout(function(){this.Content.style.opacity="0",this._Timer2=setTimeout(function(){this.Content.style.display="none"}.bind(this),200)}.bind(this),800)},Show:function(t){clearTimeout(this._Timer),this.Data.Name=t.data[0],this.Data.Value=t.data[1],this.Refresh(),this.Content.style.left=t.pos[0]+7+"px",this.Content.style.top=t.pos[1]-this.Content.clientHeight-7+"px",this.Content.style.backgroundColor=t.color,this.isInit||(this.Content.style.transition="100ms all ease-in",this.isInit=!0)},Methods:function(){this.Do=function(t){var e=t.currentTarget.dataset.type;switch(e){case"line":this.DoCircle(t);break;case"bar":this.DoBar(t);break;case"pie":this.DoPie(t)}}.bind(this),this.DoCircle=function(t){var e=t.currentTarget,i=parseInt(e.dataset.line),s=parseInt(e.dataset.item),a=e.attributes.stroke.value,r=parseInt(e.attributes["stroke-width"].value);e.attributes.fill.value=a,e.attributes.r.value=parseInt(e.attributes.r.value)+r,e.attributes.stroke.value="#fff";var n={data:[p[i].Name,p[i].Data[s]],color:a,pos:x.SeriesPoints[i][s]};this.Show(n)}.bind(this),this.DoBar=function(t){var e=t.currentTarget;e.setAttribute("fill-opacity",.2);var i=parseInt(e.dataset.line),s=parseInt(e.dataset.item),a={data:[C.Options.Series[i].Name,C.Options.Series[i].Data[s]],color:C.Options.Series[i].Color,pos:x.SeriesPoints[i][s]};this.Show(a)}.bind(this),this.DoPie=function(t){var e=t.currentTarget;e.setAttribute("stroke-opacity",.2);var i=parseInt(e.dataset.line),s=parseInt(e.dataset.item),a={data:[C.Options.Series[i].Labels?C.Options.Series[i].Labels[s]:C.Options.Series[i].Name,C.Options.Series[i].Data[s]],color:C.Options.Series[i].Colors[s],pos:[t.offsetX,t.offsetY]};this.Show(a)}.bind(this),this.Undo=function(t){var e=t.currentTarget.dataset.type;switch(e){case"line":this.UndoCircle(t);break;case"bar":this.UndoBar(t);break;case"pie":this.UndoPie(t)}},this.UndoCircle=function(t){var e=t.currentTarget,i=parseInt(e.attributes["stroke-width"].value);e.attributes.stroke.value=e.attributes.fill.value,e.attributes.fill.value="#fff",e.attributes.r.value-=i,this.Hide()},this.UndoBar=function(t){var e=t.currentTarget;e.setAttribute("fill-opacity",0),this.Hide()},this.UndoPie=function(t){var e=t.currentTarget;e.setAttribute("stroke-opacity",0),this.Hide()}},AfterBuild:function(){}}),this.Buffer=x,this.Width,m.Listeners(),L.Perf("Constructor"),e.call(this),this.SerieSwitch=function(t,e){if(this.Options.Series[t]){var i=Lure.Select('.l-legend-serie[data-line="'+t+'"] .l-legend-checkbox',this.Block.Legend);if(this.isCasual){if(this.Options.Series[t].isVisible=!this.Options.Series[t].isVisible,i.checked=this.Options.Series[t].isVisible,this.Options.Series.filter(function(t){return t.isVisible}).length<1)return this.Options.Series[t].isVisible=!this.Options.Series[t].isVisible,void(i.checked=!0)}else this.Options.Series[t].Data[e]=null!==this.Options.Series[t].Data[e]?null:this._Series[t].Data[e];this.Refresh()}}.bind(this),this.Refresh=function(){e.call(this)}.bind(this),this.Redraw=function(){}.bind(this)}}return _createClass(t,[{key:"Height",get:function(){return this.Block.Svg.clientHeight}},{key:"Width",get:function(){return this.Block.Svg.clientWidth-this.Options.Padding}}],[{key:"GetSeriePointOptions",value:function(t,e){var i=t.Point?t.Point:{};return i.Visible="undefined"==typeof i.Visible||i.Visible,i.Radius=i.Radius?i.Radius:4+t.Width/5,Number.isNaN(i.Radius),i}},{key:"GetScaleY",value:function(t,e,i){if(!i.isCasual)return[];var s=t[0].Data[0],a=t[0].Data[0],r=!0,n=!0;"auto"!==i.Options.AxisY.Scale[0]&&"auto"!==i.Options.AxisY.Scale[1]&&(r=!1,s=i.Options.AxisY.Scale[0],a=i.Options.AxisY.Scale[1]),"auto"!==i.Options.AxisY.Scale[2]&&(n=!1);for(var o=[[t[0].Data[0],t[0].Data[0]]],l=0,h={Scales:[],Dict:[],MinMax:null},c=0;c<t.length;c++)if(t[c].isVisible){h.Dict[c]=0,t[c].OwnAxis&&(l++,"undefined"!=typeof t[c].OwnAxis[0]?o.push(t[c].OwnAxis):o.push([t[c].Data[0],t[c].Data[0]]),h.Dict[c]=l);for(var u=0;u<t[c].Data.length;u++)r&&(t[c].Data[u]<s&&(s=t[c].Data[u]),t[c].Data[u]>a&&(a=t[c].Data[u])),t[c].OwnAxis&&"undefined"==typeof t[c].OwnAxis[0]&&(t[c].Data[u]<o[l][0]&&(o[l][0]=t[c].Data[u]),t[c].Data[u]>o[l][1]&&(o[l][1]=t[c].Data[u]))}o[0]=[s,a],h.MinMax=o;for(var d=20,p=0;p<o.length;p++){var f=o[p][1]-o[p][0],b=Lure.GetNumberOrder(f),v=void 0,S=void 0,g=Math.pow(10,b),O=10*g;S=f>O/2?1e3*g:500*g,f<1.5*g&&(S/=10),v=0!==p||n?o[p][2]?o[p][2]:Lure.RoundBy(f*d/e*1e3,S)/1e3:i.Options.AxisY.Scale[2];for(var L=o[p][0],C=[];L<o[p][1]+i.Options.Series[p].Width;)C.push(L),L+=v,(b<0||v<1)&&(L=1*L.toFixed(1+Math.abs(b)));C.push(L),h.Scales.push(C)}return h}},{key:"GetAbscissa",value:function(t,e){var i=e/t.length;return t.map(function(t,e){return e*i})}},{key:"GetOrdinata",value:function(t,e,i,s){for(var a=i[0],r=i[1],n=e[e.length-1]/r,o=[],l=0;l<t.length;l++)o.push(s-(t[l]-a)*s/(r-a)/n);return o}},{key:"GetPoints",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=[],a=0;a<e.length;a++)s.push([t[a]+i,e[a]]);return s}},{key:"GetPathLineDot",value:function(t,e,i,s,a,r){return'<circle class="mt-chart-point l-tooltipable" data-type="line" data-line="'+i+'" data-item="'+s+'" cx="'+t+'" cy="'+e+'" r="'+r+'" stroke="'+a+'" stroke-width="2" fill="#fff" ></circle>'}},{key:"PolarToCartesius",value:function(t,e,i,s){var a=(s-0)*Math.PI/180;return{x:t+i*Math.cos(a),y:e+i*Math.sin(a)}}},{key:"PieArc",value:function(t,e,i,s,a){var r=Lure.Chart.PolarToCartesius(t,e,i,a),n=Lure.Chart.PolarToCartesius(t,e,i,s),o=a-s<=180?"0":"1",l=["M",r.x,r.y,"A",i,i,0,o,0,n.x,n.y].join(" ");return l}},{key:"MakeLegend",value:function(t,e){var i="lc-legeng_ch"+Lure.Chart.Count+e;return'<div class="l-legend-serie row" data-line="'+e+'">\n                      <input class="l-legend-checkbox" type="checkbox" '+(t.isVisible?'checked="checked"':"")+' id="'+i+'" data-line="'+e+'">\n                      \n                      <label class="l-legend-label lc-legend-casual-label" for="'+i+'" data-line="'+e+'" style="cursor: pointer"><div class="l-legend-icon" style="background-color: '+t.Color+'"></div><span>'+t.Name+"</span></label>\n                    </div>"}},{key:"MakeLegendPie",value:function(t,e){for(var i="lc-legeng_ch"+Lure.Chart.Count+e,s="",a=0;a<t.Data.length;a++)s+='<div class="l-legend-serie row" data-line="'+e+'">\n                      <input class="l-legend-checkbox" type="checkbox" '+(t.isVisible?'checked="checked"':"")+' id="'+i+a+'" data-line="'+e+'" data-item="'+a+'">\n                      \n                      <label class="l-legend-label  lc-legend-pie-label" for="'+i+a+'"  style="cursor: pointer"><div class="l-legend-icon" style="background-color: '+t.Colors[a]+'"></div><span>'+t.Labels[a]+"</span></label>\n                    </div>";return s}},{key:"GetGrid",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s="",a=0;a<e;a++){s+='<div class="l-grid-row row flex-100 flex-between" >';for(var r=0;r<t;r++)0===r&&(s+="<div class='l-grid-cell flex-100' style=\"width: "+i+"px; max-width: "+i+'px"></div>'),s+="<div class='l-grid-cell flex-100'></div>";s+="</div>"}return s+=""}}]),t}()},Lure.Chart=Lure.Plugin.Chart.Chart,Lure.Chart.Count=0,Lure._GenerateStrin2g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=t+(Math.random().toString(36)+Math.random().toString(36)+Math.random().toString(36)).replace("0.","").replace(/[\d]+/,"").substring(0,1);return Lure.Select("#"+e)&&(e=Lure._GenerateString(t)),e};
//# sourceMappingURL=lure.chart.min.js.map
